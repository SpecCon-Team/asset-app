import{r,j as e}from"./react-vendor-CGeGxK2Z.js";import{u as F,a as x,L as E}from"./index-C4sdeoft.js";import{showError as b,showConfirm as P,showSuccess as R}from"./sweetalert-BqYQyfQ6.js";import{u as I}from"./react-router-vendor-DDwJJgaM.js";import{P as g,f as w,J as $,x as M,a2 as f,e as Q,aA as T,ah as k,Q as U,U as B,ab as J}from"./ui-libs-t3PztYli.js";import"./export-libs-_UL_8v9K.js";import"./vendor-U4Kn3po4.js";function X(){const d=I(),[N,h]=r.useState(!0),v=F(N,2e3),[u,C]=r.useState([]),[l,S]=r.useState(null),[c,L]=r.useState(""),[i,O]=r.useState("all"),[n,_]=r.useState(!1);r.useEffect(()=>{m(),p()},[i,n]);const m=async()=>{try{h(!0);const s=x(),t={};i!=="all"&&(t.status=i),n&&(t.overdue="true");const a=await s.get("/checkout",{params:t});C(a.data.checkouts||[])}catch(s){console.error("Failed to fetch checkouts:",s),await b("Error","Failed to load checkouts")}finally{h(!1)}},p=async()=>{try{const t=await x().get("/checkout/stats");S(t.data)}catch(s){console.error("Failed to fetch stats:",s)}},A=async s=>{var a,j;if((await P("Check In Asset","Are you sure you want to check in this asset?","Check In","Cancel")).isConfirmed)try{await x().post(`/checkout/${s}/checkin`,{returnCondition:"good"}),await R("Success!","Asset checked in successfully",1500),m(),p()}catch(o){console.error("Failed to check in asset:",o),await b("Error",((j=(a=o.response)==null?void 0:a.data)==null?void 0:j.message)||"Failed to check in asset")}},y=u.filter(s=>{var a;return s.asset.name.toLowerCase().includes(c.toLowerCase())||s.asset.asset_code.toLowerCase().includes(c.toLowerCase())||((a=s.user.name)==null?void 0:a.toLowerCase().includes(c.toLowerCase()))||s.user.email.toLowerCase().includes(c.toLowerCase())}),D=s=>{switch(s){case"checked_out":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400";case"checked_in":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400"}};return v&&u.length===0?e.jsx(E,{message:"Loading checkouts"}):e.jsxs("div",{className:"flex flex-col p-4 md:p-6 lg:p-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[e.jsx(g,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"}),"Asset Check-in/Check-out"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:"Track asset assignments and manage check-in/check-out operations"})]}),l&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Checkouts"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:l.totalCheckouts})]}),e.jsx(g,{className:"w-10 h-10 text-blue-600 dark:text-blue-400 opacity-50"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Currently Out"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:l.currentCheckouts})]}),e.jsx(w,{className:"w-10 h-10 text-yellow-600 dark:text-yellow-400 opacity-50"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Overdue"}),e.jsx("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:l.overdueCheckouts})]}),e.jsx($,{className:"w-10 h-10 text-red-600 dark:text-red-400 opacity-50"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Returned"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:l.totalReturned})]}),e.jsx(M,{className:"w-10 h-10 text-green-600 dark:text-green-400 opacity-50"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Avg Days"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:Math.round(l.avgCheckoutDays)})]}),e.jsx(f,{className:"w-10 h-10 text-purple-600 dark:text-purple-400 opacity-50"})]})})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search by asset, code, or user...",value:c,onChange:s=>L(s.target.value),className:"w-full pl-10 pr-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5 text-gray-400"}),e.jsxs("select",{value:i,onChange:s=>O(s.target.value),className:"px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"checked_out",children:"Checked Out"}),e.jsx("option",{value:"checked_in",children:"Checked In"})]})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n,onChange:s=>_(s.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Overdue Only"})]}),e.jsxs("button",{onClick:()=>d("/checkout/new"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),"New Checkout"]}),e.jsxs("button",{onClick:()=>d("/checkout/scan"),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5"}),"Scan QR"]})]})}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:y.length===0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-12 text-center",children:[e.jsx(g,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"No checkouts found"}),e.jsxs("button",{onClick:()=>d("/checkout/new"),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors inline-flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),"Create First Checkout"]})]}):y.map(s=>e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>d(`/checkout/${s.id}`),children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[s.asset.image_url&&e.jsx("img",{src:s.asset.image_url,alt:s.asset.name,className:"w-24 h-24 object-cover rounded-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:s.asset.name}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[s.asset.asset_code," â€¢ ",s.asset.asset_type]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${D(s.status)}`,children:s.status.replace("_"," ").toUpperCase()}),s.isOverdue&&e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",children:[s.daysOverdue," ",s.daysOverdue===1?"day":"days"," overdue"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsxs("span",{children:["Checked out to: ",s.user.name||s.user.email]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx(f,{className:"w-4 h-4"}),e.jsxs("span",{children:["Checkout: ",new Date(s.checkoutDate).toLocaleDateString()]})]}),s.expectedReturnDate&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx(w,{className:"w-4 h-4"}),e.jsxs("span",{children:["Expected: ",new Date(s.expectedReturnDate).toLocaleDateString()]})]}),s.location&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx("span",{children:s.location})]}),s.purpose&&e.jsxs("div",{className:"col-span-full text-gray-600 dark:text-gray-400",children:["Purpose: ",s.purpose]})]}),s.status==="checked_out"&&e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),A(s.id)},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm",children:"Check In"}),e.jsx("button",{onClick:t=>{t.stopPropagation(),d(`/checkout/${s.id}/edit`)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"Edit"})]})]})]})},s.id))})]})}export{X as default};
