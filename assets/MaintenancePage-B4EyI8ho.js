import{u as O,r,h as U,f as x,z as q,j as e,Y as j,T as I,x as R,L as Y,k as Q,C as V}from"./index-BqeTFePD.js";import{showConfirm as k,showSuccess as w,showError as v}from"./sweetalert-BCvQYi5m.js";import{P as _}from"./plus-BqUgelB7.js";import{C as B}from"./calendar-BmHkuKbT.js";import{C as f}from"./circle-check-big-C-tnlc5j.js";import{T as N}from"./triangle-alert-1WqGDf0I.js";import{D as G}from"./dollar-sign-C49L55sU.js";function te(){const o=O(),[C,S]=r.useState([]),[i,D]=r.useState(null),[A,p]=r.useState(!0),L=U(A,2e3),[g,T]=r.useState(""),[d,F]=r.useState("all"),[c,M]=r.useState("all"),[n,m]=r.useState("all");r.useEffect(()=>{h(),u()},[d,c,n]);const h=async()=>{try{p(!0);const t=x();let a="/maintenance";n==="upcoming"?a="/maintenance/upcoming?days=30":n==="overdue"&&(a="/maintenance/overdue");const s=new URLSearchParams;d!=="all"&&s.append("status",d),c!=="all"&&s.append("priority",c);const l=await t.get(`${a}?${s.toString()}`);S(l.data)}catch(t){console.error("Failed to fetch maintenance schedules:",t),q.error("Failed to load maintenance schedules")}finally{p(!1)}},u=async()=>{try{const a=await x().get("/maintenance/stats/overview");D(a.data)}catch(t){console.error("Failed to fetch stats:",t)}},$=async t=>{if((await k("Complete Maintenance?","Mark this maintenance task as completed?","Yes, complete it","Cancel")).isConfirmed)try{await x().post(`/maintenance/${t}/complete`,{status:"completed",notes:""}),await w("Success!","Maintenance task completed successfully"),h(),u()}catch(s){console.error("Failed to complete maintenance:",s),await v("Error","Failed to complete maintenance task")}},P=async t=>{if((await k("Delete Schedule?","Are you sure you want to delete this maintenance schedule?","Yes, delete it","Cancel")).isConfirmed)try{await x().delete(`/maintenance/${t}`),await w("Deleted!","Maintenance schedule deleted successfully"),h(),u()}catch(s){console.error("Failed to delete maintenance schedule:",s),await v("Error","Failed to delete maintenance schedule")}},E=t=>{switch(t){case"critical":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400";case"high":return"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400";case"medium":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400";case"low":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-400"}},z=t=>{const a=new Date,s=new Date(t),l=Math.ceil((s.getTime()-a.getTime())/(1e3*60*60*24));return l<0?{text:"Overdue",color:"text-red-600 dark:text-red-400",icon:N}:l<=7?{text:"Due soon",color:"text-orange-600 dark:text-orange-400",icon:V}:{text:"Scheduled",color:"text-green-600 dark:text-green-400",icon:f}},y=C.filter(t=>{if(!g)return!0;const a=g.toLowerCase();return t.title.toLowerCase().includes(a)||t.asset.name.toLowerCase().includes(a)||t.asset.asset_code.toLowerCase().includes(a)});return e.jsxs("div",{className:"flex flex-col p-4 md:p-6 lg:p-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[e.jsx(j,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"}),"Maintenance Management"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:"Schedule and track asset maintenance tasks"})]}),e.jsxs("button",{onClick:()=>o("/maintenance/new"),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(_,{className:"w-5 h-5"}),"Schedule Maintenance"]})]})}),i&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Total Schedules"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white mt-2",children:i.totalSchedules})]}),e.jsx(B,{className:"w-10 h-10 text-blue-600 dark:text-blue-400"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Active"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 dark:text-green-400 mt-2",children:i.activeSchedules})]}),e.jsx(f,{className:"w-10 h-10 text-green-600 dark:text-green-400"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Overdue"}),e.jsx("p",{className:"text-3xl font-bold text-red-600 dark:text-red-400 mt-2",children:i.overdueSchedules})]}),e.jsx(N,{className:"w-10 h-10 text-red-600 dark:text-red-400"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Completed (30d)"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400 mt-2",children:i.completedLast30Days})]}),e.jsx(I,{className:"w-10 h-10 text-blue-600 dark:text-blue-400"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Cost (30d)"}),e.jsxs("p",{className:"text-3xl font-bold text-purple-600 dark:text-purple-400 mt-2",children:["R",i.totalCostLast30Days.toFixed(2)]})]}),e.jsx(G,{className:"w-10 h-10 text-purple-600 dark:text-purple-400"})]})})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("button",{onClick:()=>m("all"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${n==="all"?"bg-blue-600 text-white":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:"All Schedules"}),e.jsx("button",{onClick:()=>m("upcoming"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${n==="upcoming"?"bg-blue-600 text-white":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:"Upcoming (30 days)"}),e.jsx("button",{onClick:()=>m("overdue"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${n==="overdue"?"bg-red-600 text-white":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:"Overdue"})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:g,onChange:t=>T(t.target.value),placeholder:"Search schedules...",className:"w-full pl-10 pr-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Status"}),e.jsxs("select",{value:d,onChange:t=>F(t.target.value),className:"w-full px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Priority"}),e.jsxs("select",{value:c,onChange:t=>M(t.target.value),className:"w-full px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"all",children:"All Priorities"}),e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]})]})}),L?e.jsx(Y,{message:"Loading maintenance schedules"}):e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:y.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(j,{className:"w-16 h-16 text-gray-300 dark:text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No maintenance schedules found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Get started by creating your first maintenance schedule"}),e.jsx("button",{onClick:()=>o("/maintenance/new"),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Schedule Maintenance"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Asset"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Title"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Priority"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Next Due"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Assigned To"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:y.map(t=>{var l,b;const a=z(t.nextDueDate),s=a.icon;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:t.asset.name}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.asset.asset_code})]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:t.title}),t.description&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 line-clamp-1",children:t.description})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white capitalize",children:t.scheduleType}),t.frequency&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 capitalize",children:t.frequency})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-3 py-1 text-xs rounded-full ${E(t.priority)}`,children:t.priority})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s,{className:`w-4 h-4 ${a.color}`}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:Q(t.nextDueDate)}),e.jsx("div",{className:`text-xs ${a.color}`,children:a.text})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:((l=t.assignedTo)==null?void 0:l.name)||((b=t.assignedTo)==null?void 0:b.email)||"Unassigned"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-3 py-1 text-xs rounded-full ${t.isActive?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-400"}`,children:t.isActive?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>o(`/maintenance/${t.id}`),className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:"View"}),t.isActive&&e.jsx("button",{onClick:()=>$(t.id),className:"text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300",children:"Complete"}),e.jsx("button",{onClick:()=>P(t.id),className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",children:"Delete"})]})})]},t.id)})})]})})})]})}export{te as default};
