import{u as A,l as S,r as d,e as i,j as e,P as p,F}from"./index-D8B7AIac.js";import{showError as b,showSuccess as y}from"./sweetalert-BCvQYi5m.js";import{A as D}from"./arrow-left-Cr30uiaR.js";import{C as I}from"./calendar-D0RNAj50.js";import{M as E}from"./map-pin-B_t5qnba.js";function U(){const u=A(),{id:c}=S(),r=c&&c!=="new",[x,g]=d.useState(!1),[k,m]=d.useState([]),[f,j]=d.useState([]),[o,h]=d.useState({assetId:"",userId:"",expectedReturnDate:"",location:"",purpose:"",notes:"",condition:"good"});d.useEffect(()=>{w(),N(),r&&v()},[r,c]);const w=async()=>{try{const s=await i().get("/assets"),a=Array.isArray(s.data)?s.data:s.data.assets||[];m(r?a:a.filter(l=>l.checkoutStatus==="available"))}catch(t){console.error("Failed to fetch assets:",t)}},N=async()=>{try{const s=await i().get("/users"),a=Array.isArray(s.data)?s.data:s.data.users||[];j(a)}catch(t){console.error("Failed to fetch users:",t)}},v=async()=>{try{const a=(await i().get(`/checkout/${c}`)).data;h({assetId:a.assetId,userId:a.userId,expectedReturnDate:a.expectedReturnDate?new Date(a.expectedReturnDate).toISOString().split("T")[0]:"",location:a.location||"",purpose:a.purpose||"",notes:a.notes||"",condition:a.condition||"good"})}catch(t){console.error("Failed to fetch checkout:",t),await b("Error","Failed to load checkout details")}},C=async t=>{var s,a;t.preventDefault(),g(!0);try{const l=i();r?(await l.put(`/checkout/${c}`,o),await y("Success!","Checkout updated successfully")):(await l.post("/checkout",o),await y("Success!","Asset checked out successfully")),u("/checkout")}catch(l){console.error("Failed to save checkout:",l),await b("Error",((a=(s=l.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to save checkout")}finally{g(!1)}},n=t=>{const{name:s,value:a}=t.target;h(l=>({...l,[s]:a}))};return e.jsxs("div",{className:"flex flex-col p-4 md:p-6 lg:p-8 max-w-4xl mx-auto w-full",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>u("/checkout"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white mb-4",children:[e.jsx(D,{className:"w-5 h-5"}),"Back to Checkouts"]}),e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[e.jsx(p,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"}),r?"Edit Checkout":"Check Out Asset"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:r?"Update checkout details":"Assign an asset to a user"})]}),e.jsxs("form",{onSubmit:C,className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 max-w-4xl",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Asset ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"assetId",value:o.assetId,onChange:n,required:!0,disabled:r,className:"w-full px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 dark:disabled:bg-gray-700 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"Select an asset"}),k.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.asset_code,") - ",t.asset_type]},t.id))]}),r&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Asset cannot be changed after checkout"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Assign To ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"userId",value:o.userId,onChange:n,required:!0,className:"w-full px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select a user"}),f.map(t=>e.jsxs("option",{value:t.id,children:[t.name||t.email," (",t.email,")"]},t.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(I,{className:"w-4 h-4 inline mr-1"}),"Expected Return Date"]}),e.jsx("input",{type:"date",name:"expectedReturnDate",value:o.expectedReturnDate,onChange:n,min:new Date().toISOString().split("T")[0],className:"w-full px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Asset Condition ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"condition",value:o.condition,onChange:n,required:!0,className:"w-full px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"excellent",children:"Excellent"}),e.jsx("option",{value:"good",children:"Good"}),e.jsx("option",{value:"fair",children:"Fair"}),e.jsx("option",{value:"poor",children:"Poor"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(E,{className:"w-4 h-4 inline mr-1"}),"Location"]}),e.jsx("input",{type:"text",name:"location",value:o.location,onChange:n,placeholder:"e.g., Office 301, Remote Work, etc.",className:"w-full px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(F,{className:"w-4 h-4 inline mr-1"}),"Purpose"]}),e.jsx("input",{type:"text",name:"purpose",value:o.purpose,onChange:n,placeholder:"e.g., Project work, Training, Remote work setup",className:"w-full px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Additional Notes"}),e.jsx("textarea",{name:"notes",value:o.notes,onChange:n,rows:3,placeholder:"Any additional information...",className:"w-full px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-8",children:[e.jsx("button",{type:"button",onClick:()=>u("/checkout"),className:"px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:x,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition-colors flex items-center gap-2",children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-5 h-5"}),r?"Update Checkout":"Check Out"]})})]})]})]})}export{U as default};
