import{u as z,r as l,j as e}from"./index-B2LBA6Oe.js";import{u as P}from"./store-BPn9-EER.js";import{l as W}from"./api-BUVJA4bF.js";import{l as I}from"./api-CrNvfTMq.js";import{showSuccess as q,showError as O}from"./sweetalert-BCvQYi5m.js";import"./types-D8_qC6eW.js";function G(){const p=z(),{createTicket:B,isLoading:m}=P(),[r,u]=l.useState({title:"",description:"",priority:"medium",assetId:"",createdById:""}),[L,D]=l.useState([]),[n,A]=l.useState([]),[k,T]=l.useState(!0),[i,w]=l.useState({}),[a,E]=l.useState(null),[d,h]=l.useState(""),[N,y]=l.useState(!1),[o,v]=l.useState(null);l.useEffect(()=>{const t=localStorage.getItem("user");if(t){const s=JSON.parse(t);E(s)}},[]),l.useEffect(()=>{a&&(async()=>{try{const s=await W();D(s);const c=s.find(j=>j.email===(a==null?void 0:a.email));a&&a.role!=="ADMIN"&&c&&u(j=>({...j,createdById:c.id}));let x;a&&a.role!=="ADMIN"&&c?x=await I({ownerId:c.id}):x=await I(),A(x)}catch(s){console.error("Error fetching data:",s)}finally{T(!1)}})()},[a]);const g=t=>{const{name:s,value:c}=t.target;u(x=>({...x,[s]:c})),i[s]&&w(x=>({...x,[s]:""}))},b=l.useMemo(()=>{if(!d.trim())return n;const t=d.toLowerCase();return n.filter(s=>s.asset_code.toLowerCase().includes(t)||s.name.toLowerCase().includes(t)||s.status.toLowerCase().includes(t)||s.category&&s.category.toLowerCase().includes(t))},[n,d]),F=t=>{v(t),u(s=>({...s,assetId:t.id})),h(""),y(!1)},M=()=>{v(null),u(t=>({...t,assetId:""})),h("")},C=t=>{switch(t.toLowerCase()){case"available":return"text-green-600 bg-green-50";case"in_use":return"text-blue-600 bg-blue-50";case"maintenance":return"text-yellow-600 bg-yellow-50";case"retired":return"text-gray-600 bg-gray-50";default:return"text-gray-600 bg-gray-50"}},S=t=>{switch(t.toLowerCase()){case"available":return"âœ“";case"in_use":return"â—";case"maintenance":return"âš ";case"retired":return"âœ•";default:return"â—‹"}},_=()=>{const t={};return r.title.trim()||(t.title="Title is required"),r.description.trim()||(t.description="Description is required"),r.createdById.trim()||(t.createdById="Please select who is creating this ticket"),w(t),Object.keys(t).length===0},$=async t=>{if(t.preventDefault(),!m&&_())try{const s={title:r.title,description:r.description,priority:r.priority,createdById:r.createdById,assetId:r.assetId||null},c=await B(s);await q("Success!","Ticket created successfully!",1500),p(`/tickets/${c.id}`)}catch(s){await O("Error","Failed to create ticket. Please try again."),console.error("Error creating ticket:",s)}};if(k)return e.jsx("div",{className:"p-8",children:"Loading form data..."});const f=(a==null?void 0:a.role)==="ADMIN";return e.jsxs("div",{className:"p-8 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("button",{onClick:()=>p("/tickets"),className:"text-blue-600 hover:text-blue-800 mb-4",children:"â† Back to Tickets"}),e.jsx("h1",{className:"text-3xl font-bold dark:text-white",children:"Create New Ticket"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Fill in the details to create a new support ticket"})]}),e.jsxs("form",{onSubmit:$,className:"bg-white dark:bg-gray-800 rounded-lg shadow p-8 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"title",className:"block text-sm font-medium dark:text-gray-200 mb-2",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"title",name:"title",value:r.title,onChange:g,className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 ${i.title?"border-red-500":"border-gray-300"}`,placeholder:"Enter ticket title"}),i.title&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:i.title})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"description",className:"block text-sm font-medium dark:text-gray-200 mb-2",children:["Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:"description",name:"description",value:r.description,onChange:g,rows:6,className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 ${i.description?"border-red-500":"border-gray-300"}`,placeholder:"Describe the issue in detail..."}),i.description&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:i.description})]}),f&&e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"createdById",className:"block text-sm font-medium dark:text-gray-200 mb-2",children:["Created By ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"createdById",name:"createdById",value:r.createdById,onChange:g,className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 ${i.createdById?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Select a user"}),L.map(t=>e.jsxs("option",{value:t.id,children:[t.name||t.email," (",t.email,")"]},t.id))]}),i.createdById&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:i.createdById})]}),!f&&e.jsx("input",{type:"hidden",name:"createdById",value:r.createdById}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"priority",className:"block text-sm font-medium dark:text-gray-200 mb-2",children:"Priority"}),e.jsxs("select",{id:"priority",name:"priority",value:r.priority,onChange:g,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"critical",children:"Critical"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("label",{htmlFor:"assetSearch",className:"block text-sm font-medium dark:text-gray-200 mb-2",children:["Related Asset (Optional)",n.length>0&&e.jsx("span",{className:"ml-2 text-xs text-gray-500 font-normal",children:f?`${n.length} assets available`:`${n.length} of your assets`})]}),o?e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"w-full px-4 py-3 border-2 border-blue-500 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("span",{className:"text-2xl",children:"ðŸ”§"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:o.asset_code}),e.jsxs("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${C(o.status)}`,children:[S(o.status)," ",o.status.replace("_"," ")]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 truncate",children:o.name}),o.category&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:o.category})]})]}),e.jsx("button",{type:"button",onClick:M,className:"ml-2 p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-full transition-colors",title:"Clear selection",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["âœ“ This ticket will be linked to ",e.jsx("strong",{children:o.asset_code})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",id:"assetSearch",value:d,onChange:t=>h(t.target.value),onFocus:()=>y(!0),onBlur:()=>setTimeout(()=>y(!1),200),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:n.length>0?"Search by code, name, or category...":"No assets available",disabled:n.length===0}),d&&e.jsx("button",{type:"button",onClick:()=>h(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),N&&b.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-64 overflow-y-auto",children:b.map(t=>e.jsx("button",{type:"button",onClick:()=>F(t),className:"w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 border-b border-gray-100 dark:border-gray-700 last:border-b-0 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl",children:"ðŸ”§"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:t.asset_code}),e.jsxs("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${C(t.status)}`,children:[S(t.status)," ",t.status.replace("_"," ")]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 truncate",children:t.name}),t.category&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:["ðŸ“‚ ",t.category]})]})]})},t.id))}),N&&d&&b.length===0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg p-4 text-center",children:e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:['No assets found matching "',d,'"']})}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"ðŸ’¡ Link this ticket to a specific asset/equipment if the issue is related to hardware"}),n.length===0&&e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-500",children:"âš ï¸ You don't have any assets assigned yet"})]})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs("button",{type:"submit",disabled:m||k,className:"px-6 py-2 min-h-[44px] bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:[m&&e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),m?"Creating Ticket...":"Create Ticket"]}),e.jsx("button",{type:"button",onClick:()=>p("/tickets"),className:"px-6 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"})]})]})]})}export{G as default};
