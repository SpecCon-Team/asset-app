import{u as R,h as O,i as L,r as m,j as e}from"./react-vendor-DE6j8A-W.js";import{showError as u,showSuccess as k}from"./sweetalert-C-QUKjab.js";import{u as M,a as v,L as A}from"./index-DvOGtWmT.js";import{ai as G,at as B,au as W,a2 as K,f as Z,T as H}from"./ui-libs-Cv444JcM.js";import"./export-libs-C_ZIqR8y.js";import"./vendor-DIIGlvtc.js";const U=[{id:"WC",name:"Western Cape",color:"#FF9800"},{id:"EC",name:"Eastern Cape",color:"#8D6E63"},{id:"NC",name:"Northern Cape",color:"#42A5F5"},{id:"FS",name:"Free State",color:"#FFC107"},{id:"KZN",name:"KwaZulu-Natal",color:"#616161"},{id:"NW",name:"North West",color:"#9E9E9E"},{id:"GP",name:"Gauteng",color:"#64B5F6"},{id:"MP",name:"Mpumalanga",color:"#3F51B5"},{id:"LP",name:"Limpopo",color:"#8BC34A"}];function X(){const c=R(),{tripId:x}=O(),[f]=L(),[V,b]=m.useState([]),[l,g]=m.useState([]),[S,p]=m.useState(!0),[j,N]=m.useState(!1),C=M(S,2e3);m.useEffect(()=>{var t;if(x)D(x);else{const a=((t=f.get("clients"))==null?void 0:t.split(","))||[];if(a.length===0){u("No Clients","No clients selected. Please go back and select clients."),c("/travel-plan/peg-route-creator");return}T(a)}},[x,f,c]);const D=async t=>{try{p(!0);const r=(await v().get(`/travel/${t}/route`)).data;if(!r||!r.routeStops){u("Route Not Found","The travel plan route could not be found."),c("/travel-plan");return}const o=r.routeStops.map(n=>({id:n.id,clientId:n.clientId,client:n.client,visitDate:new Date(n.visitDate).toISOString().split("T")[0],visitTime:n.visitTime||"09:00",duration:n.duration||60,notes:n.notes||"",order:n.order}));g(o),b(o.map(n=>n.client))}catch(a){console.error("Error loading route:",a),u("Error","Failed to load travel plan route"),c("/travel-plan")}finally{p(!1)}},T=async t=>{try{p(!0);const o=(await v().get("/peg")).data.filter(s=>t.includes(s.id));b(o);const n=o.map((s,y)=>{const P=new Date().toISOString().split("T")[0],F=9+y*2,$=`${String(F).padStart(2,"0")}:00`;return{clientId:s.id,client:s,visitDate:P,visitTime:$,duration:60,notes:"",order:y+1}});g(n)}catch(a){console.error("Error loading clients:",a),u("Error","Failed to load clients")}finally{p(!1)}},h=(t,a,i)=>{g(r=>r.map((o,n)=>n===t?{...o,[a]:i}:o))},E=t=>{g(a=>a.filter((r,o)=>o!==t).map((r,o)=>({...r,order:o+1})))},w=(t,a)=>{a==="up"&&t===0||a==="down"&&t===l.length-1||g(i=>{const r=[...i],o=a==="up"?t-1:t+1;return[r[t],r[o]]=[r[o],r[t]],r.map((n,s)=>({...n,order:s+1}))})},I=async()=>{var t,a;if(l.length===0){u("No Stops","Please add at least one client to the route");return}for(const i of l)if(!i.visitDate||!i.visitTime){u("Missing Information","Please fill in date and time for all stops");return}try{N(!0);const i=v(),r=l.map(s=>new Date(`${s.visitDate}T${s.visitTime}`)),o=new Date(Math.min(...r.map(s=>s.getTime()))),n=new Date(Math.max(...r.map(s=>s.getTime())));if(x){for(const s of l)s.id&&await i.put(`/travel/route-stops/${s.id}`,{visitDate:new Date(`${s.visitDate}T${s.visitTime}`).toISOString(),visitTime:s.visitTime,duration:s.duration,notes:s.notes,order:s.order});await i.put(`/travel/${x}`,{startDate:o.toISOString(),endDate:n.toISOString()}),k("Updated!","Travel plan route updated successfully",2e3),c("/travel-plan")}else{const s={destination:`PEG Route - ${l.length} clients`,country:"South Africa",startDate:o.toISOString(),endDate:n.toISOString(),category:"business",status:"upcoming",budget:0,spent:0,notes:`Route visiting ${l.length} PEG clients`,routeStops:l.map(d=>({clientId:d.clientId,visitDate:new Date(`${d.visitDate}T${d.visitTime}`).toISOString(),visitTime:d.visitTime,duration:d.duration,notes:d.notes,order:d.order}))},y=await i.post("/travel/peg-route",s);k("Route Created!","Your PEG client route has been created successfully"),c("/travel-plan")}}catch(i){console.error("Error saving route:",i),u("Error",((a=(t=i.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to save route")}finally{N(!1)}};return C?e.jsx(A,{message:"Loading route editor..."}):e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>c(x?"/travel-plan":"/travel-plan/peg-route-creator"),className:"flex items-center gap-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white mb-4",children:[e.jsx(G,{className:"w-5 h-5"}),"Back to Client Selection"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Edit Route Schedule"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Set dates and times for each client visit"})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-300",children:[l.length," client",l.length!==1?"s":""," in route"]}),e.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-400 mt-1",children:l.map(t=>t.client.name).join(" → ")})]}),e.jsxs("button",{onClick:I,disabled:j||l.length===0,className:"flex items-center gap-2 px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg font-medium transition-colors",children:[e.jsx(B,{className:"w-5 h-5"}),j?"Saving...":"Save Route"]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider w-12",children:"Order"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Client"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Province"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Duration"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Notes"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider w-24",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:l.map((t,a)=>{const i=U.find(r=>r.id===t.client.provinceId);return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-gray-400 cursor-move"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.order})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.client.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.client.location})]})}),e.jsx("td",{className:"px-4 py-3",children:i&&e.jsx("span",{className:"px-2 py-1 text-xs font-medium text-white rounded",style:{backgroundColor:i.color},children:i.name})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"date",value:t.visitDate,onChange:r=>h(a,"visitDate",r.target.value),className:"pl-8 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm focus:ring-2 focus:ring-blue-500"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"time",value:t.visitTime,onChange:r=>h(a,"visitTime",r.target.value),className:"pl-8 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm focus:ring-2 focus:ring-blue-500"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("select",{value:t.duration,onChange:r=>h(a,"duration",parseInt(r.target.value)),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:30,children:"30 min"}),e.jsx("option",{value:60,children:"1 hour"}),e.jsx("option",{value:90,children:"1.5 hours"}),e.jsx("option",{value:120,children:"2 hours"}),e.jsx("option",{value:180,children:"3 hours"}),e.jsx("option",{value:240,children:"4 hours"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"text",value:t.notes,onChange:r=>h(a,"notes",r.target.value),placeholder:"Notes...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm focus:ring-2 focus:ring-blue-500"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>w(a,"up"),disabled:a===0,className:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 disabled:opacity-30",title:"Move up",children:"↑"}),e.jsx("button",{onClick:()=>w(a,"down"),disabled:a===l.length-1,className:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 disabled:opacity-30",title:"Move down",children:"↓"}),e.jsx("button",{onClick:()=>E(a),className:"p-1 text-red-400 hover:text-red-600",title:"Remove",children:e.jsx(H,{className:"w-4 h-4"})})]})})]},t.clientId)})})]})})}),l.length===0&&e.jsx("div",{className:"text-center py-12 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No clients in route"})})]})}export{X as default};
