import{u as A,r as s,j as e,H as k,z as g}from"./index-DWJKKC5Z.js";import{L as v}from"./loader-circle-B-9aQNLC.js";import{E as L}from"./eye-THljmKet.js";import{E as O}from"./eye-off-B6hsQ0Ww.js";function V(){const n=A(),[d,N]=s.useState(""),[u,S]=s.useState(""),[i,x]=s.useState(!1),[p,c]=s.useState(""),[y,C]=s.useState(!1),[m,f]=s.useState({email:!1,password:!1}),[F,b]=s.useState(!1),[E,T]=s.useState(""),[l,w]=s.useState(""),j=r=>{f({...m,[r]:!0})},P=async r=>{r.preventDefault(),x(!0),c(""),f({email:!0,password:!0});try{const t=await fetch("http://localhost:4000/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:d,password:u})});if(!t.ok){const h=t.headers.get("content-type");let o;if(h&&h.includes("application/json")?o=await t.json():o={message:await t.text()},t.status===429)throw g.error("Too many login attempts. Please wait 15 minutes before trying again.",{duration:5e3}),new Error(o.message||"Too many requests. Please try again later.");if(t.status===403&&o.emailVerified===!1){g.error(o.message||"Please verify your email before logging in"),n("/verify-otp",{state:{email:o.email||d}});return}throw new Error(o.message||"Login failed")}const a=await t.json();if(a.requiresTwoFactor){b(!0),T(a.userId),g.success("Password accepted. Please enter your 2FA code.");return}localStorage.setItem("user",JSON.stringify(a.user)),localStorage.setItem("token",a.token),g.success("Login successful!"),a.user.role==="ADMIN"||a.user.role==="TECHNICIAN"?n("/"):n("/my-tickets")}catch(t){c(t instanceof Error?t.message:"Login failed. Please try again.")}finally{x(!1)}},I=async r=>{r.preventDefault(),x(!0),c("");try{const t=await fetch("http://localhost:4000/api/auth/verify-2fa-login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({userId:E,token:l})});if(!t.ok){const h=await t.json();throw new Error(h.message||"2FA verification failed")}const a=await t.json();localStorage.setItem("user",JSON.stringify(a.user)),localStorage.setItem("token",a.token),g.success("Login successful!"),a.user.role==="ADMIN"||a.user.role==="TECHNICIAN"?n("/"):n("/my-tickets")}catch(t){c(t instanceof Error?t.message:"2FA verification failed. Please try again.")}finally{x(!1)}};return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex w-16 h-16 rounded-full items-center justify-center mb-4",style:{backgroundColor:"var(--color-primary)"},children:e.jsx("span",{className:"text-white font-bold text-2xl",children:"AT"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Welcome to AssetTrack Pro"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8",children:[p&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-700 rounded-lg text-red-700 dark:text-red-300 text-sm",children:p}),F?e.jsxs("form",{onSubmit:I,className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Two-Factor Authentication"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Enter the 6-digit code from your authenticator app or an 8-character backup code"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"twoFactorCode",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Verification Code"}),e.jsx("input",{id:"twoFactorCode",type:"text",value:l,onChange:r=>w(r.target.value.replace(/[^0-9A-Fa-f]/g,"").toUpperCase()),placeholder:"000000 or backup code",maxLength:8,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-center text-2xl font-mono tracking-widest focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":"var(--color-primary)"},autoFocus:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{b(!1),w(""),c("")},className:"flex-1 px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-900 dark:text-white rounded-lg font-medium transition-colors",children:"Back"}),e.jsx("button",{type:"submit",disabled:i||l.length!==6&&l.length!==8,className:"flex-1 text-white py-3 rounded-lg font-medium disabled:bg-gray-400 transition-opacity hover:opacity-90 flex items-center justify-center gap-2",style:{backgroundColor:i||l.length!==6&&l.length!==8?void 0:"var(--color-primary)"},children:i?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Verifying..."})]}):"Verify"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:P,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email"}),e.jsx("input",{id:"email",type:"email",value:d,onChange:r=>N(r.target.value),onBlur:()=>j("email"),placeholder:"you@example.com",className:`w-full px-4 py-3 border ${m.email&&!d?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"} rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 focus:ring-2 focus:border-transparent`,style:{"--tw-ring-color":"var(--color-primary)"}}),m.email&&!d&&e.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-400",children:"This field is required"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"password",type:y?"text":"password",value:u,onChange:r=>S(r.target.value),onBlur:()=>j("password"),placeholder:"••••••••••••",className:`w-full px-4 py-3 pr-12 border ${m.password&&!u?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"} rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 focus:ring-2 focus:border-transparent`,style:{"--tw-ring-color":"var(--color-primary)"}}),e.jsx("button",{type:"button",onClick:()=>C(!y),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 focus:outline-none","aria-label":y?"Hide password":"Show password",children:y?e.jsx(L,{className:"w-5 h-5"}):e.jsx(O,{className:"w-5 h-5"})})]}),m.password&&!u&&e.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-400",children:"This field is required"})]}),e.jsx("button",{type:"submit",disabled:i,className:"w-full text-white py-3 rounded-lg font-medium disabled:bg-gray-400 transition-opacity hover:opacity-90 flex items-center justify-center gap-2",style:{backgroundColor:i?void 0:"var(--color-primary)"},children:i?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Signing in..."})]}):"Sign in"})]}),e.jsxs("div",{className:"mt-6 text-center space-y-3",children:[e.jsx(k,{to:"/forgot-password",className:"text-sm block transition-opacity hover:opacity-80",style:{color:"var(--color-primary)"},children:"Forgot password?"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Don't have an account?"," ",e.jsx(k,{to:"/signup",className:"font-medium transition-opacity hover:opacity-80",style:{color:"var(--color-primary)"},children:"Sign up"})]})]})]})]})]})})}export{V as default};
