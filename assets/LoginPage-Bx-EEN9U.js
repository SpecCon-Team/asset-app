import{J as q,e as B,u as U,r as s,j as e,K as N,z as u}from"./index-DgA6g9AM.js";import{L as S}from"./loader-circle-CPiJRDUE.js";import{E as V}from"./eye-q1u-E8zn.js";import{E as z}from"./eye-off-Gdji5VwS.js";const h=q.create({baseURL:B(),withCredentials:!0});h.interceptors.request.use(o=>{const l=localStorage.getItem("token");return l&&(o.headers.Authorization=`Bearer ${l}`),o});function $(){const o=U(),[l,C]=s.useState(""),[x,F]=s.useState(""),[i,y]=s.useState(!1),[f,n]=s.useState(""),[p,I]=s.useState(!1),[m,b]=s.useState({email:!1,password:!1}),[A,w]=s.useState(!1),[P,T]=s.useState(""),[d,k]=s.useState(""),j=a=>{b({...m,[a]:!0})},E=async a=>{var g,c;a.preventDefault(),y(!0),n(""),b({email:!0,password:!0});try{const t=(await h.post("/auth/login",{email:l,password:x})).data;if(t.requiresTwoFactor){w(!0),T(t.userId),u.success("Password accepted. Please enter your 2FA code.");return}localStorage.setItem("user",JSON.stringify(t.user)),localStorage.setItem("token",t.token),u.success("Login successful!"),t.user.role==="ADMIN"||t.user.role==="TECHNICIAN"?o("/"):o("/my-tickets")}catch(r){const t=(g=r.response)==null?void 0:g.data,v=(c=r.response)==null?void 0:c.status;v===429?(u.error("Too many login attempts. Please wait 15 minutes before trying again.",{duration:5e3}),n("Too many requests. Please try again later.")):v===403&&(t==null?void 0:t.emailVerified)===!1?(u.error(t.message||"Please verify your email before logging in"),o("/verify-otp",{state:{email:t.email||l}})):n((t==null?void 0:t.message)||r.message||"Login failed. Please try again.")}finally{y(!1)}},L=async a=>{var g;a.preventDefault(),y(!0),n("");try{const r=(await h.post("/auth/verify-2fa-login",{userId:P,token:d})).data;localStorage.setItem("user",JSON.stringify(r.user)),localStorage.setItem("token",r.token),u.success("Login successful!"),r.user.role==="ADMIN"||r.user.role==="TECHNICIAN"?o("/"):o("/my-tickets")}catch(c){const r=(g=c.response)==null?void 0:g.data;n((r==null?void 0:r.message)||c.message||"2FA verification failed. Please try again.")}finally{y(!1)}};return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex w-16 h-16 rounded-full items-center justify-center mb-4",style:{backgroundColor:"var(--color-primary)"},children:e.jsx("span",{className:"text-white font-bold text-2xl",children:"AT"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Welcome to AssetTrack Pro"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8",children:[f&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-700 rounded-lg text-red-700 dark:text-red-300 text-sm",children:f}),A?e.jsxs("form",{onSubmit:L,className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Two-Factor Authentication"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Enter the 6-digit code from your authenticator app or an 8-character backup code"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"twoFactorCode",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Verification Code"}),e.jsx("input",{id:"twoFactorCode",type:"text",value:d,onChange:a=>k(a.target.value.replace(/[^0-9A-Fa-f]/g,"").toUpperCase()),placeholder:"000000 or backup code",maxLength:8,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-center text-2xl font-mono tracking-widest focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":"var(--color-primary)"},autoFocus:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{w(!1),k(""),n("")},className:"flex-1 px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-900 dark:text-white rounded-lg font-medium transition-colors",children:"Back"}),e.jsx("button",{type:"submit",disabled:i||d.length!==6&&d.length!==8,className:"flex-1 text-white py-3 rounded-lg font-medium disabled:bg-gray-400 transition-opacity hover:opacity-90 flex items-center justify-center gap-2",style:{backgroundColor:i||d.length!==6&&d.length!==8?void 0:"var(--color-primary)"},children:i?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Verifying..."})]}):"Verify"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email"}),e.jsx("input",{id:"email",type:"email",value:l,onChange:a=>C(a.target.value),onBlur:()=>j("email"),placeholder:"you@example.com",className:`w-full px-4 py-3 border ${m.email&&!l?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"} rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 focus:ring-2 focus:border-transparent`,style:{"--tw-ring-color":"var(--color-primary)"}}),m.email&&!l&&e.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-400",children:"This field is required"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"password",type:p?"text":"password",value:x,onChange:a=>F(a.target.value),onBlur:()=>j("password"),placeholder:"••••••••••••",className:`w-full px-4 py-3 pr-12 border ${m.password&&!x?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"} rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 focus:ring-2 focus:border-transparent`,style:{"--tw-ring-color":"var(--color-primary)"}}),e.jsx("button",{type:"button",onClick:()=>I(!p),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 focus:outline-none","aria-label":p?"Hide password":"Show password",children:p?e.jsx(V,{className:"w-5 h-5"}):e.jsx(z,{className:"w-5 h-5"})})]}),m.password&&!x&&e.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-400",children:"This field is required"})]}),e.jsx("button",{type:"submit",disabled:i,className:"w-full text-white py-3 rounded-lg font-medium disabled:bg-gray-400 transition-opacity hover:opacity-90 flex items-center justify-center gap-2",style:{backgroundColor:i?void 0:"var(--color-primary)"},children:i?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Signing in..."})]}):"Sign in"})]}),e.jsxs("div",{className:"mt-6 text-center space-y-3",children:[e.jsx(N,{to:"/forgot-password",className:"text-sm block transition-opacity hover:opacity-80",style:{color:"var(--color-primary)"},children:"Forgot password?"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Don't have an account?"," ",e.jsx(N,{to:"/signup",className:"font-medium transition-opacity hover:opacity-80",style:{color:"var(--color-primary)"},children:"Sign up"})]})]})]})]})]})})}export{$ as default};
