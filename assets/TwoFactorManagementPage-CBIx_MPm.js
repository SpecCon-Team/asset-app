import{c as f,r,h as N,f as m,j as e,L as v,S as d,w as A,t as C}from"./index-B_IVq7rD.js";import{showError as g,showConfirmation as F,showTextarea as R,showSuccess as T}from"./sweetalert-BCvQYi5m.js";import{T as p}from"./triangle-alert-DnVPNnEw.js";import{K as L}from"./key-xxDHMtKL.js";import{C as S}from"./calendar-D6ErFEin.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=f("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);function W(){const[t,u]=r.useState([]),[b,i]=r.useState(!0),y=N(b,2e3),[s,k]=r.useState("");r.useEffect(()=>{n()},[]);const n=async()=>{try{i(!0);const c=await m().get("/2fa/admin/users-with-2fa");u(c.data)}catch(a){console.error("Failed to fetch users with 2FA:",a),await g("Error","Failed to load users with 2FA enabled")}finally{i(!1)}},w=async a=>{var x,h;if(!(await F("Reset 2FA?",`Are you sure you want to reset 2FA for ${a.name||a.email}? This will:

• Disable their 2FA
• Remove their backup codes
• Allow them to login without 2FA
• They can re-enable 2FA in their settings

This action will be logged in the audit trail.`,"Reset 2FA","Cancel")).isConfirmed)return;const{value:j}=await R("Reset Reason","Please provide a reason for this 2FA reset (optional)","e.g., User lost phone and backup codes",!1);try{await m().post("/2fa/admin/reset",{userId:a.id,reason:j||"No reason provided"}),await T("Success!",`2FA has been reset for ${a.name||a.email}. They can now login without 2FA.`,2e3),n()}catch(l){console.error("Failed to reset 2FA:",l),await g("Error",((h=(x=l.response)==null?void 0:x.data)==null?void 0:h.message)||"Failed to reset 2FA")}},o=t.filter(a=>a.email.toLowerCase().includes(s.toLowerCase())||a.name&&a.name.toLowerCase().includes(s.toLowerCase()));return y?e.jsx(v,{message:"Loading 2FA management..."}):e.jsxs("div",{className:"p-8 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(d,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"}),e.jsx("h1",{className:"text-3xl font-bold dark:text-white",children:"2FA Management"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Manage two-factor authentication for users who are locked out"})]}),e.jsxs("div",{className:"mb-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-lg flex gap-3",children:[e.jsx(p,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-yellow-800 dark:text-yellow-200 mb-1",children:"Admin Access Required"}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:"Resetting 2FA for a user will disable their two-factor authentication and remove all backup codes. This action is logged in the audit trail. Only use this for users who have lost access to their authenticator app and backup codes."})]})]}),e.jsx("div",{className:"mb-6",children:e.jsx("input",{type:"text",placeholder:"Search by email or name...",value:s,onChange:a=>k(a.target.value),className:"w-full max-w-md px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:e.jsx(A,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold dark:text-white",children:t.length})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/50 rounded-lg",children:e.jsx(d,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"With 2FA Enabled"}),e.jsx("p",{className:"text-2xl font-bold dark:text-white",children:t.length})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-900/50 rounded-lg",children:e.jsx(p,{className:"w-6 h-6 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Low Backup Codes"}),e.jsx("p",{className:"text-2xl font-bold dark:text-white",children:t.filter(a=>a.backupCodesRemaining<=3).length})]})]})})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:o.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(d,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:s?"No users found matching your search":"No users have 2FA enabled"})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Backup Codes"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Enabled Since"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:o.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:a.name||"No name"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a.email})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs rounded-full ${a.role==="ADMIN"?"bg-purple-100 dark:bg-purple-900/50 text-purple-800 dark:text-purple-200":a.role==="TECHNICIAN"?"bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-200":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:a.role})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:`w-4 h-4 ${a.backupCodesRemaining<=3?"text-red-500 dark:text-red-400":a.backupCodesRemaining<=5?"text-yellow-500 dark:text-yellow-400":"text-green-500 dark:text-green-400"}`}),e.jsxs("span",{className:`font-medium ${a.backupCodesRemaining<=3?"text-red-600 dark:text-red-400":a.backupCodesRemaining<=5?"text-yellow-600 dark:text-yellow-400":"text-gray-900 dark:text-white"}`,children:[a.backupCodesRemaining," / 10"]}),a.backupCodesRemaining===0&&e.jsx("span",{className:"text-xs text-red-600 dark:text-red-400",children:"(No codes left!)"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(S,{className:"w-4 h-4"}),C(a.createdAt)]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("button",{onClick:()=>w(a),className:"inline-flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:[e.jsx(U,{className:"w-4 h-4"}),"Reset 2FA"]})})]},a.id))})]})})}),e.jsxs("div",{className:"mt-8 p-6 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-900 dark:text-blue-200 mb-3",children:"When to Reset 2FA"}),e.jsxs("ul",{className:"space-y-2 text-sm text-blue-800 dark:text-blue-300",children:[e.jsx("li",{children:"• User has lost their phone and cannot access their authenticator app"}),e.jsx("li",{children:"• User has lost all backup codes and cannot login"}),e.jsx("li",{children:"• User is locked out and needs immediate access"})]}),e.jsxs("p",{className:"mt-3 text-sm text-blue-800 dark:text-blue-300",children:[e.jsx("strong",{children:"Note:"})," After resetting, the user should immediately re-enable 2FA and save their new backup codes in a secure location."]})]})]})}export{W as default};
