const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/sweetalert-DcBwdyhg.js","assets/vendor-ui-Bhgb65c8.js","assets/vendor-react-CFQdvhEG.js"])))=>i.map(i=>d[i]);
import{u as C,a as g,L as I,_ as O}from"./index-CezS3iyn.js";import{j as e}from"./vendor-charts-DVp8BQgJ.js";import{r as s}from"./vendor-react-CFQdvhEG.js";import{b as _,D as P,E as R,O as U,av as F,e as G}from"./vendor-ui-Bhgb65c8.js";function V(){const[b,j]=s.useState([]),[n,f]=s.useState(null),[k,p]=s.useState(!0),w=C(k,2e3),[x,v]=s.useState(""),[c,N]=s.useState(""),[o,E]=s.useState(""),[r,u]=s.useState(""),[d,m]=s.useState("");s.useEffect(()=>{const t=localStorage.getItem("auditLogs_startDate"),a=localStorage.getItem("auditLogs_endDate");t&&u(t),a&&m(a)},[]),s.useEffect(()=>{r?localStorage.setItem("auditLogs_startDate",r):localStorage.removeItem("auditLogs_startDate")},[r]),s.useEffect(()=>{d?localStorage.setItem("auditLogs_endDate",d):localStorage.removeItem("auditLogs_endDate")},[d]),s.useEffect(()=>{L(),S()},[c,o,r,d]);const L=async()=>{try{p(!0);const t=new URLSearchParams;c&&t.append("action",c),o&&t.append("entityType",o),r&&t.append("startDate",r),d&&t.append("endDate",d);const a=await g().get(`/audit-logs?${t.toString()}`);j(a.data.logs)}catch(t){console.error("Failed to fetch audit logs:",t)}finally{p(!1)}},S=async()=>{try{const t=await g().get("/audit-logs/stats");f(t.data)}catch(t){console.error("Failed to fetch stats:",t)}},T=async()=>{try{const t=new URLSearchParams;r&&t.append("startDate",r),d&&t.append("endDate",d);const a=await g().get(`/audit-logs/export?${t.toString()}`,{responseType:"blob"}),l=window.URL.createObjectURL(new Blob([a.data])),i=document.createElement("a");i.href=l,i.setAttribute("download",`audit-logs-${Date.now()}.csv`),document.body.appendChild(i),i.click(),i.remove()}catch(t){console.error("Failed to export logs:",t);const{showError:a}=await O(async()=>{const{showError:l}=await import("./sweetalert-DcBwdyhg.js");return{showError:l}},__vite__mapDeps([0,1,2]));a("Failed to export audit logs. Please try again.")}},A=t=>{switch(t){case"CREATE":return"text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/20";case"UPDATE":return"text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20";case"DELETE":return"text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20";case"LOGIN":return"text-purple-600 dark:text-purple-400 bg-purple-50 dark:bg-purple-900/20";case"EXPORT":return"text-orange-600 dark:text-orange-400 bg-orange-50 dark:bg-orange-900/20";default:return"text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-900/20"}},D=t=>{switch(t){case"success":return"text-green-600 dark:text-green-400";case"failure":return"text-red-600 dark:text-red-400";case"warning":return"text-yellow-600 dark:text-yellow-400";default:return"text-gray-600 dark:text-gray-400"}},h=b.filter(t=>{var l,i,y;if(!x)return!0;const a=x.toLowerCase();return t.action.toLowerCase().includes(a)||t.entityType.toLowerCase().includes(a)||((l=t.userEmail)==null?void 0:l.toLowerCase().includes(a))||((i=t.userName)==null?void 0:i.toLowerCase().includes(a))||((y=t.ipAddress)==null?void 0:y.toLowerCase().includes(a))});return w?e.jsx(I,{message:"Loading audit logs..."}):e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[e.jsx(_,{className:"w-8 h-8 text-purple-600 dark:text-purple-400"}),"Audit Logs"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:"Track all system activities and security events"})]}),e.jsxs("button",{onClick:T,className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[e.jsx(P,{className:"w-5 h-5"}),"Export CSV"]})]})}),n&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Total Logs (30d)"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white mt-2",children:n.totalLogs})]}),e.jsx(R,{className:"w-10 h-10 text-purple-600 dark:text-purple-400"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Last 24h"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400 mt-2",children:n.recentActivity})]}),e.jsx(U,{className:"w-10 h-10 text-blue-600 dark:text-blue-400"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:"Top Actions"}),e.jsx("div",{className:"space-y-2",children:n.actionBreakdown.slice(0,3).map(t=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:t.action}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:t.count})]},t.action))})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:"Top Entities"}),e.jsx("div",{className:"space-y-2",children:n.entityBreakdown.slice(0,3).map(t=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:t.entityType}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:t.count})]},t.entityType))})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(F,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),e.jsx("h2",{className:"font-semibold text-gray-900 dark:text-white",children:"Filters"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search logs...",value:x,onChange:t=>v(t.target.value),className:"w-full pl-10 pr-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Action"}),e.jsxs("select",{value:c,onChange:t=>N(t.target.value),className:"w-full px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"",children:"All Actions"}),e.jsx("option",{value:"CREATE",children:"CREATE"}),e.jsx("option",{value:"UPDATE",children:"UPDATE"}),e.jsx("option",{value:"DELETE",children:"DELETE"}),e.jsx("option",{value:"LOGIN",children:"LOGIN"}),e.jsx("option",{value:"LOGOUT",children:"LOGOUT"}),e.jsx("option",{value:"EXPORT",children:"EXPORT"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Entity Type"}),e.jsxs("select",{value:o,onChange:t=>E(t.target.value),className:"w-full px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"",children:"All Entities"}),e.jsx("option",{value:"User",children:"User"}),e.jsx("option",{value:"Asset",children:"Asset"}),e.jsx("option",{value:"Ticket",children:"Ticket"}),e.jsx("option",{value:"Comment",children:"Comment"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:r,onChange:t=>u(t.target.value),className:"w-full px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:d,onChange:t=>m(t.target.value),className:"w-full px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500"})]})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Timestamp"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Action"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Entity"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"IP Address"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500 dark:text-gray-400",children:"No audit logs found"})}):h.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:new Date(t.createdAt).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${A(t.action)}`,children:t.action})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:[t.entityType,t.entityId&&e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:["#",t.entityId.substring(0,8)]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[e.jsx("div",{className:"text-gray-900 dark:text-gray-100",children:t.userName||"System"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.userEmail})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:t.ipAddress||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`text-sm font-semibold ${D(t.status)}`,children:t.status})})]},t.id))})]})})})]})}export{V as default};
