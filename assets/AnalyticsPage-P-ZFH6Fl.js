import{r as D,j as e,an as q,af as X,V as Q,k as V,o as J,i as Z,v as ee,z as f}from"./react-vendor-CLiifM8U.js";import{u as te}from"./store-Bg1Ny8j7.js";import{u as se}from"./store-D7fRW5xE.js";import{u as g,w as ae,E as re,a as S}from"./export-libs-CrC4Cruk.js";import{u as le,f as R,L as ie,d as C}from"./index-DAo0lhFG.js";import{R as w,P as $,a as O,C as P,T as N,B as oe,b as B,X as z,Y as I,c as ne,e as de,f as ce}from"./charts-CDUR81No.js";import"./vendor-FPNzGmdA.js";import"./api-RmH4aR9H.js";import"./form-libs-D8_qC6eW.js";const n={blue:"#3B82F6",green:"#10B981",yellow:"#F59E0B",red:"#EF4444",purple:"#8B5CF6",gray:"#6B7280",orange:"#F97316"},v=({active:T,payload:h,label:j})=>{const m=document.documentElement.classList.contains("dark");return T&&h&&h.length?e.jsxs("div",{style:{backgroundColor:m?"rgba(31, 41, 55, 0.95)":"rgba(255, 255, 255, 0.95)",border:m?"1px solid #4B5563":"1px solid #e0e0e0",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)"},children:[j&&e.jsx("p",{style:{fontWeight:"bold",color:m?"#F3F4F6":"#1F2937",marginBottom:"8px",fontSize:"14px"},children:j}),h.map((b,A)=>e.jsxs("p",{style:{color:m?"#D1D5DB":"#4B5563",margin:"4px 0",fontSize:"13px"},children:[e.jsxs("span",{style:{color:b.color,fontWeight:"600"},children:[b.name,":"]})," ",b.value]},`item-${A}`))]}):null};function fe(){const{assets:T,fetchAssets:h,isLoading:j}=te(),{tickets:m,fetchTickets:b,isLoading:A}=se(),Y=le(j||A,2e3),[d,F]=D.useState(()=>{const t=new Date;return t.setMonth(t.getMonth()-1),t.toISOString().split("T")[0]}),[c,L]=D.useState(()=>new Date().toISOString().split("T")[0]);D.useEffect(()=>{h(),b()},[h,b]);const o=m.filter(t=>{const a=new Date(t.createdAt),r=new Date(d),i=new Date(c);return i.setHours(23,59,59,999),a>=r&&a<=i}),x=T.filter(t=>{const a=new Date(t.createdAt),r=new Date(d),i=new Date(c);return i.setHours(23,59,59,999),a>=r&&a<=i}),s={totalTickets:o.length,openTickets:o.filter(t=>t.status==="open").length,inProgressTickets:o.filter(t=>t.status==="in_progress").length,closedTickets:o.filter(t=>t.status==="closed").length,highPriorityTickets:o.filter(t=>t.priority==="high"||t.priority==="critical").length,totalAssets:x.length,availableAssets:x.filter(t=>t.status==="available").length,assignedAssets:x.filter(t=>t.status==="assigned").length,maintenanceAssets:x.filter(t=>t.status==="maintenance"||t.status==="repair").length,repairAssets:x.filter(t=>t.status==="repair").length},_=[{name:"Open",value:s.openTickets,color:n.blue},{name:"In Progress",value:s.inProgressTickets,color:n.purple},{name:"Closed",value:s.closedTickets,color:n.gray}].filter(t=>t.value>0),M=[{name:"Low",value:o.filter(t=>t.priority==="low").length,color:n.green},{name:"Medium",value:o.filter(t=>t.priority==="medium").length,color:n.yellow},{name:"High",value:o.filter(t=>t.priority==="high").length,color:n.orange},{name:"Critical",value:o.filter(t=>t.priority==="critical").length,color:n.red}].filter(t=>t.value>0),E=[{name:"Available",value:s.availableAssets,color:n.green},{name:"Assigned",value:s.assignedAssets,color:n.blue},{name:"Maintenance/Repair",value:s.maintenanceAssets,color:n.yellow},{name:"Retired",value:x.filter(t=>t.status==="retired").length,color:n.gray}].filter(t=>t.value>0),H=(()=>{const t=new Map;return o.forEach(a=>{const r=R(a.createdAt);t.set(r,(t.get(r)||0)+1)}),Array.from(t.entries()).map(([a,r])=>({date:a,count:r})).sort((a,r)=>new Date(a.date).getTime()-new Date(r.date).getTime()).slice(-30)})(),K=()=>{try{const t=g.book_new(),a=[["Analytics Report"],["Date Range:",`${d} to ${c}`],["Generated:",new Date().toLocaleString()],[],["Ticket Statistics"],["Total Tickets",s.totalTickets],["Open",s.openTickets],["In Progress",s.inProgressTickets],["Closed",s.closedTickets],["High Priority",s.highPriorityTickets],[],["Asset Statistics"],["Total Assets",s.totalAssets],["Available",s.availableAssets],["Assigned",s.assignedAssets],["Maintenance",s.maintenanceAssets]],r=g.aoa_to_sheet(a);g.book_append_sheet(t,r,"Summary");const i=o.map(l=>{var p,y;return{"Ticket #":l.number||l.id,Title:l.title,Status:l.status,Priority:l.priority,"Assigned To":((p=l.assignedTo)==null?void 0:p.name)||((y=l.assignedTo)==null?void 0:y.email)||"Unassigned",Created:C(l.createdAt),Updated:C(l.updatedAt)}}),k=g.json_to_sheet(i);g.book_append_sheet(t,k,"Tickets");const U=x.map(l=>{var p,y;return{"Asset Code":l.asset_code,Name:l.name,Category:l.category||"N/A",Status:l.status,Location:l.location||"N/A","Assigned To":((p=l.assignedTo)==null?void 0:p.name)||((y=l.assignedTo)==null?void 0:y.email)||"Unassigned",Created:C(l.createdAt)}}),G=g.json_to_sheet(U);g.book_append_sheet(t,G,"Assets"),ae(t,`analytics_report_${d}_to_${c}.xlsx`),f.success("Excel report exported successfully!")}catch(t){console.error("Export failed:",t),f.error("Failed to export Excel report")}},W=()=>{try{const t=new re,a=t.internal.pageSize.getWidth();t.setFontSize(20),t.setTextColor(59,130,246),t.text("Analytics Report",14,20),t.setFontSize(10),t.setTextColor(100,100,100),t.text(`Date Range: ${d} to ${c}`,14,28),t.text(`Generated: ${new Date().toLocaleString()}`,14,34);let r=45;t.setFontSize(14),t.setTextColor(0,0,0),t.text("Ticket Statistics",14,r),r+=10,S(t,{startY:r,head:[["Metric","Count"]],body:[["Total Tickets",s.totalTickets],["Open",s.openTickets],["In Progress",s.inProgressTickets],["Closed",s.closedTickets],["High Priority",s.highPriorityTickets]],theme:"grid",headStyles:{fillColor:[59,130,246]}}),r=t.lastAutoTable.finalY+15,t.setFontSize(14),t.text("Asset Statistics",14,r),r+=10,S(t,{startY:r,head:[["Metric","Count"]],body:[["Total Assets",s.totalAssets],["Available",s.availableAssets],["Assigned",s.assignedAssets],["Maintenance",s.maintenanceAssets]],theme:"grid",headStyles:{fillColor:[59,130,246]}}),t.addPage(),t.setFontSize(14),t.text("Tickets Detail",14,20),S(t,{startY:28,head:[["Ticket #","Title","Status","Priority","Created"]],body:o.slice(0,50).map(i=>{var k;return[i.number||((k=i.id)==null?void 0:k.slice(0,8)),i.title.length>30?i.title.slice(0,30)+"...":i.title,i.status||"N/A",i.priority||"N/A",R(i.createdAt)]}),theme:"grid",headStyles:{fillColor:[139,92,246]},styles:{fontSize:8}}),t.save(`analytics_report_${d}_to_${c}.pdf`),f.success("PDF report exported successfully!")}catch(t){console.error("PDF export failed:",t),f.error("Failed to export PDF report")}},u=t=>{const a=new Date,r=new Date;switch(t){case"week":r.setDate(a.getDate()-7);break;case"month":r.setMonth(a.getMonth()-1);break;case"quarter":r.setMonth(a.getMonth()-3);break;case"year":r.setFullYear(a.getFullYear()-1);break;case"all":r.setFullYear(2e3);break}F(r.toISOString().split("T")[0]),L(a.toISOString().split("T")[0])};return Y?e.jsx(ie,{message:"Loading analytics..."}):e.jsxs("div",{className:"p-8 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Analytics & Reports"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Generate comprehensive reports with custom date ranges"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(q,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Date Range"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx("button",{onClick:()=>u("week"),className:"px-4 py-2 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50 text-sm font-medium transition-colors",children:"Last Week"}),e.jsx("button",{onClick:()=>u("month"),className:"px-4 py-2 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50 text-sm font-medium transition-colors",children:"Last Month"}),e.jsx("button",{onClick:()=>u("quarter"),className:"px-4 py-2 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50 text-sm font-medium transition-colors",children:"Last Quarter"}),e.jsx("button",{onClick:()=>u("year"),className:"px-4 py-2 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50 text-sm font-medium transition-colors",children:"Last Year"}),e.jsx("button",{onClick:()=>u("all"),className:"px-4 py-2 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50 text-sm font-medium transition-colors",children:"All Time"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Start Date"}),e.jsx("input",{type:"date",value:d,onChange:t=>F(t.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"End Date"}),e.jsx("input",{type:"date",value:c,onChange:t=>L(t.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:K,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white font-semibold rounded-lg shadow-md hover:shadow-lg transition-all flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5"}),"Export to Excel"]}),e.jsxs("button",{onClick:W,className:"px-6 py-3 bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white font-semibold rounded-lg shadow-md hover:shadow-lg transition-all flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Export to PDF"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(V,{className:"w-8 h-8 opacity-80"}),e.jsx("span",{className:"text-3xl font-bold",children:s.totalTickets})]}),e.jsx("h3",{className:"text-lg font-semibold",children:"Total Tickets"}),e.jsx("p",{className:"text-sm opacity-90",children:"In selected period"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(J,{className:"w-8 h-8 opacity-80"}),e.jsx("span",{className:"text-3xl font-bold",children:s.openTickets})]}),e.jsx("h3",{className:"text-lg font-semibold",children:"Open Tickets"}),e.jsx("p",{className:"text-sm opacity-90",children:"Awaiting response"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-500 to-green-600 text-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Z,{className:"w-8 h-8 opacity-80"}),e.jsx("span",{className:"text-3xl font-bold",children:s.totalAssets})]}),e.jsx("h3",{className:"text-lg font-semibold",children:"Total Assets"}),e.jsx("p",{className:"text-sm opacity-90",children:"In inventory"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-red-500 to-red-600 text-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ee,{className:"w-8 h-8 opacity-80"}),e.jsx("span",{className:"text-3xl font-bold",children:s.highPriorityTickets})]}),e.jsx("h3",{className:"text-lg font-semibold",children:"High Priority"}),e.jsx("p",{className:"text-sm opacity-90",children:"Requires attention"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:"Tickets by Status"}),e.jsx(w,{width:"100%",height:300,children:e.jsxs($,{children:[e.jsx(O,{data:_,cx:"50%",cy:"50%",labelLine:!1,label:({name:t,percent:a})=>`${t}: ${(a*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:_.map((t,a)=>e.jsx(P,{fill:t.color},`cell-${a}`))}),e.jsx(N,{content:e.jsx(v,{})})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:"Tickets by Priority"}),e.jsx(w,{width:"100%",height:300,children:e.jsxs(oe,{data:M,children:[e.jsx(B,{strokeDasharray:"3 3",stroke:"#374151"}),e.jsx(z,{dataKey:"name",stroke:"#9CA3AF"}),e.jsx(I,{stroke:"#9CA3AF"}),e.jsx(N,{content:e.jsx(v,{})}),e.jsx(ne,{dataKey:"value",fill:"#8B5CF6",children:M.map((t,a)=>e.jsx(P,{fill:t.color},`cell-${a}`))})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:"Assets by Status"}),e.jsx(w,{width:"100%",height:300,children:e.jsxs($,{children:[e.jsx(O,{data:E,cx:"50%",cy:"50%",labelLine:!1,label:({name:t,percent:a})=>`${t}: ${(a*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:E.map((t,a)=>e.jsx(P,{fill:t.color},`cell-${a}`))}),e.jsx(N,{content:e.jsx(v,{})})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:"Tickets Created Over Time"}),e.jsx(w,{width:"100%",height:300,children:e.jsxs(de,{data:H,children:[e.jsx(B,{strokeDasharray:"3 3",stroke:"#374151"}),e.jsx(z,{dataKey:"date",stroke:"#9CA3AF",angle:-45,textAnchor:"end",height:80}),e.jsx(I,{stroke:"#9CA3AF"}),e.jsx(N,{content:e.jsx(v,{})}),e.jsx(ce,{type:"monotone",dataKey:"count",stroke:n.blue,strokeWidth:2,name:"Tickets"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:"Ticket Summary"}),e.jsx("table",{className:"w-full",children:e.jsxs("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 text-gray-700 dark:text-gray-300",children:"Total Tickets"}),e.jsx("td",{className:"py-3 text-right font-semibold text-gray-900 dark:text-white",children:s.totalTickets})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 text-gray-700 dark:text-gray-300",children:"Open"}),e.jsx("td",{className:"py-3 text-right font-semibold text-blue-600 dark:text-blue-400",children:s.openTickets})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 text-gray-700 dark:text-gray-300",children:"In Progress"}),e.jsx("td",{className:"py-3 text-right font-semibold text-purple-600 dark:text-purple-400",children:s.inProgressTickets})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 text-gray-700 dark:text-gray-300",children:"Closed"}),e.jsx("td",{className:"py-3 text-right font-semibold text-gray-600 dark:text-gray-400",children:s.closedTickets})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 text-gray-700 dark:text-gray-300",children:"High Priority"}),e.jsx("td",{className:"py-3 text-right font-semibold text-red-600 dark:text-red-400",children:s.highPriorityTickets})]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:"Asset Summary"}),e.jsx("table",{className:"w-full",children:e.jsxs("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 text-gray-700 dark:text-gray-300",children:"Total Assets"}),e.jsx("td",{className:"py-3 text-right font-semibold text-gray-900 dark:text-white",children:s.totalAssets})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 text-gray-700 dark:text-gray-300",children:"Available"}),e.jsx("td",{className:"py-3 text-right font-semibold text-green-600 dark:text-green-400",children:s.availableAssets})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 text-gray-700 dark:text-gray-300",children:"Assigned"}),e.jsx("td",{className:"py-3 text-right font-semibold text-blue-600 dark:text-blue-400",children:s.assignedAssets})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 text-gray-700 dark:text-gray-300",children:"Maintenance/Repair"}),e.jsx("td",{className:"py-3 text-right font-semibold text-yellow-600 dark:text-yellow-400",children:s.maintenanceAssets})]})]})})]})]})]})}export{fe as default};
