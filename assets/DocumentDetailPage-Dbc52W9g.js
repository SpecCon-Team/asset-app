import{j as e}from"./vendor-charts-DVp8BQgJ.js";import{h as C,u as L,r as d,L as A}from"./vendor-react-CFQdvhEG.js";import{u as E,a as x,L as $,e as y,g as B}from"./index-CezS3iyn.js";import{showError as c,showConfirmDialog as S,showSuccess as j}from"./sweetalert-DcBwdyhg.js";import"./vendor-ui-Bhgb65c8.js";const P=()=>{const{id:l}=C(),u=L(),[t,f]=d.useState(null),[b,g]=d.useState(!0),N=E(b,2e3),[i,h]=d.useState("");d.useEffect(()=>{p()},[l]);const p=async()=>{try{g(!0);const s=await x().get(`/documents/${l}`);f(s.data)}catch(s){console.error("Error loading document:",s),c("Failed to load document")}finally{g(!1)}},w=async()=>{try{const s=localStorage.getItem("token");if(!s){c("Authentication required","Please log in to download documents");return}const n=`${B()}/documents/${l}/download`,a=await fetch(n,{headers:{Authorization:`Bearer ${s}`}});if(!a.ok){const r=await a.text().catch(()=>"Unknown error");throw new Error(`Download failed: ${a.status} ${a.statusText} - ${r}`)}const o=await a.blob(),m=window.URL.createObjectURL(o);if(typeof t<"u"&&typeof t.createElement=="function"){const r=t.createElement("a");r.href=m,r.download=(t==null?void 0:t.originalFileName)||"document",r.style.display="none",t.body.appendChild(r),r.click(),t.body.removeChild(r)}else window.open(m,"_blank");window.URL.revokeObjectURL(m)}catch(s){console.error("Error downloading document:",s),c("Failed to download document",s.message||"Please try again")}},v=async()=>{var n,a;const s=await S("Delete Document","Are you sure you want to delete this document? This action cannot be undone.","Yes","Cancel");if(!(!s||!s.isConfirmed))try{await x().delete(`/documents/${l}`),j("Document deleted successfully"),u("/documents")}catch(o){console.error("Error deleting document:",o),c(((a=(n=o.response)==null?void 0:n.data)==null?void 0:a.message)||"Failed to delete document")}},k=async s=>{if(s.preventDefault(),!!i.trim())try{await x().post(`/documents/${l}/comments`,{comment:i}),h(""),p(),j("Comment added successfully")}catch(n){console.error("Error adding comment:",n),c("Failed to add comment")}},D=s=>{const n=["B","KB","MB","GB"];let a=s,o=0;for(;a>=1024&&o<n.length-1;)a/=1024,o++;return`${a.toFixed(2)} ${n[o]}`};return N?e.jsx($,{message:"Loading document details"}):t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>u("/documents"),className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:t.title}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t.originalFileName})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:w,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Download"}),e.jsx("button",{onClick:v,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Delete"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Document Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"File Size"}),e.jsx("p",{className:"text-base font-medium text-gray-900 mt-1",children:D(t.fileSize)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Type"}),e.jsx("p",{className:"text-base font-medium text-gray-900 mt-1",children:t.mimeType})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Version"}),e.jsx("p",{className:"text-base font-medium text-gray-900 mt-1",children:t.version})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Uploaded By"}),e.jsx("p",{className:"text-base font-medium text-gray-900 mt-1",children:t.uploadedBy.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Upload Date"}),e.jsx("p",{className:"text-base font-medium text-gray-900 mt-1",children:y(t.uploadedAt||t.createdAt)})]}),t.category&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Category"}),e.jsx("p",{className:"text-base font-medium mt-1 inline-block px-3 py-1 rounded-full",style:{backgroundColor:t.category.color+"30",color:t.category.color},children:t.category.name})]})]}),t.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Description"}),e.jsx("p",{className:"text-base text-gray-900 mt-1",children:t.description})]}),t.tags&&t.tags.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.tags.map((s,n)=>e.jsx("span",{className:"px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm",children:s},n))})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 space-y-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Comments (",t.comments.length,")"]}),e.jsxs("form",{onSubmit:k,className:"space-y-3",children:[e.jsx("textarea",{value:i,onChange:s=>h(s.target.value),rows:3,placeholder:"Add a comment...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Add Comment"})]}),e.jsx("div",{className:"space-y-3 mt-6",children:t.comments.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No comments yet"}):t.comments.map(s=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:s.user.name}),e.jsx("span",{className:"text-sm text-gray-500",children:y(s.createdAt)})]}),e.jsx("p",{className:"text-gray-700",children:s.comment})]},s.id))})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500",children:"Document not found"}),e.jsx(A,{to:"/documents",className:"text-blue-600 hover:underline mt-4 inline-block",children:"Back to Documents"})]})};export{P as default};
