import{r as l,h as $,e as I,j as e,L as W,V as w,C as h,x as P}from"./index-B_IVq7rD.js";import{C as u}from"./circle-check-big-BmZzEJ10.js";import{C as j}from"./circle-x-Chp1I8ra.js";import{F as k}from"./filter-BmdDIAgT.js";import{C as H}from"./calendar-D6ErFEin.js";function J(){const[n,i]=l.useState([]),[N,m]=l.useState(!0),b=$(N,2e3),[p,v]=l.useState(""),[o,S]=l.useState("all"),[x,T]=l.useState("all"),[g,C]=l.useState("7d");l.useEffect(()=>{F()},[o,x,g]);const F=async()=>{var t;try{const a=new URLSearchParams;o!=="all"&&a.append("status",o),x!=="all"&&a.append("entityType",x),g!=="all"&&a.append("dateRange",g);const s=await fetch(`${I()}/workflows/executions?${a.toString()}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(!s.ok){s.status===403?console.warn("Access denied: Admin role required for workflow executions"):console.error("Failed to fetch workflow executions: HTTP",s.status),i([]);return}const d=s.headers.get("content-type");if(!d||!d.includes("application/json")){console.error("Server returned non-JSON response:",d),i([]);return}const c=await s.json();i(Array.isArray(c)?c:[])}catch(a){if((t=a==null?void 0:a.message)!=null&&t.includes("Failed to fetch")||(a==null?void 0:a.code)==="ERR_NETWORK"){i([]),m(!1);return}console.error("Failed to fetch workflow executions:",a),i([])}finally{m(!1)}},A=t=>{switch(t){case"completed":return e.jsx(u,{className:"w-5 h-5 text-green-600"});case"failed":return e.jsx(j,{className:"w-5 h-5 text-red-600"});case"running":return e.jsx(h,{className:"w-5 h-5 text-blue-600 animate-spin"});case"pending":return e.jsx(h,{className:"w-5 h-5 text-yellow-600"});default:return e.jsx(h,{className:"w-5 h-5 text-gray-600"})}},E=t=>{switch(t){case"completed":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"failed":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400";case"running":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400";case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-400"}},L=t=>{const a=new Date(t);return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(a)},R=t=>t<1e3?`${t}ms`:t<6e4?`${(t/1e3).toFixed(1)}s`:`${(t/6e4).toFixed(1)}m`,y=n.filter(t=>{var a,s;return(s=(a=t.workflow)==null?void 0:a.name)==null?void 0:s.toLowerCase().includes(p.toLowerCase())}),r={total:n.length,successful:n.filter(t=>t.status==="completed").length,failed:n.filter(t=>t.status==="failed").length,running:n.filter(t=>t.status==="running"||t.status==="pending").length},D=r.total>0?(r.successful/r.total*100).toFixed(1):"0";return b?e.jsx(W,{message:"Loading workflow history..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Workflow Execution History"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Track and monitor workflow automation execution"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Executions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r.total})]}),e.jsx(w,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Success Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[D,"%"]})]}),e.jsx(u,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Successful"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:r.successful})]}),e.jsx(u,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Failed"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:r.failed})]}),e.jsx(j,{className:"w-8 h-8 text-red-600"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"In Progress"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:r.running})]}),e.jsx(h,{className:"w-8 h-8 text-blue-600"})]})})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:p,onChange:t=>v(t.target.value),placeholder:"Search workflows...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(k,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsxs("select",{value:o,onChange:t=>S(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white appearance-none",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"failed",children:"Failed"}),e.jsx("option",{value:"running",children:"Running"}),e.jsx("option",{value:"pending",children:"Pending"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(k,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsxs("select",{value:x,onChange:t=>T(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white appearance-none",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"ticket",children:"Ticket"}),e.jsx("option",{value:"asset",children:"Asset"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsxs("select",{value:g,onChange:t=>C(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white appearance-none",children:[e.jsx("option",{value:"1d",children:"Last 24 hours"}),e.jsx("option",{value:"7d",children:"Last 7 days"}),e.jsx("option",{value:"30d",children:"Last 30 days"}),e.jsx("option",{value:"all",children:"All time"})]})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden",children:y.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(w,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No execution history"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Workflow executions will appear here once workflows start running"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-750 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Workflow"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Entity"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Duration"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Executed At"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:y.map(t=>{var a,s,d,c,f;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:((a=t.workflow)==null?void 0:a.name)||"Unknown Workflow"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:t.entityType}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["ID: ",t.entityId.slice(0,8),"..."]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[A(t.status),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full capitalize ${E(t.status)}`,children:t.status})]}),t.error&&e.jsx("div",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:t.error})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm text-gray-900 dark:text-white",children:[((s=t.result)==null?void 0:s.actionsExecuted)||0," / ",(((d=t.result)==null?void 0:d.actionsExecuted)||0)+(((c=t.result)==null?void 0:c.actionsFailed)||0)]}),((f=t.result)==null?void 0:f.actionsFailed)>0&&e.jsxs("div",{className:"text-xs text-red-600 dark:text-red-400",children:[t.result.actionsFailed," failed"]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:t.completedAt&&t.executedAt?R(new Date(t.completedAt).getTime()-new Date(t.executedAt).getTime()):"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:L(t.executedAt)})]},t.id)})})]})})})]})}export{J as default};
