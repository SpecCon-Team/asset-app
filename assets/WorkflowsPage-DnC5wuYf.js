import{r as g,j as e,X as E,k as C,f as D,L}from"./index-DWJKKC5Z.js";import{showSuccess as W,showError as _,showDeleteConfirm as F}from"./sweetalert-BCvQYi5m.js";import{P as A}from"./plus-TALb1iue.js";import{A as w}from"./activity-6IcOe7xZ.js";import{P as T,a as P}from"./play-BlZRm7MO.js";import{S as I}from"./square-pen-6sBvmNVf.js";function q({workflow:r,onSave:o,onCancel:b}){const[h,j]=g.useState(!1),[s,i]=g.useState({name:(r==null?void 0:r.name)||"",description:(r==null?void 0:r.description)||"",entityType:(r==null?void 0:r.entityType)||"ticket",trigger:(r==null?void 0:r.trigger)||"created",priority:(r==null?void 0:r.priority)||0,isActive:(r==null?void 0:r.isActive)??!0,conditions:(r==null?void 0:r.conditions)||[],actions:(r==null?void 0:r.actions)||[]}),x=async a=>{a.preventDefault(),j(!0);try{await o(s),W(r?"Workflow updated successfully":"Workflow created successfully","Success!")}catch(d){console.error("Failed to save workflow:",d),_("Failed to save workflow. Please try again.")}finally{j(!1)}},u=()=>{i({...s,conditions:[...s.conditions,{field:"",operator:"equals",value:""}]})},v=a=>{i({...s,conditions:s.conditions.filter((d,t)=>t!==a)})},p=(a,d,t)=>{const l=[...s.conditions];l[a]={...l[a],[d]:t},i({...s,conditions:l})},f=()=>{i({...s,actions:[...s.actions,{type:"add_comment",params:{}}]})},k=a=>{i({...s,actions:s.actions.filter((d,t)=>t!==a)})},N=(a,d,t)=>{const l=[...s.actions];l[a]={...l[a],[d]:t},i({...s,actions:l})},c=(a,d,t)=>{const l=[...s.actions];l[a]={...l[a],params:{...l[a].params,[d]:t}},i({...s,actions:l})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:e.jsxs("form",{onSubmit:x,children:[e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r?"Edit Workflow":"Create Workflow"}),e.jsx("button",{type:"button",onClick:b,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(E,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Workflow Name *"}),e.jsx("input",{type:"text",required:!0,value:s.name,onChange:a=>i({...s,name:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"e.g., Auto-escalate critical tickets"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description"}),e.jsx("textarea",{value:s.description,onChange:a=>i({...s,description:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",rows:3,placeholder:"Describe what this workflow does..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Entity Type *"}),e.jsxs("select",{required:!0,value:s.entityType,onChange:a=>i({...s,entityType:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"ticket",children:"Ticket"}),e.jsx("option",{value:"asset",children:"Asset"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Trigger *"}),e.jsxs("select",{required:!0,value:s.trigger,onChange:a=>i({...s,trigger:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"created",children:"Created"}),e.jsx("option",{value:"status_changed",children:"Status Changed"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"priority_changed",children:"Priority Changed"}),e.jsx("option",{value:"updated",children:"Updated"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Priority"}),e.jsx("input",{type:"number",value:s.priority,onChange:a=>i({...s,priority:a.target.value===""?0:parseInt(a.target.value)}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"0-1000 (higher runs first)"})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.isActive,onChange:a=>i({...s,isActive:a.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:"Active"})]})})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Conditions"}),e.jsxs("button",{type:"button",onClick:u,className:"flex items-center gap-2 px-3 py-1.5 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(A,{className:"w-4 h-4"}),"Add Condition"]})]}),s.conditions.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:"No conditions - workflow will always execute"}):e.jsx("div",{className:"space-y-3",children:s.conditions.map((a,d)=>e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 dark:bg-gray-750 rounded-lg",children:[e.jsx("input",{type:"text",value:a.field,onChange:t=>p(d,"field",t.target.value),placeholder:"Field (e.g., priority)",className:"flex-1 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white"}),e.jsxs("select",{value:a.operator,onChange:t=>p(d,"operator",t.target.value),className:"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"equals",children:"Equals"}),e.jsx("option",{value:"not_equals",children:"Not Equals"}),e.jsx("option",{value:"contains",children:"Contains"}),e.jsx("option",{value:"not_contains",children:"Not Contains"}),e.jsx("option",{value:"greater_than",children:"Greater Than"}),e.jsx("option",{value:"less_than",children:"Less Than"}),e.jsx("option",{value:"in",children:"In"}),e.jsx("option",{value:"not_in",children:"Not In"})]}),e.jsx("input",{type:"text",value:a.value,onChange:t=>p(d,"value",t.target.value),placeholder:"Value (e.g., critical)",className:"flex-1 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white"}),e.jsx("button",{type:"button",onClick:()=>v(d),className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg",children:e.jsx(C,{className:"w-4 h-4"})})]},d))})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Actions *"}),e.jsxs("button",{type:"button",onClick:f,className:"flex items-center gap-2 px-3 py-1.5 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(A,{className:"w-4 h-4"}),"Add Action"]})]}),s.actions.length===0?e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 text-center py-4",children:"At least one action is required"}):e.jsx("div",{className:"space-y-4",children:s.actions.map((a,d)=>e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-750 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:a.type,onChange:t=>N(d,"type",t.target.value),className:"flex-1 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"assign",children:"Assign to User"}),e.jsx("option",{value:"change_status",children:"Change Status"}),e.jsx("option",{value:"change_priority",children:"Change Priority"}),e.jsx("option",{value:"add_comment",children:"Add Comment"}),e.jsx("option",{value:"send_notification",children:"Send Notification"}),e.jsx("option",{value:"send_whatsapp",children:"Send WhatsApp"})]}),e.jsx("button",{type:"button",onClick:()=>k(d),className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg",children:e.jsx(C,{className:"w-4 h-4"})})]}),a.type==="assign"&&e.jsx("input",{type:"text",value:a.params.userId||"",onChange:t=>c(d,"userId",t.target.value),placeholder:"User ID",className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white"}),a.type==="change_status"&&e.jsx("input",{type:"text",value:a.params.status||"",onChange:t=>c(d,"status",t.target.value),placeholder:"Status (e.g., in_progress)",className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white"}),a.type==="change_priority"&&e.jsx("input",{type:"text",value:a.params.priority||"",onChange:t=>c(d,"priority",t.target.value),placeholder:"Priority (e.g., critical)",className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white"}),a.type==="add_comment"&&e.jsx("textarea",{value:a.params.comment||"",onChange:t=>c(d,"comment",t.target.value),placeholder:"Comment text...",className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white",rows:2}),(a.type==="send_notification"||a.type==="send_whatsapp")&&e.jsxs(e.Fragment,{children:[e.jsx("textarea",{value:a.params.message||"",onChange:t=>c(d,"message",t.target.value),placeholder:"Message text...",className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white",rows:2}),e.jsx("input",{type:"text",value:(a.params.recipients||[]).join(", "),onChange:t=>c(d,"recipients",t.target.value.split(",").map(l=>l.trim())),placeholder:"Recipient User IDs (comma-separated)",className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white"})]})]},d))})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 p-6 flex items-center justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:b,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",disabled:h,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:h||s.actions.length===0,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:h?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("span",{className:"sr-only",children:"Saving"})]}):r?"Update Workflow":"Create Workflow"})]})]})})})}function H(){const[r,o]=g.useState([]),[b,h]=g.useState(!0),j=D(b,2e3),[s,i]=g.useState(!1),[x,u]=g.useState(null),[v,p]=g.useState(!1);g.useEffect(()=>{f()},[]);const f=async()=>{try{const t=await fetch("http://localhost:4000/api/workflows/templates",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(t.status===403){p(!0),h(!1);return}if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const l=await t.json();Array.isArray(l)?o(l):(console.error("API returned non-array data:",l),o([]))}catch(t){console.error("Failed to fetch workflows:",t),o([])}finally{h(!1)}},k=async t=>{try{const m=await(await fetch(`http://localhost:4000/api/workflows/templates/${t}/toggle`,{method:"PATCH",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();o(r.map(n=>n.id===t?m:n))}catch(l){console.error("Failed to toggle workflow:",l)}},N=async t=>{const l=r.find(n=>n.id===t);if((await F((l==null?void 0:l.name)||"this workflow","This workflow will be permanently deleted and cannot be recovered.")).isConfirmed)try{if(!(await fetch(`http://localhost:4000/api/workflows/templates/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).ok)throw new Error("Failed to delete workflow");o(r.filter(y=>y.id!==t)),W("Workflow deleted successfully")}catch(n){console.error("Failed to delete workflow:",n),_("Failed to delete workflow. Please try again.")}},c=async t=>{const l=x?`http://localhost:4000/api/workflows/templates/${x.id}`:"http://localhost:4000/api/workflows/templates",n=await fetch(l,{method:x?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(t)});if(!n.ok)throw new Error("Failed to save workflow");const y=await n.json();o(x?r.map(S=>S.id===y.id?y:S):[...r,y]),i(!1),u(null)},a=t=>({created:"Created",status_changed:"Status Changed",assigned:"Assigned",priority_changed:"Priority Changed",updated:"Updated"})[t]||t,d=t=>t==="ticket"?"Ticket":"Asset";return j?e.jsx(L,{message:"Loading workflows..."}):v?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-8 text-center",children:[e.jsx("div",{className:"mb-4",children:e.jsx("svg",{className:"w-16 h-16 text-red-500 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"You don't have permission to access workflow automation features."}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-500",children:"Only administrators can view and manage workflows. Please contact your system administrator if you need access."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Workflow Automation"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Automate actions when certain events occur"})]}),e.jsxs("button",{onClick:()=>i(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(A,{className:"w-4 h-4"}),"Create Workflow"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Workflows"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r.length})]}),e.jsx(w,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Active"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:r.filter(t=>t.isActive).length})]}),e.jsx(T,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Paused"}),e.jsx("p",{className:"text-2xl font-bold text-gray-600",children:r.filter(t=>!t.isActive).length})]}),e.jsx(P,{className:"w-8 h-8 text-gray-600"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Ticket Workflows"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:r.filter(t=>t.entityType==="ticket").length})]}),e.jsx(w,{className:"w-8 h-8 text-purple-600"})]})})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:r.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(w,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No workflows yet"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Create your first workflow to start automating tasks"}),e.jsx("button",{onClick:()=>i(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Create Workflow"})]}):e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:r.map(t=>{var l,m;return e.jsx("div",{className:"p-6 hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t.name}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t.isActive?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-400"}`,children:t.isActive?"Active":"Paused"}),e.jsxs("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",children:["Priority: ",t.priority]})]}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:t.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[e.jsx("strong",{children:"Type:"})," ",d(t.entityType)]}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[e.jsx("strong",{children:"Trigger:"})," ",a(t.trigger)]}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[e.jsx("strong",{children:"Conditions:"})," ",((l=t.conditions)==null?void 0:l.length)||0]}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[e.jsx("strong",{children:"Actions:"})," ",((m=t.actions)==null?void 0:m.length)||0]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx("button",{onClick:()=>k(t.id),className:`p-2 rounded-lg transition-colors ${t.isActive?"text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20":"text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,title:t.isActive?"Pause workflow":"Activate workflow",children:t.isActive?e.jsx(P,{className:"w-5 h-5"}):e.jsx(T,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>{u(t),i(!0)},className:"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg",title:"Edit workflow",children:e.jsx(I,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>N(t.id),className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg",title:"Delete workflow",children:e.jsx(C,{className:"w-5 h-5"})})]})]})},t.id)})})}),s&&e.jsx(q,{workflow:x,onSave:c,onCancel:()=>{i(!1),u(null)}})]})}export{H as default};
