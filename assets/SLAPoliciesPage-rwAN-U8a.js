import{r as x,e as p,j as e,X as $,h as M,L as I,C,l as R,_ as B}from"./index-CLEVzMqI.js";import{showSuccess as F,showError as D}from"./sweetalert-BCvQYi5m.js";import{P as O}from"./plus-kPr_fanx.js";import{C as H}from"./circle-check-big-CZwGDxaB.js";import{T as L}from"./triangle-alert-BE3GMVXG.js";import{S as U}from"./square-pen-BPycS7IS.js";function _({policy:r,onSave:h,onCancel:g}){const[f,w]=x.useState(!1),[N,v]=x.useState([]),[i,n]=x.useState({name:(r==null?void 0:r.name)||"",description:(r==null?void 0:r.description)||"",priority:(r==null?void 0:r.priority)||"medium",responseTime:(r==null?void 0:r.responseTime)||60,resolutionTime:(r==null?void 0:r.resolutionTime)||240,businessHoursOnly:(r==null?void 0:r.businessHoursOnly)??!0,escalationEnabled:(r==null?void 0:r.escalationEnabled)??!1,escalationUserId:(r==null?void 0:r.escalationUserId)||"",notifyBeforeMinutes:(r==null?void 0:r.notifyBeforeMinutes)||30,isActive:(r==null?void 0:r.isActive)??!0});x.useEffect(()=>{d()},[]);const d=async()=>{try{const o=await(await fetch(`${p()}/users`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json(),b=Array.isArray(o)?o:o.users||[];v(b.filter(m=>m.role==="ADMIN"||m.role==="TECHNICIAN"))}catch(s){console.error("Failed to fetch users:",s),v([])}},j=async s=>{s.preventDefault(),w(!0);try{await h(i),F(r?"SLA policy updated successfully":"SLA policy created successfully","Success!")}catch(o){console.error("Failed to save SLA policy:",o),D("Failed to save SLA policy. Please try again.")}finally{w(!1)}},k=s=>{if(s<60)return`${s} minutes`;if(s<1440){const m=Math.floor(s/60),S=s%60;return S>0?`${m}h ${S}m`:`${m} hours`}const o=Math.floor(s/1440),b=Math.floor(s%1440/60);return b>0?`${o}d ${b}h`:`${o} days`};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:e.jsxs("form",{onSubmit:j,children:[e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r?"Edit SLA Policy":"Create SLA Policy"}),e.jsx("button",{type:"button",onClick:g,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx($,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Policy Name *"}),e.jsx("input",{type:"text",required:!0,value:i.name,onChange:s=>n({...i,name:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"e.g., Critical Ticket SLA"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description"}),e.jsx("textarea",{value:i.description,onChange:s=>n({...i,description:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",rows:3,placeholder:"Describe the SLA policy..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Priority *"}),e.jsxs("select",{required:!0,value:i.priority,onChange:s=>n({...i,priority:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Time Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Response Time (minutes) *"}),e.jsx("input",{type:"number",required:!0,min:"1",value:i.responseTime,onChange:s=>n({...i,responseTime:parseInt(s.target.value)}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"e.g., 60"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:["Preview: ",k(i.responseTime)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Resolution Time (minutes) *"}),e.jsx("input",{type:"number",required:!0,min:"1",value:i.resolutionTime,onChange:s=>n({...i,resolutionTime:parseInt(s.target.value)}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"e.g., 240"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:["Preview: ",k(i.resolutionTime)]})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.businessHoursOnly,onChange:s=>n({...i,businessHoursOnly:s.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:"Business Hours Only"})]})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"If enabled, SLA timers only count during business hours (9 AM - 5 PM, Monday - Friday)"})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Escalation Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.escalationEnabled,onChange:s=>n({...i,escalationEnabled:s.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:"Enable Escalation"})]})}),i.escalationEnabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Escalate To *"}),e.jsxs("select",{required:i.escalationEnabled,value:i.escalationUserId,onChange:s=>n({...i,escalationUserId:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Select user..."}),N.map(s=>e.jsxs("option",{value:s.id,children:[s.fullName," (",s.email,") - ",s.role]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notify Before (minutes)"}),e.jsx("input",{type:"number",min:"1",value:i.notifyBeforeMinutes,onChange:s=>n({...i,notifyBeforeMinutes:parseInt(s.target.value)}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"e.g., 30"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:["Send warning notification ",k(i.notifyBeforeMinutes)," before breach"]})]})]})]})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.isActive,onChange:s=>n({...i,isActive:s.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:"Active"})]})})})]}),e.jsxs("div",{className:"sticky bottom-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 p-6 flex items-center justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:g,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",disabled:f,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:f,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:f?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("span",{className:"sr-only",children:"Saving"})]}):r?"Update Policy":"Create Policy"})]})]})})})}function X(){const[r,h]=x.useState([]),[g,f]=x.useState(null),[w,N]=x.useState(!0),v=M(w,2e3),[i,n]=x.useState(!1),[d,j]=x.useState(null);x.useEffect(()=>{k(),s()},[]);const k=async()=>{var t;try{const a=await fetch(`${p()}/workflows/sla-policies`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const c=await a.json();h(c)}catch(a){if((t=a==null?void 0:a.message)!=null&&t.includes("Failed to fetch")||(a==null?void 0:a.code)==="ERR_NETWORK"){h([]),N(!1);return}console.error("Failed to fetch SLA policies:",a)}finally{N(!1)}},s=async()=>{var t;try{const a=await fetch(`${p()}/workflows/sla-stats`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const c=await a.json();f(c)}catch(a){if((t=a==null?void 0:a.message)!=null&&t.includes("Failed to fetch")||(a==null?void 0:a.code)==="ERR_NETWORK")return;console.error("Failed to fetch SLA stats:",a)}},o=async t=>{var u;const a=r.find(l=>l.id===t),{showDeleteConfirm:c,showSuccess:T,showError:y}=await B(async()=>{const{showDeleteConfirm:l,showSuccess:E,showError:P}=await import("./sweetalert-BCvQYi5m.js");return{showDeleteConfirm:l,showSuccess:E,showError:P}},[]);if((await c((a==null?void 0:a.name)||"this SLA policy","This SLA policy will be permanently deleted and cannot be recovered.")).isConfirmed)try{if(!(await fetch(`${p()}/workflows/sla-policies/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).ok)throw new Error("Failed to delete policy");h(r.filter(E=>E.id!==t)),T("SLA policy deleted successfully")}catch(l){if((u=l==null?void 0:l.message)!=null&&u.includes("Failed to fetch")||(l==null?void 0:l.code)==="ERR_NETWORK"){y("Cannot connect to server. Please ensure the backend is running.");return}console.error("Failed to delete SLA policy:",l),y("Failed to delete SLA policy. Please try again.")}},b=async t=>{const a=d?`${p()}/workflows/sla-policies/${d.id}`:`${p()}/workflows/sla-policies`,c=d?"PUT":"POST",T={name:t.name,description:t.description,priority:t.priority,responseTimeMinutes:t.responseTime,resolutionTimeMinutes:t.resolutionTime,businessHoursOnly:t.businessHoursOnly,escalationEnabled:t.escalationEnabled,escalationUserId:t.escalationUserId||null,notifyBeforeMinutes:t.notifyBeforeMinutes,isActive:t.isActive},y=await fetch(a,{method:c,headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(T)});if(!y.ok){const u=await y.json().catch(()=>({message:"Unknown error"}));throw console.error("Failed to save SLA policy:",u),new Error(u.message||"Failed to save SLA policy")}const A=await y.json();h(d?r.map(u=>u.id===A.id?A:u):[...r,A]),n(!1),j(null),s()},m=t=>{if(t<60)return`${t}m`;const a=Math.floor(t/60),c=t%60;return c>0?`${a}h ${c}m`:`${a}h`},S=t=>{const a={critical:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",high:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400",medium:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",low:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400"};return a[t]||a.medium};return v?e.jsx(I,{message:"Loading SLA policies..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"SLA Policies"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Manage Service Level Agreement policies and track compliance"})]}),e.jsxs("button",{onClick:()=>n(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(O,{className:"w-4 h-4"}),"Create Policy"]})]}),g&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Compliance Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[g.complianceRate,"%"]})]}),e.jsx(H,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"On Track"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:g.onTrack})]}),e.jsx(C,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"At Risk"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:g.atRisk})]}),e.jsx(L,{className:"w-8 h-8 text-yellow-600"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Breached"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:g.breached})]}),e.jsx(L,{className:"w-8 h-8 text-red-600"})]})})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:r.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(C,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No SLA policies yet"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Create SLA policies to track response and resolution times"}),e.jsx("button",{onClick:()=>n(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Create Policy"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-750 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Priority"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Response Time"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Resolution Time"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Business Hours"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Escalation"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:r.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-750",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.name}),t.description&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.description})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full capitalize ${S(t.priority)}`,children:t.priority})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:m(t.responseTimeMinutes)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:m(t.resolutionTimeMinutes)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t.businessHoursOnly?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-400"}`,children:t.businessHoursOnly?"Yes":"No"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t.escalationEnabled?"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-400"}`,children:t.escalationEnabled?"Enabled":"Disabled"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t.isActive?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-400"}`,children:t.isActive?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{j(t),n(!0)},className:"p-1 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded",title:"Edit policy",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>o(t.id),className:"p-1 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",title:"Delete policy",children:e.jsx(R,{className:"w-4 h-4"})})]})})]},t.id))})]})})}),i&&e.jsx(_,{policy:d?{...d,responseTime:d.responseTimeMinutes,resolutionTime:d.resolutionTimeMinutes}:null,onSave:b,onCancel:()=>{n(!1),j(null)}})]})}export{X as default};
