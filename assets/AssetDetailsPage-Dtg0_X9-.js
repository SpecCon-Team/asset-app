import{c as L,r as g,j as e,M as U,D as A,z as u,u as P,n as Q,Q as I,l as E}from"./index-B2LBA6Oe.js";import{u as M}from"./store-ByPNNk6v.js";import{l as z}from"./api-BUVJA4bF.js";import{Q as F}from"./index-BIlf1MjU.js";import"./api-CrNvfTMq.js";import"./types-D8_qC6eW.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=L("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);function G({isOpen:p,onClose:i,assetCode:l,assetName:s,assetId:f}){const b=g.useRef(null),v=`${window.location.origin}/assets/${f}`,_=()=>{var c;try{const a=(c=b.current)==null?void 0:c.querySelector("svg");if(!a)return;const d=document.createElement("canvas"),x=d.getContext("2d");if(!x)return;const o=512;d.width=o,d.height=o;const t=new XMLSerializer().serializeToString(a),h=new Image,n=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),N=URL.createObjectURL(n);h.onload=()=>{x.fillStyle="white",x.fillRect(0,0,o,o),x.drawImage(h,0,0,o,o),d.toBlob(j=>{if(j){const y=document.createElement("a");y.download=`QR_${l}.png`,y.href=URL.createObjectURL(j),y.click(),URL.revokeObjectURL(y.href),u.success("QR Code downloaded!")}},"image/png"),URL.revokeObjectURL(N)},h.src=N}catch(a){console.error("Download error:",a),u.error("Failed to download QR code")}},S=()=>{var c;try{const a=(c=b.current)==null?void 0:c.querySelector("svg");if(!a)return;const d=new XMLSerializer().serializeToString(a),x=new Blob([d],{type:"image/svg+xml;charset=utf-8"}),o=URL.createObjectURL(x),t=document.createElement("a");t.download=`QR_${l}.svg`,t.href=o,t.click(),URL.revokeObjectURL(o),u.success("QR Code SVG downloaded!")}catch(a){console.error("Download error:",a),u.error("Failed to download QR code")}},w=()=>{var c;try{const a=window.open("","_blank");if(!a){u.error("Please allow popups to print");return}const d=(c=b.current)==null?void 0:c.querySelector("svg");if(!d)return;const x=new XMLSerializer().serializeToString(d);a.document.write(`
        <!DOCTYPE html>
        <html>
          <head>
            <title>QR Code - ${l}</title>
            <style>
              body {
                margin: 0;
                padding: 20px;
                font-family: Arial, sans-serif;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
              }
              .qr-container {
                text-align: center;
                page-break-inside: avoid;
              }
              .qr-code {
                margin: 20px auto;
                width: 300px;
                height: 300px;
              }
              h1 {
                font-size: 24px;
                margin-bottom: 10px;
              }
              p {
                font-size: 16px;
                color: #666;
                margin: 5px 0;
              }
              @media print {
                body {
                  padding: 0;
                }
              }
            </style>
          </head>
          <body>
            <div class="qr-container">
              <h1>${s}</h1>
              <p><strong>Asset Code:</strong> ${l}</p>
              <div class="qr-code">${x}</div>
              <p style="font-size: 12px; margin-top: 20px;">Scan to view asset details</p>
            </div>
          </body>
        </html>
      `),a.document.close(),a.focus(),setTimeout(()=>{a.print(),a.close()},250),u.success("Opening print dialog...")}catch(a){console.error("Print error:",a),u.error("Failed to print QR code")}};return e.jsx(U,{isOpen:p,onClose:i,title:"Asset QR Code",size:"md",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{ref:b,className:"flex flex-col items-center",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg border-2 border-gray-200 dark:border-gray-700",children:e.jsx(F,{value:v,size:256,level:"H",includeMargin:!0,imageSettings:{src:"",height:0,width:0,excavate:!0}})}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:s}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium",children:"Code:"})," ",l]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:"Scan to view asset details"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:_,className:"flex-1 px-4 py-2.5 bg-blue-600 dark:bg-blue-500 text-white rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 flex items-center justify-center gap-2 font-medium transition-colors",children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{children:"Download PNG"})]}),e.jsxs("button",{onClick:S,className:"flex-1 px-4 py-2.5 bg-green-600 dark:bg-green-500 text-white rounded-lg hover:bg-green-700 dark:hover:bg-green-600 flex items-center justify-center gap-2 font-medium transition-colors",children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{children:"Download SVG"})]}),e.jsxs("button",{onClick:w,className:"flex-1 px-4 py-2.5 bg-purple-600 dark:bg-purple-500 text-white rounded-lg hover:bg-purple-700 dark:hover:bg-purple-600 flex items-center justify-center gap-2 font-medium transition-colors",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsx("span",{children:"Print"})]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"How to use:"}),e.jsxs("ul",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Download PNG for digital use or printing"}),e.jsx("li",{children:"Download SVG for scalable vector graphics"}),e.jsx("li",{children:"Print directly to attach to physical asset"}),e.jsx("li",{children:"Scan with any QR code scanner app"}),e.jsx("li",{children:"Link opens asset details page automatically"})]})]}),e.jsx("div",{className:"flex justify-center pt-2",children:e.jsx("button",{onClick:i,className:"px-6 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors font-medium",children:"Close"})})]})})}function X(){var j,y,D;const p=P(),{id:i}=Q(),l=i&&i!=="new",{currentAsset:s,isLoading:f,error:b,fetchAssetById:v,createAsset:_,updateAsset:S}=M(),[w,c]=g.useState([]),[a,d]=g.useState(!0),[x,o]=g.useState(!1),[t,h]=g.useState({asset_code:"",name:"",serial_number:"",remote_id:"",asset_type:"",condition:"",status:"available",assigned_to:"",scanned_by:"",scan_datetime:"",description:"",ownership:"",office_location:"",extension:"",deskphones:"",mouse:"",keyboard:"",department:"",notes:"",ownerId:""});g.useEffect(()=>{const r=localStorage.getItem("user");r&&JSON.parse(r).role!=="ADMIN"&&p("/my-assets")},[p]),g.useEffect(()=>{(async()=>{try{const m=await z();c(m)}catch(m){console.error("Failed to fetch users:",m)}finally{d(!1)}})()},[]),g.useEffect(()=>{l&&i&&v(i)},[i,l,v]),g.useEffect(()=>{s&&l&&h({asset_code:s.asset_code||"",name:s.name||"",serial_number:s.serial_number||"",remote_id:s.remote_id||"",asset_type:s.asset_type||"",condition:s.condition||"",status:s.status||"available",assigned_to:s.assigned_to||"",scanned_by:s.scanned_by||"",scan_datetime:s.scan_datetime||"",description:s.description||"",ownership:s.ownership||"",office_location:s.office_location||"",extension:s.extension||"",deskphones:s.deskphones||"",mouse:s.mouse||"",keyboard:s.keyboard||"",department:s.department||"",notes:s.notes||"",ownerId:s.ownerId||""})},[s,l]);const n=r=>{const{name:m,value:k}=r.target;if(m==="ownerId"){const C=w.find(R=>R.id===k);h(R=>({...R,ownerId:k,assigned_to:C?C.email:"",status:k?"assigned":"available"}))}else h(C=>({...C,[m]:k}))},N=async r=>{r.preventDefault();try{l&&i?(await S(i,t),u.success("Asset updated successfully")):(await _(t),u.success("Asset created successfully")),p("/assets")}catch(m){console.error("Failed to save asset:",m),u.error(l?"Failed to update asset":"Failed to create asset")}};return f&&l?e.jsx("div",{className:"p-8",children:"Loading asset..."}):e.jsxs("div",{className:"p-8 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("button",{onClick:()=>p("/assets"),className:"text-blue-600 hover:text-blue-700 mb-4 flex items-center gap-2",children:"â† Back to Assets"}),e.jsx("h1",{className:"text-3xl font-bold dark:text-white",children:l?"Edit Asset":"Create New Asset"})]}),b&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-600",children:b}),e.jsxs("form",{onSubmit:N,className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Asset Code (Auto-generated)"}),e.jsx("input",{type:"text",name:"asset_code",value:t.asset_code,disabled:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-600 cursor-not-allowed",placeholder:"Will be auto-generated"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Asset codes are automatically generated and cannot be changed"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Asset Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"name",value:t.name,onChange:n,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., Dell Laptop"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Serial Number"}),e.jsx("input",{type:"text",name:"serial_number",value:t.serial_number,onChange:n,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., SN123456789"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Remote ID"}),e.jsx("input",{type:"text",name:"remote_id",value:t.remote_id,onChange:n,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., RMT-001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Asset Type"}),e.jsx("input",{type:"text",name:"asset_type",value:t.asset_type,onChange:n,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., Laptop, Desktop, Monitor"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Condition"}),e.jsxs("select",{name:"condition",value:t.condition,onChange:n,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select condition"}),e.jsx("option",{value:"Excellent",children:"Excellent"}),e.jsx("option",{value:"Good",children:"Good"}),e.jsx("option",{value:"Fair",children:"Fair"}),e.jsx("option",{value:"Poor",children:"Poor"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{name:"status",value:t.status,onChange:n,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"available",children:"Available"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"maintenance",children:"Maintenance"}),e.jsx("option",{value:"repair",children:"Repair"}),e.jsx("option",{value:"retired",children:"Retired"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assigned To (User)"}),e.jsxs("select",{name:"ownerId",value:t.ownerId,onChange:n,disabled:a,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select a user (optional)"}),w.map(r=>e.jsxs("option",{value:r.id,children:[r.email," ",r.name?`(${r.name})`:""]},r.id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Select the user who will be assigned this asset"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department"}),e.jsx("input",{type:"text",name:"department",value:t.department,onChange:n,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., IT, HR, Finance"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Office Location"}),e.jsx("input",{type:"text",name:"office_location",value:t.office_location,onChange:n,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., Building A, Floor 3"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ownership"}),e.jsx("input",{type:"text",name:"ownership",value:t.ownership,onChange:n,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., Company, Leased"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Extension"}),e.jsx("input",{type:"text",name:"extension",value:t.extension,onChange:n,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Phone extension"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Desk Phones"}),e.jsx("input",{type:"text",name:"deskphones",value:t.deskphones,onChange:n,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Phone numbers"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Mouse"}),e.jsx("input",{type:"text",name:"mouse",value:t.mouse,onChange:n,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Mouse type/model"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Keyboard"}),e.jsx("input",{type:"text",name:"keyboard",value:t.keyboard,onChange:n,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Keyboard type/model"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Scanned By"}),e.jsx("input",{type:"text",name:"scanned_by",value:t.scanned_by,onChange:n,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Scanner name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Scan Date/Time"}),e.jsx("input",{type:"text",name:"scan_datetime",value:t.scan_datetime,onChange:n,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Scan date and time"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{name:"description",value:t.description,onChange:n,rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Asset description..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{name:"notes",value:t.notes,onChange:n,rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Additional notes..."})]})]}),e.jsxs("div",{className:"mt-8 flex gap-4 justify-end",children:[l&&s&&e.jsxs("button",{type:"button",onClick:()=>o(!0),className:"px-6 py-2 bg-purple-600 dark:bg-purple-500 text-white rounded-lg hover:bg-purple-700 dark:hover:bg-purple-600 flex items-center gap-2 transition-colors",children:[e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{children:"Generate QR Code"})]}),e.jsx("button",{type:"button",onClick:()=>p("/assets"),className:"px-6 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 dark:text-gray-300 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:f,className:"px-6 py-2 bg-blue-600 dark:bg-blue-500 text-white rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 disabled:bg-gray-400 transition-colors flex items-center gap-2",children:f?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("span",{className:"sr-only",children:"Saving"})]}):l?"Update Asset":"Create Asset"})]})]}),l&&s&&e.jsx(G,{isOpen:x,onClose:()=>o(!1),assetCode:s.asset_code||"",assetName:s.name||"",assetId:s.id||""}),l&&s&&s.tickets&&e.jsxs("div",{className:"mt-8 bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 dark:text-white",children:["Related Tickets (",((j=s.tickets)==null?void 0:j.length)||0,")"]}),((y=s.tickets)==null?void 0:y.length)===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:"No tickets associated with this asset"}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Ticket #"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Title"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Priority"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Created"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:(D=s.tickets)==null?void 0:D.map(r=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-blue-600 dark:text-blue-400",children:r.number||r.id}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-white",children:r.title}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${r.status==="closed"?"bg-gray-100 text-gray-800":r.status==="in_progress"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:r.status})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${r.priority==="critical"?"bg-red-100 text-red-800":r.priority==="high"?"bg-orange-100 text-orange-800":r.priority==="medium"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:r.priority})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:E(r.createdAt)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm",children:e.jsx("button",{onClick:()=>p(`/tickets/${r.id}`),className:"text-blue-600 hover:text-blue-800 font-medium",children:"View"})})]},r.id))})]})})]})]})}export{X as default};
