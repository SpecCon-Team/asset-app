import{j as e}from"./vendor-charts-DVp8BQgJ.js";import{r,u as U}from"./vendor-react-CFQdvhEG.js";import{u as Y,a as x,L as q,B as y}from"./index-B1z0njpd.js";import{showError as f,showWarning as M,showSuccess as u,showCustom as P}from"./sweetalert-DcBwdyhg.js";import{b as $,i as w,w as j,aE as G,aF as W,D as z}from"./vendor-ui-Bhgb65c8.js";function _(){const[n,l]=r.useState("status"),[k,N]=r.useState(""),[h,v]=r.useState(""),[m,C]=r.useState([]),[i,S]=r.useState(""),[c,d]=r.useState(!1),[F,b]=r.useState(!0),A=Y(F,2e3),[E,g]=r.useState(!1),[B,L]=r.useState(0),p=U();r.useEffect(()=>{R()},[]);const R=async()=>{try{b(!0);const t=await x().get("/2fa/status");g(t.data.enabled),L(t.data.backupCodesRemaining)}catch(t){console.error("Failed to check 2FA status:",t)}finally{b(!1)}},D=async()=>{var t,s;try{d(!0);const a=await x().post("/2fa/setup");N(a.data.qrCode),v(a.data.secret),C(a.data.backupCodes),l("setup")}catch(a){f("Error",((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to setup 2FA")}finally{d(!1)}},T=async()=>{var t,s;if(i.length!==6){M("Invalid Code","Please enter a 6-digit code");return}try{d(!0),await x().post("/2fa/verify-setup",{token:i}),l("complete"),g(!0),u("Success!","2FA has been enabled successfully")}catch(a){f("Verification Failed",((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"Invalid verification code")}finally{d(!1)}},V=async()=>{(await P({title:"Disable 2FA?",text:"Enter your 6-digit code to disable two-factor authentication",input:"text",inputAttributes:{maxlength:"6",placeholder:"000000"},showCancelButton:!0,confirmButtonColor:"#EF4444",confirmButtonText:"Disable 2FA",showLoaderOnConfirm:!0,preConfirm:async s=>{var a,o;try{return await x().post("/2fa/disable",{token:s}),!0}catch(Q){return((o=(a=Q.response)==null?void 0:a.data)==null?void 0:o.message)||"Invalid code"}}})).isConfirmed&&(g(!1),l("status"),u("Disabled","2FA has been disabled"))},I=t=>{navigator.clipboard.writeText(t),u("Copied!","Copied to clipboard",1500)},O=()=>{const t=`Two-Factor Authentication Backup Codes

Save these codes in a safe place. Each code can only be used once.

${m.join(`
`)}`,s=new Blob([t],{type:"text/plain"}),a=URL.createObjectURL(s),o=document.createElement("a");o.href=a,o.download=`2fa-backup-codes-${Date.now()}.txt`,o.click(),URL.revokeObjectURL(a)};return A?e.jsx(q,{message:"Loading 2FA settings..."}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-12 px-4",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx($,{className:"w-16 h-16 text-blue-600 dark:text-blue-400 mx-auto mb-4"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Two-Factor Authentication"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:"Add an extra layer of security to your account"})]}),n==="status"&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8",children:E?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center",children:e.jsx(w,{className:"w-8 h-8 text-green-600 dark:text-green-400"})})}),e.jsx("h2",{className:"text-2xl font-bold text-center text-gray-900 dark:text-white mb-4",children:"2FA is Enabled"}),e.jsx("p",{className:"text-center text-gray-600 dark:text-gray-300 mb-6",children:"Your account is protected with two-factor authentication"}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mb-6",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:[e.jsx("strong",{children:"Backup Codes Remaining:"})," ",B," / 10"]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:V,className:"flex-1 px-6 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold transition-colors",children:"Disable 2FA"}),e.jsx("button",{onClick:()=>p("/my-profile"),className:"flex-1 px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-900 dark:text-white rounded-lg font-semibold transition-colors",children:"Back to Profile"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold text-center text-gray-900 dark:text-white mb-4",children:"Secure Your Account"}),e.jsx("p",{className:"text-center text-gray-600 dark:text-gray-300 mb-6",children:"Two-factor authentication adds an extra layer of security by requiring a code from your phone in addition to your password."}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(j,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-300",children:[e.jsx("strong",{children:"Before you start:"})," Make sure you have an authenticator app installed on your phone (Google Authenticator, Authy, Microsoft Authenticator, etc.)"]})})]})}),e.jsx("button",{onClick:D,disabled:c,className:"w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white rounded-lg font-semibold transition-colors flex items-center justify-center gap-2",children:c?e.jsxs(e.Fragment,{children:[e.jsx(y,{})," Setting up..."]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-5 h-5"}),"Enable 2FA"]})})]})}),n==="setup"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-6",children:"Step 1: Scan QR Code"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"Scan this QR code with your authenticator app"}),e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("div",{className:"bg-white p-4 rounded-lg",children:e.jsx("img",{src:k,alt:"2FA QR Code",className:"w-64 h-64"})})}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-2",children:"Can't scan? Enter this code manually:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"flex-1 bg-white dark:bg-gray-800 px-4 py-2 rounded text-sm font-mono",children:h}),e.jsx("button",{onClick:()=>I(h),className:"p-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",title:"Copy to clipboard",children:e.jsx(W,{className:"w-5 h-5"})})]})]}),e.jsx("button",{onClick:()=>l("verify"),className:"w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition-colors",children:"Next: Enter Verification Code"})]}),n==="verify"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-6",children:"Step 2: Verify Code"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"Enter the 6-digit code from your authenticator app"}),e.jsx("input",{type:"text",maxLength:6,value:i,onChange:t=>S(t.target.value.replace(/\D/g,"")),placeholder:"000000",className:"w-full px-4 py-3 border dark:border-gray-700 rounded-lg text-center text-2xl font-mono tracking-widest bg-white dark:bg-gray-900 text-gray-900 dark:text-white mb-6",autoFocus:!0}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>l("setup"),className:"flex-1 px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-900 dark:text-white rounded-lg font-semibold transition-colors",children:"Back"}),e.jsx("button",{onClick:T,disabled:c||i.length!==6,className:"flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white rounded-lg font-semibold transition-colors flex items-center justify-center gap-2",children:c?e.jsxs(e.Fragment,{children:[e.jsx(y,{})," Verifying..."]}):"Verify & Enable"})]})]}),n==="complete"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8",children:[e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center",children:e.jsx(w,{className:"w-8 h-8 text-green-600 dark:text-green-400"})})}),e.jsx("h2",{className:"text-2xl font-bold text-center text-gray-900 dark:text-white mb-4",children:"2FA Enabled Successfully!"}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(j,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-300 font-semibold mb-2",children:"Save Your Backup Codes"}),e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-300",children:"Store these codes in a safe place. You can use them to access your account if you lose your phone."})]})]})}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6",children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:m.map((t,s)=>e.jsx("div",{className:"bg-white dark:bg-gray-800 px-3 py-2 rounded text-center font-mono text-sm",children:t},s))})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{onClick:O,className:"flex-1 px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold transition-colors flex items-center justify-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"Download Codes"]}),e.jsx("button",{onClick:()=>p("/my-profile"),className:"flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition-colors",children:"Done"})]})]})]})})}export{_ as default};
