import{u as D,l as C,r as o,e as u,z as S,j as e,V as A}from"./index-CMCHWJER.js";import{showSuccess as y,showError as T}from"./sweetalert-BCvQYi5m.js";import{A as I}from"./arrow-left-DOdWxo25.js";import{C as q}from"./calendar-CifskBj0.js";function L(){const x=D(),{id:c}=C(),d=c&&c!=="new",[m,h]=o.useState(!1),[p,b]=o.useState([]),[f,j]=o.useState([]),[a,g]=o.useState({assetId:"",title:"",description:"",scheduleType:"one-time",frequency:"",nextDueDate:"",priority:"medium",estimatedDuration:"",cost:"",assignedToId:"",isActive:!0});o.useEffect(()=>{k(),w(),d&&v()},[d,c]);const k=async()=>{try{const s=await u().get("/assets?limit=-1"),i=Array.isArray(s.data)?s.data:s.data.data||[];b(i)}catch(t){console.error("Failed to fetch assets:",t)}},w=async()=>{try{const s=await u().get("/users"),i=Array.isArray(s.data)?s.data:s.data.users||[];j(i.filter(l=>l.role==="TECHNICIAN"||l.role==="ADMIN"))}catch(t){console.error("Failed to fetch users:",t)}},v=async()=>{var t,s;try{const r=(await u().get(`/maintenance/${c}`)).data;g({assetId:r.assetId,title:r.title,description:r.description||"",scheduleType:r.scheduleType,frequency:r.frequency||"",nextDueDate:r.nextDueDate?new Date(r.nextDueDate).toISOString().split("T")[0]:"",priority:r.priority,estimatedDuration:((t=r.estimatedDuration)==null?void 0:t.toString())||"",cost:((s=r.cost)==null?void 0:s.toString())||"",assignedToId:r.assignedToId||"",isActive:r.isActive})}catch(i){console.error("Failed to fetch schedule:",i),S.error("Failed to load maintenance schedule")}},N=async t=>{var s,i;t.preventDefault(),h(!0);try{const l=u(),r={...a,estimatedDuration:a.estimatedDuration?parseInt(a.estimatedDuration):null,cost:a.cost?parseFloat(a.cost):null,assignedToId:a.assignedToId||null};d?(await l.put(`/maintenance/${c}`,r),await y("Success!","Maintenance schedule updated successfully")):(await l.post("/maintenance",r),await y("Success!","Maintenance schedule created successfully")),x("/maintenance")}catch(l){console.error("Failed to save maintenance schedule:",l),await T("Error",((i=(s=l.response)==null?void 0:s.data)==null?void 0:i.error)||"Failed to save maintenance schedule")}finally{h(!1)}},n=t=>{const{name:s,value:i,type:l}=t.target;g(l==="checkbox"?r=>({...r,[s]:t.target.checked}):r=>({...r,[s]:i}))};return e.jsxs("div",{className:"flex flex-col p-4 md:p-6 lg:p-8 max-w-4xl mx-auto w-full",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>x("/maintenance"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white mb-4",children:[e.jsx(I,{className:"w-5 h-5"}),"Back to Maintenance"]}),e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[e.jsx(A,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"}),d?"Edit Maintenance Schedule":"Schedule New Maintenance"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:d?"Update maintenance schedule details":"Create a new maintenance schedule for an asset"})]}),e.jsxs("form",{onSubmit:N,className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 max-w-4xl",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Asset ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"assetId",value:a.assetId,onChange:n,required:!0,className:"w-full px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select an asset"}),p.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.asset_code,") - ",t.asset_type]},t.id))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Maintenance Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"title",value:a.title,onChange:n,required:!0,placeholder:"e.g., Quarterly Inspection",className:"w-full px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description"}),e.jsx("textarea",{name:"description",value:a.description,onChange:n,rows:3,placeholder:"Detailed maintenance description...",className:"w-full px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Schedule Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"scheduleType",value:a.scheduleType,onChange:n,required:!0,className:"w-full px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"one-time",children:"One-time"}),e.jsx("option",{value:"recurring",children:"Recurring"})]})]}),a.scheduleType==="recurring"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Frequency ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"frequency",value:a.frequency,onChange:n,required:a.scheduleType==="recurring",className:"w-full px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select frequency"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"quarterly",children:"Quarterly"}),e.jsx("option",{value:"yearly",children:"Yearly"})]})]}),e.jsxs("div",{className:a.scheduleType==="one-time"?"md:col-span-2":"",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.scheduleType==="one-time"?"Due Date":"Next Due Date"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"nextDueDate",value:a.nextDueDate,onChange:n,required:!0,className:"w-full px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Priority ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"priority",value:a.priority,onChange:n,required:!0,className:"w-full px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"critical",children:"Critical"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Estimated Duration (minutes)"}),e.jsx("input",{type:"number",name:"estimatedDuration",value:a.estimatedDuration,onChange:n,min:"0",placeholder:"e.g., 60",className:"w-full px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Estimated Cost (R)"}),e.jsx("input",{type:"number",name:"cost",value:a.cost,onChange:n,min:"0",step:"0.01",placeholder:"e.g., 150.00",className:"w-full px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Assign To"}),e.jsxs("select",{name:"assignedToId",value:a.assignedToId,onChange:n,className:"w-full px-4 py-2 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Unassigned"}),f.map(t=>e.jsx("option",{value:t.id,children:t.name||t.email},t.id))]})]}),d&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",name:"isActive",checked:a.isActive,onChange:n,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Active Schedule"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Inactive schedules won't trigger reminders or appear in upcoming tasks"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-8",children:[e.jsx("button",{type:"button",onClick:()=>x("/maintenance"),className:"px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:m,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition-colors flex items-center gap-2",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-5 h-5"}),d?"Update Schedule":"Create Schedule"]})})]})]})]})}export{L as default};
