import{j as e}from"./vendor-charts-DVp8BQgJ.js";import{r as s}from"./vendor-react-CFQdvhEG.js";import{l as A,a as E}from"./index-e6x7aUYm.js";import{ab as z,aQ as b,aR as T,aS as $,X as R,U as H,T as K,aT as O}from"./vendor-ui-Bhgb65c8.js";function W(){const[c,p]=s.useState(!1),[l,I]=s.useState(!1),[r,a]=s.useState([]),[u,w]=s.useState(""),[m,y]=s.useState(!1),[v,h]=s.useState(!1),j=s.useRef(null),N=s.useRef(null),i=s.useRef(A()).current,x=`aiChatHistory_${i||"guest"}`,g=`aiChatWelcomeShown_${i||"guest"}`;s.useEffect(()=>{if(!i)return;const t=localStorage.getItem(x),n=localStorage.getItem(g);if(t)try{const d=JSON.parse(t);a(d.map(o=>{const f=o.timestamp?new Date(o.timestamp):new Date;return isNaN(f.getTime())?{...o,timestamp:new Date}:{...o,timestamp:f}}))}catch(d){console.error("Error parsing saved messages:",d),a([])}else a([]);h(!!n)},[]),s.useEffect(()=>{i&&r.length>0&&localStorage.setItem(x,JSON.stringify(r))},[r,i,x]),s.useEffect(()=>{var t;(t=j.current)==null||t.scrollIntoView({behavior:"smooth"})},[r]),s.useEffect(()=>{if(c&&!v&&r.length===0&&i){const t={id:Date.now().toString(),role:"assistant",content:`Hello! I'm your AI assistant for AssetTrack Pro. I can help you with:

• Managing your assets and tickets
• Troubleshooting issues
• Answering questions about the system
• Navigating features
• General support

How can I assist you today?`,timestamp:new Date};a([t]),h(!0),localStorage.setItem(g,"true")}},[c,v,r.length,i,g]),s.useEffect(()=>{var t;c&&!l&&((t=N.current)==null||t.focus())},[c,l]);const k=async()=>{if(!u.trim()||m)return;const t={id:Date.now().toString(),role:"user",content:u.trim(),timestamp:new Date};a(n=>[...n,t]),w(""),y(!0);try{const d=await E().post("/ai-chat",{message:t.content,history:r.slice(-10)}),o={id:(Date.now()+1).toString(),role:"assistant",content:d.data.reply,timestamp:new Date};a(f=>[...f,o])}catch(n){console.error("AI Chat error:",n);const d={id:(Date.now()+1).toString(),role:"assistant",content:"I apologize, but I'm having trouble connecting right now. Please try again in a moment or contact support if the issue persists.",timestamp:new Date};a(o=>[...o,d])}finally{y(!1)}},C=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),k())},S=()=>{a([]),h(!1),i&&(localStorage.removeItem(x),localStorage.removeItem(g))},D=()=>{p(!1),S()},M=t=>{if(!t||!(t instanceof Date)||isNaN(t.getTime()))return"Just now";try{return new Date(t).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch{return"Just now"}};return e.jsxs(e.Fragment,{children:[!c&&e.jsxs("button",{onClick:()=>p(!0),className:"fixed bottom-6 right-6 z-50 group","aria-label":"Open AI Chat",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full animate-ping opacity-75"}),e.jsx("div",{className:"relative bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white rounded-full shadow-2xl transition-all duration-300 transform group-hover:scale-110 p-4",children:e.jsx(z,{className:"w-6 h-6"})}),e.jsx("div",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold animate-bounce",children:"AI"})]}),e.jsxs("div",{className:"absolute bottom-full right-0 mb-2 px-4 py-2 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap",children:[e.jsx("div",{className:"font-semibold",children:"Live Chat"}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Available 24/7"}),e.jsx("div",{className:"absolute top-full right-4 border-4 border-transparent border-t-white dark:border-t-gray-800"})]})]}),c&&e.jsx("div",{className:`fixed z-50 transition-all duration-300 ease-in-out
            ${l?"bottom-6 right-6 w-80":"bottom-6 right-6 w-96 h-[600px] md:w-[420px]"}
            max-w-[calc(100vw-3rem)] max-h-[calc(100vh-3rem)]
          `,children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl flex flex-col h-full border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-blue-600 p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white/20 backdrop-blur-sm p-2 rounded-full",children:e.jsx(b,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"text-white",children:[e.jsx("div",{className:"font-semibold text-lg",children:"AI Assistant"}),e.jsxs("div",{className:"text-xs text-white/90 flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),"Available 24/7"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>I(!l),className:"p-2 hover:bg-white/20 rounded-lg transition-colors","aria-label":l?"Maximize":"Minimize",children:l?e.jsx(T,{className:"w-4 h-4 text-white"}):e.jsx($,{className:"w-4 h-4 text-white"})}),e.jsx("button",{onClick:D,className:"p-2 hover:bg-white/20 rounded-lg transition-colors","aria-label":"Close chat",children:e.jsx(R,{className:"w-4 h-4 text-white"})})]})]}),!l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50 dark:bg-gray-900",children:[r.map(t=>e.jsxs("div",{className:`flex gap-3 ${t.role==="user"?"flex-row-reverse":"flex-row"}`,children:[e.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${t.role==="user"?"bg-blue-600":"bg-gradient-to-r from-purple-600 to-blue-600"}`,children:t.role==="user"?e.jsx(H,{className:"w-4 h-4 text-white"}):e.jsx(b,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:`flex-1 max-w-[80%] ${t.role==="user"?"items-end":"items-start"}`,children:[e.jsx("div",{className:`rounded-2xl px-4 py-2 ${t.role==="user"?"bg-blue-600 text-white rounded-br-sm":"bg-white dark:bg-gray-800 text-gray-900 dark:text-white border border-gray-200 dark:border-gray-700 rounded-bl-sm"}`,children:e.jsx("div",{className:"text-sm whitespace-pre-wrap break-words",children:t.content})}),e.jsx("div",{className:`text-xs text-gray-500 dark:text-gray-400 mt-1 px-2 ${t.role==="user"?"text-right":"text-left"}`,children:M(t.timestamp)})]})]},t.id)),m&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-gradient-to-r from-purple-600 to-blue-600 flex items-center justify-center",children:e.jsx(b,{className:"w-4 h-4 text-white"})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl rounded-bl-sm px-4 py-3",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})]}),e.jsx("div",{ref:j})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 p-4 bg-white dark:bg-gray-800",children:[r.length>1&&e.jsxs("button",{onClick:S,className:"text-xs text-gray-500 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400 mb-2 flex items-center gap-1 transition-colors",children:[e.jsx(K,{className:"w-3 h-3"}),"Clear conversation"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("textarea",{ref:N,value:u,onChange:t=>w(t.target.value),onKeyPress:C,placeholder:"Type your message...",rows:1,className:"flex-1 resize-none border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white text-sm max-h-32",disabled:m}),e.jsx("button",{onClick:k,disabled:!u.trim()||m,className:"bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed text-white p-3 rounded-xl transition-all duration-200 transform hover:scale-105 disabled:hover:scale-100","aria-label":"Send message",children:e.jsx(O,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2 text-center",children:"Press Enter to send, Shift+Enter for new line"})]})]})]})})]})}export{W as default};
