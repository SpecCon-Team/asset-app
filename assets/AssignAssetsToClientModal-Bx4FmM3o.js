import{j as e}from"./vendor-charts-DVp8BQgJ.js";import{r}from"./vendor-react-CFQdvhEG.js";import{a as N}from"./index-BJREwX_9.js";import{showError as y,showSuccess as H}from"./sweetalert-DcBwdyhg.js";import{$ as J,X as K,e as F,_ as v,l as P,P as Q,i as V,a2 as W,a3 as Y}from"./vendor-ui-Bhgb65c8.js";function re({isOpen:b,onClose:u,onSuccess:p}){const[g,f]=r.useState("select-client"),[B,C]=r.useState([]),[T,S]=r.useState([]),[i,j]=r.useState(null),[a,k]=r.useState(new Set),[A,m]=r.useState(!1),[L,$]=r.useState(!1),[h,_]=r.useState(""),[d,w]=r.useState(""),[c,x]=r.useState("all");r.useEffect(()=>{b&&(q(),f("select-client"),j(null),k(new Set),_(""),w(""),x("all"))},[b]);const q=async()=>{try{m(!0);const t=await N().get("/peg");C(t.data)}catch(s){console.error("Error loading clients:",s),y("Error","Failed to load clients"),C([])}finally{m(!1)}},I=async()=>{try{m(!0);const t=await N().get("/assets/available");S(t.data)}catch(s){console.error("Error loading available assets:",s),y("Error","Failed to load available assets"),S([])}finally{m(!1)}},M=s=>{j(s),I(),f("assign-assets")},R=()=>{f("select-client"),j(null),k(new Set),w(""),x("all")},U=s=>{const t=new Set(a);t.has(s)?t.delete(s):t.add(s),k(t)},X=async()=>{var s,t;if(i){if(a.size===0){y("No Selection","Please select at least one asset to assign");return}$(!0);try{const l=N(),o=Array.from(a);for(const n of o)await l.post(`/peg/${i.id}/assets`,{assetId:n});H("Success",`${o.length} asset${o.length!==1?"s":""} assigned to ${i.name} successfully`),p==null||p(),u()}catch(l){console.error("Error assigning assets:",l),y("Error",((t=(s=l.response)==null?void 0:s.data)==null?void 0:t.error)||"Failed to assign assets")}finally{$(!1)}}},D=s=>{const t=(s==null?void 0:s.toLowerCase())||"";return t.includes("laptop")?e.jsx(W,{className:"w-5 h-5"}):t.includes("tablet")?e.jsx(Y,{className:"w-5 h-5"}):e.jsx(Q,{className:"w-5 h-5"})},G=s=>{const t=(s==null?void 0:s.toLowerCase())||"";return t.includes("good")||t.includes("excellent")?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":t.includes("fair")||t.includes("average")?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400":t.includes("poor")||t.includes("bad")?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"},E=B.filter(s=>{var l,o,n;if(!h)return!0;const t=h.toLowerCase();return s.name.toLowerCase().includes(t)||s.location.toLowerCase().includes(t)||((l=s.contactPerson)==null?void 0:l.toLowerCase().includes(t))||((o=s.phone)==null?void 0:o.toLowerCase().includes(t))||((n=s.email)==null?void 0:n.toLowerCase().includes(t))}),z=T.filter(s=>{var o,n;const t=!d||s.name.toLowerCase().includes(d.toLowerCase())||((o=s.serial_number)==null?void 0:o.toLowerCase().includes(d.toLowerCase()))||s.asset_code.toLowerCase().includes(d.toLowerCase()),l=c==="all"||((n=s.asset_type)==null?void 0:n.toLowerCase().includes(c.toLowerCase()));return t&&l});return b?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[g==="assign-assets"&&e.jsx("button",{onClick:R,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Back to client selection",children:e.jsx(J,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:g==="select-client"?"Assign Assets to Client":`Assign Assets to ${i==null?void 0:i.name}`}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:g==="select-client"?"Select a client to assign assets to":"Select assets to assign to this client"})]})]}),e.jsx("button",{onClick:u,className:"p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(K,{className:"w-5 h-5"})})]})}),g==="select-client"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search clients by name, location, contact person, phone, or email...",value:h,onChange:s=>_(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:A?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(v,{className:"w-8 h-8 text-blue-600 animate-spin"})}):E.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(P,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:h?"No clients match your search criteria":"No clients found"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:E.map(s=>e.jsx("button",{onClick:()=>M(s),className:"p-4 rounded-lg border-2 border-gray-200 dark:border-gray-700 hover:border-blue-500 dark:hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all text-left",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 flex items-center justify-center flex-shrink-0",children:e.jsx(P,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white truncate",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:s.location}),s.contactPerson&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Contact: ",s.contactPerson]}),s.phone&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Phone: ",s.phone]})]})]})},s.id))})})]}),g==="assign-assets"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by name, serial number, or code...",value:d,onChange:s=>w(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>x("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${c==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:"All"}),e.jsx("button",{onClick:()=>x("laptop"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${c==="laptop"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:"Laptops"}),e.jsx("button",{onClick:()=>x("tablet"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${c==="tablet"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:"Tablets"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:A?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(v,{className:"w-8 h-8 text-blue-600 animate-spin"})}):z.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Q,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:d||c!=="all"?"No assets match your search criteria":"No available assets found"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:z.map(s=>{const t=a.has(s.id);return e.jsx("div",{onClick:()=>U(s.id),className:`p-4 rounded-lg border-2 cursor-pointer transition-all ${t?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${t?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"}`,children:t?e.jsx(V,{className:"w-5 h-5"}):D(s.asset_type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white truncate",children:s.name}),s.serial_number&&e.jsxs("p",{className:"text-sm font-mono text-gray-600 dark:text-gray-400 mt-1",children:["SN: ",s.serial_number]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[s.asset_type&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded",children:s.asset_type}),s.condition&&e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${G(s.condition)}`,children:s.condition})]}),s.asset_code&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Code: ",s.asset_code]})]})]})},s.id)})})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:a.size>0&&e.jsxs("span",{children:[a.size," asset",a.size!==1?"s":""," selected"]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:u,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:X,disabled:a.size===0||L,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:L?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-4 h-4 animate-spin"}),"Assigning..."]}):`Assign ${a.size>0?`(${a.size})`:""}`})]})]})]})]})}):null}export{re as A};
