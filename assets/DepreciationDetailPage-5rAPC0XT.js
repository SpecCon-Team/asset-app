import{h as T,u as M,r as c,j as e,L as D}from"./react-vendor-DE6j8A-W.js";import{u as E,a as m,L as $}from"./index-DXiG9VXC.js";import{showError as p,showConfirmDialog as I,showSuccess as C}from"./sweetalert-B1UQUXK9.js";import"./export-libs-C_ZIqR8y.js";import"./vendor-DIIGlvtc.js";import"./ui-libs-QpcJ0xea.js";const U=()=>{var V,w,k;const{id:h}=T(),A=M(),[s,S]=c.useState(null),[g,P]=c.useState([]),[B,b]=c.useState(!0),L=E(B,2e3),[u,N]=c.useState("schedule"),[y,f]=c.useState(!1),[a,n]=c.useState({valuationDate:new Date().toISOString().split("T")[0],valuationType:"routine",bookValue:"",marketValue:"",replacementValue:"",condition:"good",appraisedBy:"",notes:""});c.useEffect(()=>{j()},[h]);const j=async()=>{var t,i;try{b(!0);const[l,x]=await Promise.all([m().get(`/depreciation/${h}`),m().get(`/depreciation/valuations/${((t=s==null?void 0:s.asset)==null?void 0:t.id)||""}`)]);if(S(l.data),(i=l.data.asset)!=null&&i.id){const o=await m().get(`/depreciation/valuations/${l.data.asset.id}`);P(o.data.valuations||[])}}catch(l){console.error("Error loading depreciation:",l),p("Failed to load depreciation details")}finally{b(!1)}},F=async t=>{var l,x;if(await I("Post Depreciation","Are you sure you want to post this depreciation period? This action cannot be undone."))try{await m().post(`/depreciation/${h}/post`,{periodId:t}),C("Depreciation posted successfully"),j()}catch(o){console.error("Error posting depreciation:",o),p(((x=(l=o.response)==null?void 0:l.data)==null?void 0:x.message)||"Failed to post depreciation")}},R=async t=>{var i,l,x;if(t.preventDefault(),!((i=s==null?void 0:s.asset)!=null&&i.id)){p("Asset information is missing");return}try{await m().post("/depreciation/valuations",{...a,assetId:s.asset.id,bookValue:parseFloat(a.bookValue)||s.currentBookValue,marketValue:a.marketValue?parseFloat(a.marketValue):null,replacementValue:a.replacementValue?parseFloat(a.replacementValue):null}),C("Valuation added successfully"),f(!1),n({valuationDate:new Date().toISOString().split("T")[0],valuationType:"routine",bookValue:"",marketValue:"",replacementValue:"",condition:"good",appraisedBy:"",notes:""}),j()}catch(o){console.error("Error adding valuation:",o),p(((x=(l=o.response)==null?void 0:l.data)==null?void 0:x.message)||"Failed to add valuation")}},r=t=>new Intl.NumberFormat("en-ZA",{style:"currency",currency:"ZAR"}).format(t),d=t=>new Date(t).toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric"}),v=t=>t.split("_").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" ");return L?e.jsx($,{message:"Loading depreciation details"}):s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>A("/depreciation"),className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:s.asset.name}),e.jsx("span",{className:`px-3 py-1 text-sm font-medium rounded-full ${s.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.isActive?"Active":"Inactive"})]}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:["Asset Code: ",s.asset.asset_code]})]}),e.jsx(D,{to:`/assets/${s.asset.id}`,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"View Asset"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Purchase Price"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:r(s.purchasePrice)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:d(s.purchaseDate)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Current Book Value"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:r(s.currentBookValue)}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[(s.currentBookValue/s.purchasePrice*100).toFixed(1),"% of original"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Accumulated"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:r(s.accumulatedDepreciation)}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Monthly: ",r(s.monthlyDepreciationAmount||0)]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Remaining Life"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:[s.usefulLifeYears,"y ",s.usefulLifeMonths,"m"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:v(s.depreciationMethod)})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Depreciation Configuration"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Method"}),e.jsx("p",{className:"text-base font-medium text-gray-900 mt-1",children:v(s.depreciationMethod)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Salvage Value"}),e.jsx("p",{className:"text-base font-medium text-gray-900 mt-1",children:r(s.salvageValue)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Start Date"}),e.jsx("p",{className:"text-base font-medium text-gray-900 mt-1",children:d(s.depreciationStartDate)})]}),s.annualDepreciationRate&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Annual Rate"}),e.jsxs("p",{className:"text-base font-medium text-gray-900 mt-1",children:[s.annualDepreciationRate,"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Created By"}),e.jsx("p",{className:"text-base font-medium text-gray-900 mt-1",children:s.createdBy.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Last Calculated"}),e.jsx("p",{className:"text-base font-medium text-gray-900 mt-1",children:s.lastCalculatedAt?d(s.lastCalculatedAt):"Never"})]})]}),s.notes&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Notes"}),e.jsx("p",{className:"text-base text-gray-900 mt-1",children:s.notes})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex -mb-px",children:[e.jsxs("button",{onClick:()=>N("schedule"),className:`px-6 py-3 text-sm font-medium ${u==="schedule"?"border-b-2 border-blue-600 text-blue-600":"text-gray-500 hover:text-gray-700"}`,children:["Depreciation Schedule (",((V=s.schedule)==null?void 0:V.length)||0,")"]}),e.jsxs("button",{onClick:()=>N("valuations"),className:`px-6 py-3 text-sm font-medium ${u==="valuations"?"border-b-2 border-blue-600 text-blue-600":"text-gray-500 hover:text-gray-700"}`,children:["Valuations (",g.length,")"]})]})}),e.jsxs("div",{className:"p-6",children:[u==="schedule"&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Period"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date Range"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Opening Value"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Depreciation"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Accumulated"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Closing Value"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:((w=s.schedule)==null?void 0:w.length)===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-8 text-center text-gray-500",children:"No schedule entries found"})}):(k=s.schedule)==null?void 0:k.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:t.periodNumber}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-900",children:[d(t.periodStartDate)," - ",d(t.periodEndDate)]}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900",children:r(t.openingBookValue)}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-red-600",children:["-",r(t.depreciationAmount)]}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900",children:r(t.accumulatedDepreciation)}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900 font-medium",children:r(t.closingBookValue)}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t.isPosted?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:t.isPosted?"Posted":"Pending"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:!t.isPosted&&e.jsx("button",{onClick:()=>F(t.id),className:"text-blue-600 hover:text-blue-900 text-sm",children:"Post"})})]},t.id))})]})}),u==="valuations"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>f(!y),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:y?"Cancel":"Add Valuation"})}),y&&e.jsxs("form",{onSubmit:R,className:"bg-gray-50 rounded-lg p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valuation Date"}),e.jsx("input",{type:"date",value:a.valuationDate,onChange:t=>n({...a,valuationDate:t.target.value}),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valuation Type"}),e.jsxs("select",{value:a.valuationType,onChange:t=>n({...a,valuationType:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"routine",children:"Routine"}),e.jsx("option",{value:"insurance",children:"Insurance"}),e.jsx("option",{value:"disposal",children:"Disposal"}),e.jsx("option",{value:"impairment",children:"Impairment"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Market Value"}),e.jsx("input",{type:"number",step:"0.01",value:a.marketValue,onChange:t=>n({...a,marketValue:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Replacement Value"}),e.jsx("input",{type:"number",step:"0.01",value:a.replacementValue,onChange:t=>n({...a,replacementValue:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Condition"}),e.jsxs("select",{value:a.condition,onChange:t=>n({...a,condition:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"excellent",children:"Excellent"}),e.jsx("option",{value:"good",children:"Good"}),e.jsx("option",{value:"fair",children:"Fair"}),e.jsx("option",{value:"poor",children:"Poor"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Appraised By"}),e.jsx("input",{type:"text",value:a.appraisedBy,onChange:t=>n({...a,appraisedBy:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Appraiser name"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:a.notes,onChange:t=>n({...a,notes:t.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Valuation notes..."})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Save Valuation"})})]}),e.jsx("div",{className:"space-y-3",children:g.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No valuations recorded"}):g.map(t=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:d(t.valuationDate)}),e.jsx("span",{className:"ml-2 px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800",children:t.valuationType})]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["by ",t.valuedBy.name]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-3",children:[t.marketValue&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Market Value"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:r(t.marketValue)})]}),t.replacementValue&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Replacement Value"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:r(t.replacementValue)})]}),t.condition&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Condition"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 capitalize",children:t.condition})]})]}),t.notes&&e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:t.notes})]},t.id))})]})]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500",children:"Depreciation record not found"}),e.jsx(D,{to:"/depreciation",className:"text-blue-600 hover:underline mt-4 inline-block",children:"Back to Depreciation"})]})};export{U as default};
