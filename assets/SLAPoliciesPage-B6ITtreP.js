import{r as c,j as e,X as E,f as P,L as M,C as T,k as $,_ as I}from"./index-CMCHWJER.js";import{showSuccess as B,showError as D}from"./sweetalert-BCvQYi5m.js";import{P as F}from"./plus-BLyF1uy6.js";import{C as O}from"./circle-check-big-BMkt0zQL.js";import{T as C}from"./triangle-alert-DZPTjIAI.js";import{S as H}from"./square-pen-NSFzC722.js";function U({policy:r,onSave:g,onCancel:x}){const[b,j]=c.useState(!1),[v,k]=c.useState([]),[a,i]=c.useState({name:(r==null?void 0:r.name)||"",description:(r==null?void 0:r.description)||"",priority:(r==null?void 0:r.priority)||"medium",responseTime:(r==null?void 0:r.responseTime)||60,resolutionTime:(r==null?void 0:r.resolutionTime)||240,businessHoursOnly:(r==null?void 0:r.businessHoursOnly)??!0,escalationEnabled:(r==null?void 0:r.escalationEnabled)??!1,escalationUserId:(r==null?void 0:r.escalationUserId)||"",notifyBeforeMinutes:(r==null?void 0:r.notifyBeforeMinutes)||30,isActive:(r==null?void 0:r.isActive)??!0});c.useEffect(()=>{o()},[]);const o=async()=>{try{const d=await(await fetch("http://localhost:4000/api/users",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json(),h=Array.isArray(d)?d:d.users||[];k(h.filter(m=>m.role==="ADMIN"||m.role==="TECHNICIAN"))}catch(s){console.error("Failed to fetch users:",s),k([])}},y=async s=>{s.preventDefault(),j(!0);try{await g(a),B(r?"SLA policy updated successfully":"SLA policy created successfully","Success!")}catch(d){console.error("Failed to save SLA policy:",d),D("Failed to save SLA policy. Please try again.")}finally{j(!1)}},p=s=>{if(s<60)return`${s} minutes`;if(s<1440){const m=Math.floor(s/60),w=s%60;return w>0?`${m}h ${w}m`:`${m} hours`}const d=Math.floor(s/1440),h=Math.floor(s%1440/60);return h>0?`${d}d ${h}h`:`${d} days`};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r?"Edit SLA Policy":"Create SLA Policy"}),e.jsx("button",{type:"button",onClick:x,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(E,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Policy Name *"}),e.jsx("input",{type:"text",required:!0,value:a.name,onChange:s=>i({...a,name:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"e.g., Critical Ticket SLA"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:s=>i({...a,description:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",rows:3,placeholder:"Describe the SLA policy..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Priority *"}),e.jsxs("select",{required:!0,value:a.priority,onChange:s=>i({...a,priority:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Time Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Response Time (minutes) *"}),e.jsx("input",{type:"number",required:!0,min:"1",value:a.responseTime,onChange:s=>i({...a,responseTime:parseInt(s.target.value)}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"e.g., 60"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:["Preview: ",p(a.responseTime)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Resolution Time (minutes) *"}),e.jsx("input",{type:"number",required:!0,min:"1",value:a.resolutionTime,onChange:s=>i({...a,resolutionTime:parseInt(s.target.value)}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"e.g., 240"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:["Preview: ",p(a.resolutionTime)]})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.businessHoursOnly,onChange:s=>i({...a,businessHoursOnly:s.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:"Business Hours Only"})]})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"If enabled, SLA timers only count during business hours (9 AM - 5 PM, Monday - Friday)"})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Escalation Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.escalationEnabled,onChange:s=>i({...a,escalationEnabled:s.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:"Enable Escalation"})]})}),a.escalationEnabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Escalate To *"}),e.jsxs("select",{required:a.escalationEnabled,value:a.escalationUserId,onChange:s=>i({...a,escalationUserId:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Select user..."}),v.map(s=>e.jsxs("option",{value:s.id,children:[s.fullName," (",s.email,") - ",s.role]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notify Before (minutes)"}),e.jsx("input",{type:"number",min:"1",value:a.notifyBeforeMinutes,onChange:s=>i({...a,notifyBeforeMinutes:parseInt(s.target.value)}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"e.g., 30"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:["Send warning notification ",p(a.notifyBeforeMinutes)," before breach"]})]})]})]})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.isActive,onChange:s=>i({...a,isActive:s.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:"Active"})]})})})]}),e.jsxs("div",{className:"sticky bottom-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 p-6 flex items-center justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:x,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",disabled:b,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:b,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:b?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("span",{className:"sr-only",children:"Saving"})]}):r?"Update Policy":"Create Policy"})]})]})})})}function X(){const[r,g]=c.useState([]),[x,b]=c.useState(null),[j,v]=c.useState(!0),k=P(j,2e3),[a,i]=c.useState(!1),[o,y]=c.useState(null);c.useEffect(()=>{p(),s()},[]);const p=async()=>{try{const l=await(await fetch("http://localhost:4000/api/workflows/sla-policies",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();g(l)}catch(t){console.error("Failed to fetch SLA policies:",t)}finally{v(!1)}},s=async()=>{try{const l=await(await fetch("http://localhost:4000/api/workflows/sla-stats",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();b(l)}catch(t){console.error("Failed to fetch SLA stats:",t)}},d=async t=>{const l=r.find(n=>n.id===t),{showDeleteConfirm:u,showSuccess:S,showError:f}=await I(async()=>{const{showDeleteConfirm:n,showSuccess:A,showError:L}=await import("./sweetalert-BCvQYi5m.js");return{showDeleteConfirm:n,showSuccess:A,showError:L}},[]);if((await u((l==null?void 0:l.name)||"this SLA policy","This SLA policy will be permanently deleted and cannot be recovered.")).isConfirmed)try{if(!(await fetch(`http://localhost:4000/api/workflows/sla-policies/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).ok)throw new Error("Failed to delete policy");g(r.filter(A=>A.id!==t)),S("SLA policy deleted successfully")}catch(n){console.error("Failed to delete SLA policy:",n),f("Failed to delete SLA policy. Please try again.")}},h=async t=>{const l=o?`http://localhost:4000/api/workflows/sla-policies/${o.id}`:"http://localhost:4000/api/workflows/sla-policies",u=o?"PUT":"POST",S={name:t.name,description:t.description,priority:t.priority,responseTimeMinutes:t.responseTime,resolutionTimeMinutes:t.resolutionTime,businessHoursOnly:t.businessHoursOnly,escalationEnabled:t.escalationEnabled,escalationUserId:t.escalationUserId||null,notifyBeforeMinutes:t.notifyBeforeMinutes,isActive:t.isActive},f=await fetch(l,{method:u,headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(S)});if(!f.ok){const n=await f.json().catch(()=>({message:"Unknown error"}));throw console.error("Failed to save SLA policy:",n),new Error(n.message||"Failed to save SLA policy")}const N=await f.json();g(o?r.map(n=>n.id===N.id?N:n):[...r,N]),i(!1),y(null),s()},m=t=>{if(t<60)return`${t}m`;const l=Math.floor(t/60),u=t%60;return u>0?`${l}h ${u}m`:`${l}h`},w=t=>{const l={critical:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",high:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400",medium:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",low:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400"};return l[t]||l.medium};return k?e.jsx(M,{message:"Loading SLA policies..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"SLA Policies"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Manage Service Level Agreement policies and track compliance"})]}),e.jsxs("button",{onClick:()=>i(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(F,{className:"w-4 h-4"}),"Create Policy"]})]}),x&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Compliance Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[x.complianceRate,"%"]})]}),e.jsx(O,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"On Track"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:x.onTrack})]}),e.jsx(T,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"At Risk"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:x.atRisk})]}),e.jsx(C,{className:"w-8 h-8 text-yellow-600"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Breached"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:x.breached})]}),e.jsx(C,{className:"w-8 h-8 text-red-600"})]})})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:r.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(T,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No SLA policies yet"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Create SLA policies to track response and resolution times"}),e.jsx("button",{onClick:()=>i(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Create Policy"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-750 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Priority"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Response Time"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Resolution Time"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Business Hours"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Escalation"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:r.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-750",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.name}),t.description&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.description})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full capitalize ${w(t.priority)}`,children:t.priority})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:m(t.responseTimeMinutes)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:m(t.resolutionTimeMinutes)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t.businessHoursOnly?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-400"}`,children:t.businessHoursOnly?"Yes":"No"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t.escalationEnabled?"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-400"}`,children:t.escalationEnabled?"Enabled":"Disabled"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t.isActive?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-400"}`,children:t.isActive?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{y(t),i(!0)},className:"p-1 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded",title:"Edit policy",children:e.jsx(H,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>d(t.id),className:"p-1 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",title:"Delete policy",children:e.jsx($,{className:"w-4 h-4"})})]})})]},t.id))})]})})}),a&&e.jsx(U,{policy:o?{...o,responseTime:o.responseTimeMinutes,resolutionTime:o.resolutionTimeMinutes}:null,onSave:h,onCancel:()=>{i(!1),y(null)}})]})}export{X as default};
