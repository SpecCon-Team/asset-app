import{j as e}from"./vendor-charts-DVp8BQgJ.js";import{u as D,i as I,r as c}from"./vendor-react-CFQdvhEG.js";import{a as _}from"./index-DQDJZcqg.js";import{showSuccess as U,showError as l}from"./sweetalert-DcBwdyhg.js";import{Q as L}from"./index-BYClq9Tb.js";import{$ as W,Q as o,aE as T,O as p,y as E,P as x}from"./vendor-ui-Bhgb65c8.js";function Y(){const d=D(),[g]=I(),[n,m]=c.useState(""),[h,u]=c.useState(!1),[s,i]=c.useState(null);c.useEffect(()=>{const t=g.get("qr");t&&(console.log("ðŸ“± QR code detected from URL:",t),m(t),b(t))},[g]);const b=async t=>{var f,j,y,w,N,k,v,R,Q,C,S,A;if(t.trim())try{u(!0),console.log("ðŸ” Attempting to scan QR code:",t.trim());const r=await _().post("/checkout/qr/scan",{qrCode:t.trim()});console.log("âœ… QR code scanned successfully:",r.data),console.log("ðŸ“¦ Asset data:",r.data.asset),r.data&&r.data.asset?(i(r.data.asset),await U("Success!","QR code scanned successfully",1500)):(console.error("âŒ No asset data in response:",r.data),await l("Error","Asset data not found in response"),i(null))}catch(a){console.error("âŒ Failed to scan QR code:",a),console.error("Error details:",{status:(f=a.response)==null?void 0:f.status,message:(y=(j=a.response)==null?void 0:j.data)==null?void 0:y.message,error:(N=(w=a.response)==null?void 0:w.data)==null?void 0:N.error}),((k=a.response)==null?void 0:k.status)===401||((v=a.response)==null?void 0:v.status)===403?await l("Authentication Required","Please log in to scan QR codes. The QR code data has been saved - log in and try again."):((R=a.response)==null?void 0:R.status)===404?await l("QR Code Not Found","This QR code is not registered in the system. Please generate a valid QR code for an asset."):await l("Error",((C=(Q=a.response)==null?void 0:Q.data)==null?void 0:C.message)||((A=(S=a.response)==null?void 0:S.data)==null?void 0:A.error)||"Failed to scan QR code. Please try again."),i(null)}finally{u(!1)}},F=async t=>{if(t.preventDefault(),!n.trim()){await l("Error","Please enter a QR code");return}await b(n.trim())},P=()=>{s&&d("/checkout/new",{state:{assetId:s.id}})},O=()=>{s&&d(`/assets/${s.id}`)},q=()=>{m(""),i(null)};return e.jsxs("div",{className:"flex flex-col p-4 md:p-6 lg:p-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>d("/checkout"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white mb-4",children:[e.jsx(W,{className:"w-5 h-5"}),"Back to Checkouts"]}),e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[e.jsx(o,{className:"w-8 h-8 text-purple-600 dark:text-purple-400"}),"QR Code Scanner"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:"Scan QR codes with your phone camera or enter manually"})]}),e.jsxs("div",{className:"max-w-2xl mx-auto w-full",children:[!s&&e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 rounded-lg shadow p-8 mb-6 border border-purple-200 dark:border-purple-800",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-16 h-16 bg-purple-600 dark:bg-purple-500 rounded-full flex items-center justify-center",children:e.jsx(T,{className:"w-8 h-8 text-white"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-3",children:"Scan QR Code with Your Phone"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:"The easiest way to scan QR codes is using your phone's camera. When you scan an asset QR code, it will automatically open this web app and process the scan!"})]})]}),e.jsx("div",{className:"flex justify-center w-full mb-6",children:e.jsxs("div",{className:"p-6 bg-white dark:bg-gray-800 rounded-lg border-2 border-purple-300 dark:border-purple-700 shadow-lg max-w-md w-full",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-2",children:"Test QR Code"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Scan this QR code with your phone camera to test"})]}),e.jsx("div",{className:"flex justify-center p-4 bg-white dark:bg-gray-900 rounded-lg",children:e.jsx("div",{className:"bg-white p-6 rounded-lg border-2 border-gray-200 dark:border-gray-700 shadow-inner",children:e.jsx(L,{value:`${window.location.origin}${window.location.pathname}#/checkout/scan?qr=ASSET:TEST001:test-asset-id`,size:200,level:"H",includeMargin:!0,fgColor:"#000000",bgColor:"#FFFFFF"})})}),e.jsxs("div",{className:"mt-4 p-4 bg-red-50 dark:bg-red-900/20 rounded-lg border-2 border-red-200 dark:border-red-800",children:[e.jsxs("p",{className:"text-xs text-red-800 dark:text-red-300 font-semibold mb-2 flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4"}),"Test QR Code - For Demonstration Only"]}),e.jsx("p",{className:"text-xs text-red-700 dark:text-red-400 mb-3",children:"This test QR code will open this page when scanned, but it will show an error because it's not a real asset in the database."}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-3 rounded border border-red-300 dark:border-red-700",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-900 dark:text-white mb-2",children:"âœ… To test with a real asset:"}),e.jsxs("ol",{className:"text-xs text-gray-700 dark:text-gray-300 space-y-1 list-decimal list-inside",children:[e.jsxs("li",{children:["Go to ",e.jsx("span",{className:"font-mono text-purple-600 dark:text-purple-400",children:"/checkout/qr/generate"})]}),e.jsx("li",{children:"Select a real asset from your database"}),e.jsx("li",{children:'Click "Generate QR Code"'}),e.jsx("li",{children:"Scan that QR code with your phone"}),e.jsx("li",{children:"It will automatically show the asset details!"})]})]})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 bg-purple-600 text-white rounded-full flex items-center justify-center text-sm font-semibold",children:"1"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Open your phone's camera app"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Use the built-in camera app (not a third-party scanner)"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 bg-purple-600 text-white rounded-full flex items-center justify-center text-sm font-semibold",children:"2"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Point at the QR code"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Position the QR code in the camera viewfinder"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 bg-purple-600 text-white rounded-full flex items-center justify-center text-sm font-semibold",children:"3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Tap the notification"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"When your phone detects the QR code, tap the notification to open the web app"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 bg-purple-600 text-white rounded-full flex items-center justify-center text-sm font-semibold",children:"4"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Automatic processing"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"The web app will automatically detect and process the QR code!"})]})]})]})]}),!s&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-8 mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(o,{className:"w-5 h-5"}),"Or Enter QR Code Manually"]}),e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Enter QR Code Data"}),e.jsx("input",{type:"text",value:n,onChange:t=>m(t.target.value),placeholder:"ASSET:CODE:ID or paste QR code data...",className:"w-full px-4 py-3 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 text-center text-lg font-mono",autoFocus:!0}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 text-center",children:"Format: ASSET:ASSET_CODE:ASSET_ID"})]}),e.jsx("button",{type:"submit",disabled:h||!n.trim(),className:"w-full px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-400 transition-colors flex items-center justify-center gap-2 text-lg",children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Scanning..."]}):e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"w-5 h-5"}),"Scan QR Code"]})})]})]}),h&&!s&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-8 mb-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-purple-600 border-t-transparent rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Scanning QR code..."})]})}),s&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 animate-fade-in mb-6 border-2 border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(E,{className:"w-6 h-6 text-green-600 dark:text-green-400"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Asset Found!"})]}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[s.image_url?e.jsx("img",{src:s.image_url,alt:s.name||"Asset",className:"w-24 h-24 object-cover rounded-lg border border-gray-200 dark:border-gray-700"}):e.jsx("div",{className:"w-24 h-24 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center border border-gray-200 dark:border-gray-600",children:e.jsx(x,{className:"w-12 h-12 text-gray-400 dark:text-gray-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:s.name||"Unknown Asset"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"w-4 h-4"}),e.jsxs("span",{children:["Code: ",s.asset_code||"N/A"]})]}),e.jsxs("p",{children:["Type: ",s.asset_type||"N/A"]}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:s.checkoutStatus==="available"?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 flex items-center gap-1",children:[e.jsx(E,{className:"w-3 h-3"}),"Available"]}):e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400 flex items-center gap-1",children:[e.jsx(p,{className:"w-3 h-3"}),"Checked Out"]})})]})]})]}),!1,e.jsxs("div",{className:"space-y-3",children:[s.checkoutStatus==="available"?e.jsxs("button",{onClick:P,className:"w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(x,{className:"w-5 h-5"}),"Check Out This Asset"]}):e.jsx("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-400 flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4"}),"This asset is currently checked out"]})}),e.jsxs("button",{onClick:O,className:"w-full px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(x,{className:"w-5 h-5"}),"View Asset Details"]}),e.jsxs("button",{onClick:q,className:"w-full px-6 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(o,{className:"w-5 h-5"}),"Scan Another Code"]})]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-6 mt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-blue-900 dark:text-blue-400 mb-3 flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),"How QR Codes Work"]}),e.jsxs("ul",{className:"space-y-2 text-sm text-blue-800 dark:text-blue-300",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold",children:"1."}),e.jsx("span",{children:"QR codes contain a URL that points to this scanner page"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold",children:"2."}),e.jsx("span",{children:"When you scan with your phone camera, it detects the URL"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold",children:"3."}),e.jsx("span",{children:"Your phone opens the web app automatically"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold",children:"4."}),e.jsx("span",{children:"The QR code data is extracted and processed automatically"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-semibold",children:"5."}),e.jsx("span",{children:"Or manually enter/paste the QR code data in the input field above"})]})]})]}),e.jsx("div",{className:"text-center mt-6",children:e.jsx("button",{onClick:()=>d("/checkout/qr/generate"),className:"text-purple-600 dark:text-purple-400 hover:underline text-sm font-medium",children:"Need to generate QR codes for your assets? Click here"})})]})]})}export{Y as default};
