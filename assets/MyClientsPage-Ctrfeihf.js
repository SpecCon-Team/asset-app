import{c as H,r,i as B,z as o,j as e,L as J,x as k,S as Q,y as q,l as V,m as C,h as Y,B as K}from"./index-d-W5hbHG.js";import{l as X,d as Z}from"./api-DLuiersS.js";import{M as x}from"./message-circle-B05NSDqI.js";import"./types-D8_qC6eW.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=H("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);function re(){const[d,M]=r.useState([]),[P,U]=r.useState(!0),D=B(P,2e3),[g,L]=r.useState(""),[p,T]=r.useState(""),[i,u]=r.useState("all"),[W,A]=r.useState(null),[I,y]=r.useState(null),[f,S]=r.useState(!1),[b,j]=r.useState(1),N=10,F=JSON.parse(localStorage.getItem("user")||"{}");r.useEffect(()=>{h(!0);let t=null;const a=()=>{!document.hidden&&!t&&(t=setInterval(()=>{document.hidden||h(!1)},3e4))},l=()=>{t&&(clearInterval(t),t=null)},c=()=>{h(!1)},m=()=>{document.hidden?l():a()};return window.addEventListener("userUpdated",c),document.addEventListener("visibilitychange",m),a(),()=>{l(),window.removeEventListener("userUpdated",c),document.removeEventListener("visibilitychange",m)}},[]);const h=async(t=!0)=>{try{t&&U(!0);const a=await X();M(a)}catch(a){console.error("Failed to fetch users:",a),t&&o.error("Failed to load users")}finally{t&&U(!1)}},$=async(t,a)=>{A(t);try{await Y().patch(`/users/${t}/role`,{role:a}),o.success("User role updated successfully"),h()}catch(l){if(console.error("Failed to update role:",l),K.isAxiosError(l)&&l.response){const c=l.response.data.message||l.response.data.error||"An unknown error occurred.";o.error(`Failed to update role: ${c}`)}else o.error("Failed to update user role")}finally{A(null)}},O=async t=>{S(!0);try{await Z(t),o.success("User deleted successfully"),y(null),h()}catch(a){console.error("Failed to delete user:",a),o.error("Failed to delete user")}finally{S(!1)}};r.useEffect(()=>{j(1)},[g,p,i]);const n=d.filter(t=>{var m;const a=g===""||((m=t.name)==null?void 0:m.toLowerCase().includes(g.toLowerCase()))||t.email.toLowerCase().includes(g.toLowerCase()),l=p===""||t.role===p,c=i==="all"||i==="whatsapp"&&t.isWhatsAppUser||i==="regular"&&!t.isWhatsAppUser;return a&&l&&c}),w=Math.ceil(n.length/N),v=(b-1)*N,E=v+N,z=n.slice(v,E),G=t=>{switch(t){case"ADMIN":return"bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 border-purple-200 dark:border-purple-700";case"TECHNICIAN":return"bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 border-blue-200 dark:border-blue-700";case"PEG":return"bg-emerald-100 dark:bg-emerald-900 text-emerald-800 dark:text-emerald-200 border-emerald-200 dark:border-emerald-700";case"USER":return"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 border-gray-200 dark:border-gray-600";default:return"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 border-gray-200 dark:border-gray-600"}},R=d.filter(t=>!t.isWhatsAppUser),s={total:d.length,online:R.filter(t=>t.isAvailable).length,offline:R.filter(t=>!t.isAvailable).length,whatsapp:d.filter(t=>t.isWhatsAppUser).length,admins:d.filter(t=>t.role==="ADMIN").length,technicians:d.filter(t=>t.role==="TECHNICIAN").length,users:d.filter(t=>t.role==="USER").length};return D?e.jsx(J,{message:"Loading users..."}):e.jsxs("div",{className:"flex flex-col p-8",children:[e.jsxs("div",{className:"mb-6 flex-shrink-0",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"My Clients"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:"Manage users and their access levels"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-7 gap-4 mb-8",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold dark:text-white mt-2",children:s.total})]}),e.jsx("div",{className:"p-3 bg-gray-100 dark:bg-gray-700 rounded-full",children:e.jsx(k,{className:"w-6 h-6 text-gray-600 dark:text-gray-400"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Online"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 dark:text-green-400 mt-2",children:s.online}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:"Regular users"})]}),e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900 rounded-full",children:e.jsx("div",{className:"w-6 h-6 flex items-center justify-center",children:e.jsx("div",{className:"w-3 h-3 bg-green-600 dark:bg-green-400 rounded-full"})})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Offline"}),e.jsx("p",{className:"text-3xl font-bold text-red-600 dark:text-red-400 mt-2",children:s.offline}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:"Regular users"})]}),e.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-900 rounded-full",children:e.jsx("div",{className:"w-6 h-6 flex items-center justify-center",children:e.jsx("div",{className:"w-3 h-3 bg-red-600 dark:bg-red-400 rounded-full"})})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>u("whatsapp"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"WhatsApp"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 dark:text-green-400 mt-2",children:s.whatsapp})]}),e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900 rounded-full",children:e.jsx(x,{className:"w-6 h-6 text-green-600 dark:text-green-400"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Admins"}),e.jsx("p",{className:"text-3xl font-bold text-purple-600 dark:text-purple-400 mt-2",children:s.admins})]}),e.jsx("div",{className:"p-3 bg-purple-100 dark:bg-purple-900 rounded-full",children:e.jsx(Q,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Technicians"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400 mt-2",children:s.technicians})]}),e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900 rounded-full",children:e.jsx(_,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 whitespace-nowrap",children:"Regular Users"}),e.jsx("p",{className:"text-3xl font-bold text-gray-600 dark:text-gray-400 mt-2",children:s.users})]}),e.jsx("div",{className:"p-3 bg-gray-100 dark:bg-gray-700 rounded-full",children:e.jsx(k,{className:"w-6 h-6 text-gray-600 dark:text-gray-400"})})]})})]}),e.jsxs("div",{className:"mb-6 flex gap-2 flex-shrink-0",children:[e.jsxs("button",{onClick:()=>u("all"),className:`px-6 py-3 rounded-lg font-medium transition-all ${i==="all"?"bg-blue-600 text-white shadow-md":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:["All Users (",s.total,")"]}),e.jsxs("button",{onClick:()=>u("whatsapp"),className:`px-6 py-3 rounded-lg font-medium transition-all flex items-center gap-2 ${i==="whatsapp"?"bg-green-600 text-white shadow-md":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[e.jsx(x,{className:"w-5 h-5"}),"WhatsApp Users (",s.whatsapp,")"]}),e.jsxs("button",{onClick:()=>u("regular"),className:`px-6 py-3 rounded-lg font-medium transition-all ${i==="regular"?"bg-gray-600 text-white shadow-md":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:["Regular Users (",s.total-s.whatsapp,")"]})]}),e.jsxs("div",{className:"mb-6 flex gap-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by name or email...",value:g,onChange:t=>L(t.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("select",{value:p,onChange:t=>T(t.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Roles"}),e.jsx("option",{value:"ADMIN",children:"Admin"}),e.jsx("option",{value:"PEG",children:"PEG"}),e.jsx("option",{value:"TECHNICIAN",children:"Technician"}),e.jsx("option",{value:"USER",children:"User"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:e.jsx("div",{children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Current Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Change Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Joined"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:z.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[t.profilePicture?e.jsx("img",{src:t.profilePicture,alt:t.name||t.email,className:"h-10 w-10 rounded-full object-cover"}):e.jsx("div",{className:"h-10 w-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold text-sm",children:(t.name||t.email).charAt(0).toUpperCase()})}),t.isWhatsAppUser?e.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 bg-green-500 rounded-full border-2 border-white flex items-center justify-center",children:e.jsx(x,{className:"w-2.5 h-2.5 text-white"})}):e.jsx("div",{className:`absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-white ${t.isAvailable?"bg-green-500":"bg-red-500"}`})]}),e.jsx("div",{className:"ml-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.name||"No Name"}),t.isWhatsAppUser&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-green-700 dark:text-green-400 bg-green-100 dark:bg-green-900 border border-green-200 dark:border-green-700 rounded-full",children:[e.jsx(x,{className:"w-3 h-3"}),"WhatsApp"]})]})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.isWhatsAppUser?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"w-4 h-4 text-green-600 dark:text-green-400"}),e.jsx("span",{className:"text-sm font-medium text-green-600 dark:text-green-400",children:"WhatsApp Active"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${t.isAvailable?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:`text-sm font-medium ${t.isAvailable?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:t.isAvailable?"Online":"Offline"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.isWhatsAppUser&&t.phone?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900 dark:text-white flex items-center gap-1",children:[e.jsx(x,{className:"w-4 h-4 text-green-600 dark:text-green-400"}),t.phone]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"WhatsApp User"})]}):e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:t.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full border ${G(t.role)}`,children:t.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("select",{value:t.role,onChange:a=>$(t.id,a.target.value),disabled:W===t.id,className:"px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-white rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 dark:disabled:bg-gray-700",children:[e.jsx("option",{value:"USER",children:"User"}),e.jsx("option",{value:"TECHNICIAN",children:"Technician"}),e.jsx("option",{value:"PEG",children:"PEG"}),e.jsx("option",{value:"ADMIN",children:"Admin"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:V(t.createdAt)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.id===F.id?e.jsx("button",{disabled:!0,className:"text-gray-400 dark:text-gray-600 cursor-not-allowed",title:"You cannot delete your own account",children:e.jsx(C,{className:"w-5 h-5"})}):e.jsx("button",{onClick:()=>y(t.id),className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 transition-colors",title:"Delete user",children:e.jsx(C,{className:"w-5 h-5"})})})]},t.id))})]})})}),n.length>0&&e.jsxs("div",{className:"mt-6 flex items-center justify-between bg-white dark:bg-gray-800 px-4 py-3 rounded-lg shadow border-t border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:e.jsxs("span",{children:["Showing ",e.jsx("span",{className:"font-semibold",children:v+1})," to"," ",e.jsx("span",{className:"font-semibold",children:Math.min(E,n.length)})," of"," ",e.jsx("span",{className:"font-semibold",children:n.length})," users"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>j(t=>Math.max(1,t-1)),disabled:b===1,className:"px-4 py-2 min-h-[44px] bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-semibold rounded-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-400 disabled:to-gray-400 transition-all shadow-md hover:shadow-lg flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Previous"]}),e.jsx("div",{className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg",children:e.jsxs("span",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:["Page ",b," of ",w]})}),e.jsxs("button",{onClick:()=>j(t=>Math.min(w,t+1)),disabled:b===w,className:"px-4 py-2 min-h-[44px] bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-semibold rounded-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-400 disabled:to-gray-400 transition-all shadow-md hover:shadow-lg flex items-center gap-2",children:["Next",e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})]})]})]})]}),I&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Confirm Delete"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"Are you sure you want to delete this user? This action cannot be undone."}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>y(null),disabled:f,className:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:()=>O(I),disabled:f,className:"px-4 py-2 text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 flex items-center gap-2",children:f?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("span",{className:"sr-only",children:"Deleting"})]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4"}),"Delete"]})})]})]})}),n.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(k,{className:"w-16 h-16 text-gray-300 dark:text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No users found"})]})]})}export{re as default};
