import{j as e}from"./vendor-charts-DVp8BQgJ.js";import{u as S,r as a}from"./vendor-react-CFQdvhEG.js";import{u as F}from"./store-Bdqelsdl.js";import{a as A,u as O,L as G}from"./index-BQg6k2HC.js";import{C as $,g as R,e as U,A as z,d as Q,a as X}from"./exportUtils-DRNWw7AS.js";import{C as Y}from"./ConfirmDialog-bQ07R_IK.js";import"./index-BYClq9Tb.js";import{X as q,e as B,_ as J,l as C,$ as H,V as K,Y as W,D as Z,a0 as ee,a1 as se,T as te,z as m}from"./vendor-ui-Bhgb65c8.js";import{A as ae}from"./AssignAssetsToClientModal-DpqPibQV.js";import{showError as re}from"./sweetalert-DcBwdyhg.js";import"./api-h0mg5kb1.js";import"./types-D8_qC6eW.js";function le({isOpen:l,onClose:r}){const k=S(),[n,u]=a.useState([]),[g,o]=a.useState(!1),[c,p]=a.useState("");a.useEffect(()=>{l&&(N(),p(""))},[l]);const N=async()=>{try{o(!0);const i=await A().get("/peg");u(i.data)}catch(t){console.error("Error loading clients:",t),re("Error","Failed to load clients"),u([])}finally{o(!1)}},b=t=>{k(`/assets/new?pegClientId=${t.id}`),r()},y=n.filter(t=>{var h,f,j;if(!c)return!0;const i=c.toLowerCase();return t.name.toLowerCase().includes(i)||t.location.toLowerCase().includes(i)||((h=t.contactPerson)==null?void 0:h.toLowerCase().includes(i))||((f=t.phone)==null?void 0:f.toLowerCase().includes(i))||((j=t.email)==null?void 0:j.toLowerCase().includes(i))});return l?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Select Client for New Asset"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Choose a client to create an asset for"})]}),e.jsx("button",{onClick:r,className:"p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(q,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search clients by name, location, contact person, phone, or email...",value:c,onChange:t=>p(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:g?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(J,{className:"w-8 h-8 text-blue-600 animate-spin"})}):y.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(C,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:c?"No clients match your search criteria":"No clients found"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:y.map(t=>e.jsx("button",{onClick:()=>b(t),className:"p-4 rounded-lg border-2 border-gray-200 dark:border-gray-700 hover:border-blue-500 dark:hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all text-left",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 flex items-center justify-center flex-shrink-0",children:e.jsx(C,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white truncate",children:t.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:t.location}),t.contactPerson&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Contact: ",t.contactPerson]}),t.phone&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Phone: ",t.phone]})]})]})},t.id))})}),e.jsx("div",{className:"p-6 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{onClick:r,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"Cancel"})})]})}):null}function fe(){const l=S(),[r,k]=a.useState(""),[n,u]=a.useState(""),[g,o]=a.useState(null),[c,p]=a.useState(!1),[N,b]=a.useState(!1),[y,t]=a.useState(!1),[i,h]=a.useState(!1),{assets:f,isLoading:j,error:w,fetchAssets:x,deleteAsset:E}=F(),I=O(j,2e3);a.useEffect(()=>{const s=localStorage.getItem("user");s&&JSON.parse(s).role!=="ADMIN"&&l("/my-assets")},[l]),a.useEffect(()=>{x({search:r,status:n})},[r,n,x]),a.useEffect(()=>{const s=()=>{document.visibilityState==="visible"&&x({search:r,status:n})};return document.addEventListener("visibilitychange",s),()=>document.removeEventListener("visibilitychange",s)},[r,n,x]);const d=f.filter(s=>s.pegClientId&&typeof s.pegClientId=="string"&&s.pegClientId.trim()!==""),T=s=>{o(s)},L=async()=>{if(g){p(!0);try{await E(g),m.success("Asset deleted successfully"),o(null)}catch(s){console.error("Failed to delete asset:",s),m.error("Failed to delete asset")}finally{p(!1)}}},M=s=>{l(`/assets/${s}`)},P=()=>{try{const s=R("peg_assets_export","csv");U(d,z,s),m.success(`Exported ${d.length} PEG assets to CSV`)}catch(s){console.error("Export failed:",s),m.error("Failed to export assets")}},D=()=>{try{Q(X,"asset_import_template.csv"),m.success("Import template downloaded successfully")}catch(s){console.error("Template download failed:",s),m.error("Failed to download template")}},V=async s=>{const v=new FormData;v.append("file",s),localStorage.getItem("token");const _=(await A().post("/assets/import-csv",v,{headers:{"Content-Type":"multipart/form-data"}})).data;return await x({search:r,status:n}),_};return I?e.jsx(G,{message:"Loading PEG assets..."}):w?e.jsxs("div",{className:"p-8 text-red-600 dark:text-red-400 bg-gray-50 dark:bg-gray-900 min-h-screen",children:["Error: ",w]}):e.jsxs("div",{className:"p-3 sm:p-4 md:p-6 lg:p-8 bg-gray-50 dark:bg-gray-900 min-h-screen",children:[e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsxs("div",{className:"mb-4 flex items-center gap-4",children:[e.jsx("button",{onClick:()=>l("/assets"),className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Back to All Assets",children:e.jsx(H,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white mb-1",children:"PEG Assets Management"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-400",children:"Manage assets assigned to PEG clients"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 lg:flex lg:flex-wrap gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:D,className:"px-3 sm:px-4 py-2 sm:py-2.5 bg-purple-600 dark:bg-purple-500 text-white rounded-lg hover:bg-purple-700 dark:hover:bg-purple-600 flex items-center justify-center gap-2 transition-colors text-sm sm:text-base min-h-[44px]",title:"Download CSV template for bulk import",children:[e.jsx(K,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Template"})]}),e.jsxs("button",{onClick:()=>b(!0),className:"px-3 sm:px-4 py-2 sm:py-2.5 bg-indigo-600 dark:bg-indigo-500 text-white rounded-lg hover:bg-indigo-700 dark:hover:bg-indigo-600 flex items-center justify-center gap-2 transition-colors text-sm sm:text-base min-h-[44px]",title:"Import assets from CSV",children:[e.jsx(W,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Import CSV"})]}),e.jsxs("button",{onClick:P,disabled:d.length===0,className:"px-3 sm:px-4 py-2 sm:py-2.5 bg-green-600 dark:bg-green-500 text-white rounded-lg hover:bg-green-700 dark:hover:bg-green-600 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm sm:text-base min-h-[44px]",title:"Export PEG assets to CSV",children:[e.jsx(Z,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Export CSV"})]}),e.jsxs("button",{onClick:()=>h(!0),className:"px-3 sm:px-4 py-2 sm:py-2.5 bg-blue-600 dark:bg-blue-500 text-white rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 flex items-center justify-center gap-2 transition-colors text-sm sm:text-base min-h-[44px]",children:[e.jsx("span",{children:"+"})," ",e.jsx("span",{className:"truncate",children:"Add Asset"})]}),e.jsx("button",{onClick:()=>t(!0),className:"px-3 sm:px-4 py-2 sm:py-2.5 bg-indigo-600 dark:bg-indigo-500 text-white rounded-lg hover:bg-indigo-700 dark:hover:bg-indigo-600 flex items-center justify-center gap-2 transition-colors text-sm sm:text-base min-h-[44px]",children:e.jsx("span",{className:"truncate",children:"Assign Assets"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 md:gap-6 mb-4 sm:mb-6 md:mb-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 sm:p-5 md:p-6 rounded-lg shadow-sm border-2",style:{borderColor:"#FF9800"},children:[e.jsx("h3",{className:"text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400",children:"Total PEG Assets"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold mt-1 sm:mt-2 text-gray-900 dark:text-white",children:d.length})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 sm:p-5 md:p-6 rounded-lg shadow-sm",children:[e.jsx("h3",{className:"text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400",children:"Available"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold mt-1 sm:mt-2 text-green-600 dark:text-green-400",children:d.filter(s=>s.status==="available").length})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 sm:p-5 md:p-6 rounded-lg shadow-sm",children:[e.jsx("h3",{className:"text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400",children:"Assigned"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold mt-1 sm:mt-2 text-blue-600 dark:text-blue-400",children:d.filter(s=>s.status==="assigned").length})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 sm:p-5 md:p-6 rounded-lg shadow-sm",children:[e.jsx("h3",{className:"text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400",children:"In Service"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold mt-1 sm:mt-2 text-orange-600 dark:text-orange-400",children:d.filter(s=>["maintenance","repair"].includes(s.status||"")).length})]})]}),e.jsxs("div",{className:"mb-4 sm:mb-6 flex flex-col sm:flex-row gap-3 sm:gap-4",children:[e.jsx("input",{type:"text",placeholder:"Search by name, code, or type...",value:r,onChange:s=>k(s.target.value),className:"flex-1 px-3 sm:px-4 py-2 sm:py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base min-h-[44px] dark:bg-gray-800 dark:text-white"}),e.jsxs("select",{value:n,onChange:s=>u(s.target.value),className:"px-3 sm:px-4 py-2 sm:py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm sm:text-base min-h-[44px] dark:bg-gray-800 dark:text-white sm:w-auto w-full",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"available",children:"Available"}),e.jsx("option",{value:"assigned",children:"Assigned"}),e.jsx("option",{value:"maintenance",children:"Maintenance"}),e.jsx("option",{value:"repair",children:"Repair"}),e.jsx("option",{value:"retired",children:"Retired"})]})]}),d.length===0?e.jsx("div",{className:"bg-white dark:bg-gray-800 p-8 sm:p-12 rounded-lg shadow text-center",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No PEG assets found"})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-5 md:gap-6",children:d.map(s=>e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"p-4 sm:p-5 md:p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3 sm:mb-4 gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-semibold text-base sm:text-lg text-gray-900 dark:text-white truncate",children:s.name}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400 truncate",children:s.asset_code})]}),e.jsx("span",{className:`px-2 sm:px-3 py-1 text-xs rounded-full whitespace-nowrap flex-shrink-0 ${s.status==="available"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":s.status==="assigned"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":s.status==="maintenance"||s.status==="repair"?"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200"}`,children:s.status})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2 mb-3 sm:mb-4",children:[e.jsxs("div",{className:"flex items-center text-xs sm:text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 w-20 sm:w-24 flex-shrink-0",children:"Type:"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:s.asset_type||"-"})]}),e.jsxs("div",{className:"flex items-center text-xs sm:text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 w-20 sm:w-24 flex-shrink-0",children:"Condition:"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:s.condition||"-"})]}),e.jsxs("div",{className:"flex items-center text-xs sm:text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 w-20 sm:w-24 flex-shrink-0",children:"Assigned to:"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:s.assigned_to||"Unassigned"})]}),s.office_location&&e.jsxs("div",{className:"flex items-center text-xs sm:text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 w-20 sm:w-24 flex-shrink-0",children:"Location:"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:s.office_location})]}),s.department&&e.jsxs("div",{className:"flex items-center text-xs sm:text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 w-20 sm:w-24 flex-shrink-0",children:"Department:"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:s.department})]})]}),e.jsxs("div",{className:"flex gap-2 pt-3 sm:pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>M(s.id),className:"flex-1 px-2 sm:px-3 py-2 text-xs sm:text-sm bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded hover:bg-blue-100 dark:hover:bg-blue-900/50 flex items-center justify-center gap-1 sm:gap-2 transition-colors min-h-[40px]",children:[e.jsx(ee,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden xs:inline",children:"Edit"})]}),e.jsxs("button",{onClick:()=>l(`/assets/${s.id}`),className:"flex-1 px-2 sm:px-3 py-2 text-xs sm:text-sm bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded hover:bg-gray-100 dark:hover:bg-gray-600 flex items-center justify-center gap-1 sm:gap-2 transition-colors min-h-[40px]",children:[e.jsx(se,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{className:"hidden xs:inline",children:"View"})]}),e.jsx("button",{onClick:()=>T(s.id),className:"px-2 sm:px-3 py-2 text-xs sm:text-sm bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded hover:bg-red-100 dark:hover:bg-red-900/50 flex items-center justify-center gap-1 sm:gap-2 transition-colors min-h-[40px]",children:e.jsx(te,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0"})})]})]})},s.id))}),e.jsx(Y,{open:!!g,onClose:()=>o(null),onConfirm:L,title:"Delete Asset?",message:"Are you sure you want to delete this asset? This action cannot be undone.",confirmText:"Yes, delete it",cancelText:"Cancel",variant:"danger",isLoading:c}),e.jsx($,{isOpen:N,onClose:()=>b(!1),onImport:V,title:"Import Assets from CSV",entityType:"assets"}),e.jsx(ae,{isOpen:y,onClose:()=>t(!1),onSuccess:()=>{x({search:r,status:n})}}),e.jsx(le,{isOpen:i,onClose:()=>h(!1)})]})}export{fe as default};
