import{j as e}from"./vendor-charts-DVp8BQgJ.js";import{u as q,r as s,L as v}from"./vendor-react-CFQdvhEG.js";import{_ as N,a1 as B,aD as V,z as u}from"./vendor-ui-Bhgb65c8.js";import{a as S}from"./api-C8bJ4ZVn.js";import{A as z}from"./AnimatedBackground-BQY8GPMU.js";import"./index-BQg6k2HC.js";function R(){const o=q(),[c,F]=s.useState(""),[x,C]=s.useState(""),[l,p]=s.useState(!1),[y,i]=s.useState(""),[h,P]=s.useState(!1),[m,f]=s.useState({email:!1,password:!1}),[A,b]=s.useState(!1),[I,T]=s.useState(""),[n,w]=s.useState(""),k=a=>{f({...m,[a]:!0})},E=async a=>{var g,d;a.preventDefault(),p(!0),i(""),f({email:!0,password:!0});try{const r=(await S.post("/auth/login",{email:c,password:x})).data;if(r.requiresTwoFactor){b(!0),T(r.userId),u.success("Password accepted. Please enter your 2FA code.");return}localStorage.setItem("user",JSON.stringify(r.user)),localStorage.setItem("token",r.token),u.success("Login successful!"),r.user.role==="PEG"?o("/peg-admin-dashboard"):r.user.role==="ADMIN"||r.user.role==="TECHNICIAN"?o("/"):o("/my-tickets")}catch(t){const r=(g=t.response)==null?void 0:g.data,j=(d=t.response)==null?void 0:d.status;j===429?(u.error("Too many login attempts. Please wait 15 minutes before trying again.",{duration:5e3}),i("Too many requests. Please try again later.")):j===403&&(r==null?void 0:r.emailVerified)===!1?(u.error(r.message||"Please verify your email before logging in"),o("/verify-otp",{state:{email:r.email||c}})):i((r==null?void 0:r.message)||t.message||"Login failed. Please try again.")}finally{p(!1)}},L=async a=>{var g;a.preventDefault(),p(!0),i("");try{const t=(await S.post("/auth/verify-2fa-login",{userId:I,token:n})).data;localStorage.setItem("user",JSON.stringify(t.user)),localStorage.setItem("token",t.token),u.success("Login successful!"),t.user.role==="PEG"?o("/peg-admin-dashboard"):t.user.role==="ADMIN"||t.user.role==="TECHNICIAN"?o("/"):o("/my-tickets")}catch(d){const t=(g=d.response)==null?void 0:g.data;i((t==null?void 0:t.message)||d.message||"2FA verification failed. Please try again.")}finally{p(!1)}};return e.jsxs("div",{className:"min-h-screen relative flex items-center justify-center p-4 overflow-hidden",children:[e.jsx(z,{}),e.jsxs("div",{className:"max-w-md w-full relative z-10",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex w-16 h-16 rounded-full items-center justify-center mb-4",style:{backgroundColor:"var(--color-primary)"},children:e.jsx("span",{className:"text-white font-bold text-2xl",children:"AT"})}),e.jsx("h1",{className:"text-3xl font-bold text-white drop-shadow-lg",children:"Welcome to AssetTrack Pro"}),e.jsx("p",{className:"text-white/90 mt-2 text-sm",children:"Sign in to continue"})]}),e.jsxs("div",{className:"bg-white/95 dark:bg-gray-800/95 backdrop-blur-sm rounded-lg shadow-xl p-8 border border-white/20",children:[y&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-700 rounded-lg text-red-700 dark:text-red-300 text-sm",children:y}),A?e.jsxs("form",{onSubmit:L,className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white mb-2",children:"Two-Factor Authentication"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Enter the 6-digit code from your authenticator app or an 8-character backup code"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"twoFactorCode",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Verification Code"}),e.jsx("input",{id:"twoFactorCode",type:"text",value:n,onChange:a=>w(a.target.value.replace(/[^0-9A-Fa-f]/g,"").toUpperCase()),placeholder:"000000 or backup code",maxLength:8,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-center text-2xl font-mono tracking-widest focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":"var(--color-primary)"},autoFocus:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{b(!1),w(""),i("")},className:"flex-1 px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-900 dark:text-white rounded-lg font-medium transition-colors",children:"Back"}),e.jsx("button",{type:"submit",disabled:l||n.length!==6&&n.length!==8,className:"flex-1 text-white py-3 rounded-lg font-medium disabled:bg-gray-400 transition-opacity hover:opacity-90 flex items-center justify-center gap-2",style:{backgroundColor:l||n.length!==6&&n.length!==8?void 0:"var(--color-primary)"},children:l?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Verifying..."})]}):"Verify"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email"}),e.jsx("input",{id:"email",type:"email",value:c,onChange:a=>F(a.target.value),onBlur:()=>k("email"),placeholder:"you@example.com",className:`w-full px-4 py-3 border ${m.email&&!c?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"} rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 focus:ring-2 focus:border-transparent`,style:{"--tw-ring-color":"var(--color-primary)"}}),m.email&&!c&&e.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-400",children:"This field is required"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"password",type:h?"text":"password",value:x,onChange:a=>C(a.target.value),onBlur:()=>k("password"),placeholder:"••••••••••••",className:`w-full px-4 py-3 pr-12 border ${m.password&&!x?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"} rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 focus:ring-2 focus:border-transparent`,style:{"--tw-ring-color":"var(--color-primary)"}}),e.jsx("button",{type:"button",onClick:()=>P(!h),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 focus:outline-none","aria-label":h?"Hide password":"Show password",children:h?e.jsx(B,{className:"w-5 h-5"}):e.jsx(V,{className:"w-5 h-5"})})]}),m.password&&!x&&e.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-400",children:"This field is required"})]}),e.jsx("button",{type:"submit",disabled:l,className:"w-full text-white py-3 rounded-lg font-medium disabled:bg-gray-400 transition-opacity hover:opacity-90 flex items-center justify-center gap-2",style:{backgroundColor:l?void 0:"var(--color-primary)"},children:l?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Signing in..."})]}):"Sign in"})]}),e.jsxs("div",{className:"mt-6 text-center space-y-3",children:[e.jsx(v,{to:"/forgot-password",className:"text-sm block transition-opacity hover:opacity-80",style:{color:"var(--color-primary)"},children:"Forgot password?"}),e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Don't have an account?"," ",e.jsx(v,{to:"/signup",className:"font-medium transition-opacity hover:opacity-80",style:{color:"var(--color-primary)"},children:"Sign up"})]})]})]})]})]})]})}export{R as default};
