import{j as e}from"./vendor-charts-DVp8BQgJ.js";import{u as le,r as d}from"./vendor-react-CFQdvhEG.js";import{u as ne}from"./store-DNfQSV69.js";import{f as oe,E as de,y as ce,aa as F,c as ie,z as i}from"./vendor-ui-Bhgb65c8.js";import{u as pe,L as xe,f as me,a as ge}from"./index-CezS3iyn.js";import"./types-D8_qC6eW.js";function ke(){const M=le(),{tickets:O,isLoading:W,error:R,fetchTickets:I}=ne(),H=pe(W,2e3),_=()=>{const t=localStorage.getItem("user");if(t)try{return JSON.parse(t)}catch{return null}return null},p=_(),[U,G]=d.useState((p==null?void 0:p.email)||""),[f,J]=d.useState((p==null?void 0:p.id)||""),[y,A]=d.useState(!1),[w,$]=d.useState(null),[k,n]=d.useState(0),[Y,x]=d.useState("");d.useEffect(()=>{const t=_();t&&(G(t.email),J(t.id),t.role!=="TECHNICIAN"&&t.role!=="ADMIN"&&M("/my-tickets"))},[M]),d.useEffect(()=>{I()},[I]);const m=O.filter(t=>t.assignedToId===f),q=m.filter(t=>t.status==="open").length,K=m.filter(t=>t.status==="in_progress").length,Q=m.filter(t=>t.status==="closed").length,V=t=>{switch(t){case"critical":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";case"high":return"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300";case"medium":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300";case"low":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},X=t=>{switch(t){case"open":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300";case"in_progress":return"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300";case"closed":return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},Z=async()=>{var t;A(!0),n(0),$(null),i.loading("Running network speed test...");try{x("Measuring latency...");const s=[],j=3;for(let a=0;a<j;a++){const l=performance.now();try{await fetch("https://www.google.com/generate_204",{method:"HEAD",cache:"no-cache"});const o=Math.round(performance.now()-l);s.push(o)}catch{try{const o=performance.now();await fetch("https://cloudflare.com/cdn-cgi/trace",{method:"HEAD",cache:"no-cache"}),s.push(Math.round(performance.now()-o))}catch{s.push(0)}}n((a+1)/j*20)}const C=s.filter(a=>a>0),ee=C.length>0?Math.round(C.reduce((a,l)=>a+l,0)/C.length):0;x("Testing download speed...");let N=0,g=0;const B=8e3,te=Date.now();try{const l=performance.now();await(await fetch("https://speed.cloudflare.com/__down?bytes=5000000",{method:"GET",cache:"no-cache"})).blob();const r=(performance.now()-l)/1e3;N+=5e6,g+=r,n(35);const c=25e6,P=performance.now(),D=await fetch(`https://speed.cloudflare.com/__down?bytes=${c}`,{method:"GET",cache:"no-cache"}),u=(t=D.body)==null?void 0:t.getReader();let b=0;if(u)for(;;){const{done:ae,value:se}=await u.read();if(ae)break;b+=se.length;const L=Date.now()-te;if(L<B){const re=Math.min(L/B*50,50);n(20+re)}}else await D.blob(),b=c;const E=(performance.now()-P)/1e3;N+=b,g+=E}catch(a){console.error("Download test error:",a);try{const o=performance.now();await(await fetch("https://speed.cloudflare.com/__down?bytes=10000000",{cache:"no-cache"})).blob();const c=(performance.now()-o)/1e3;N=1e7,g=c}catch{throw new Error("Download test failed")}}n(70);const z=g>0?N*8/(g*1e6):0;x("Testing upload speed...");let S=0,v=0,h=0;try{const l=new Uint8Array(3e6);for(let r=0;r<3e6;r+=1024)l[r]=Math.random()*255;n(75);const o=performance.now();try{const r=await fetch("https://speed.cloudflare.com/__up",{method:"POST",body:l.buffer,cache:"no-cache",headers:{"Content-Type":"application/octet-stream"}});if(r.ok||r.status===200){const c=(performance.now()-o)/1e3;S=3e6,v=c,h=S*8/(v*1e6)}else throw new Error("Upload response not ok")}catch{const P=new Uint8Array(1e6),D=new Blob([P],{type:"application/octet-stream"}),u=new FormData;u.append("file",D,"test.bin");const b=performance.now();try{await fetch("https://speed.cloudflare.com/__up",{method:"POST",body:u,cache:"no-cache"});const E=(performance.now()-b)/1e3;S=1e6,v=E,h=S*8/(v*1e6)}catch{h=z*.1}}n(95)}catch{h=z*.1}n(100),x("Complete!");const T={ping:ee,downloadSpeed:parseFloat(z.toFixed(1)),uploadSpeed:parseFloat(h.toFixed(1)),timestamp:new Date().toISOString(),technicianId:f,technicianEmail:U};$(T),i.dismiss(),i.success("Speed test completed!");try{await ge().post("/notifications/speed-test",{downloadSpeed:T.downloadSpeed,uploadSpeed:T.uploadSpeed,latency:T.ping,technicianEmail:U,technicianId:f}),i.success("Results sent to admin!")}catch(a){console.error("Failed to send notification:",a),i.warning("Test completed but failed to notify admin.")}}catch(s){console.error("Speed test failed:",s),i.dismiss();const j=s.message||"Speed test failed. Please check your connection.";i.error(j),x("Failed")}finally{A(!1)}};return H||!f?e.jsx(xe,{message:"Loading tasks..."}):R?e.jsxs("div",{className:"p-8 text-red-600",children:["Error: ",R]}):e.jsxs("div",{className:"flex flex-col p-4 md:p-6 lg:p-8",children:[e.jsxs("div",{className:"mb-4 sm:mb-6 flex-shrink-0",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white",children:"My Tasks"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:"Tickets assigned to you"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 flex-shrink-0",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Open Tasks"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400 mt-2",children:q})]}),e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900 rounded-full",children:e.jsx(oe,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"In Progress"}),e.jsx("p",{className:"text-3xl font-bold text-purple-600 dark:text-purple-400 mt-2",children:K})]}),e.jsx("div",{className:"p-3 bg-purple-100 dark:bg-purple-900 rounded-full",children:e.jsx(de,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Completed"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 dark:text-green-400 mt-2",children:Q})]}),e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900 rounded-full",children:e.jsx(ce,{className:"w-6 h-6 text-green-600 dark:text-green-400"})})]})})]}),e.jsx("div",{className:"mb-6 flex-shrink-0",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 dark:from-gray-800 dark:to-gray-700 rounded-lg shadow p-6 border border-blue-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex items-start justify-between gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(F,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Network Speed Test"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4",children:"Comprehensive test including ping, download, and upload speeds. Results automatically sent to admin."}),y&&e.jsx("div",{className:"mb-4 p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative w-20 h-20",children:[e.jsxs("svg",{className:"w-20 h-20 transform -rotate-90",children:[e.jsx("circle",{cx:"40",cy:"40",r:"32",stroke:"#e5e7eb",strokeWidth:"6",fill:"none"}),e.jsx("circle",{cx:"40",cy:"40",r:"32",stroke:"#3b82f6",strokeWidth:"6",fill:"none",strokeDasharray:`${2*Math.PI*32}`,strokeDashoffset:`${2*Math.PI*32*(1-k/100)}`,className:"transition-all duration-300",strokeLinecap:"round"}),[0,25,50,75,100].map(t=>e.jsx("line",{x1:"40",y1:"8",x2:"40",y2:"14",stroke:k>=t?"#3b82f6":"#e5e7eb",strokeWidth:"2",transform:`rotate(${t/100*360} 40 40)`},t))]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-sm font-bold text-blue-600",children:[Math.round(k),"%"]})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:Y}),e.jsx("div",{className:"mt-2 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-600 transition-all duration-300",style:{width:`${k}%`}})})]})]})}),w&&!y&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Ping"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[w.ping," ms"]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Latency"})]}),e.jsxs("div",{className:"text-center border-l border-r border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Download"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[w.downloadSpeed," Mbps"]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Speed"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Upload"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:[w.uploadSpeed," Mbps"]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Speed"})]})]})]}),e.jsxs("button",{onClick:Z,disabled:y,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2 font-medium transition-colors",children:[e.jsx(F,{className:"w-5 h-5"}),y?"Testing...":"Run Speed Test"]})]})})}),e.jsx("div",{className:"pb-4",children:m.length===0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-12 text-center",children:[e.jsx(ie,{className:"w-16 h-16 text-gray-300 dark:text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No tasks assigned yet"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"You don't have any tickets assigned to you at the moment"})]}):e.jsx("div",{className:"space-y-4",children:m.map(t=>{var s;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>M(`/tickets/${t.id}`),children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t.title}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Ticket #",t.number||t.id]})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsx("span",{className:`px-3 py-1 text-xs rounded-full whitespace-nowrap ${X(t.status||"")}`,children:(s=t.status)==null?void 0:s.replace("_"," ")}),e.jsx("span",{className:`px-3 py-1 text-xs rounded-full whitespace-nowrap ${V(t.priority||"")}`,children:t.priority})]})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm mb-4 line-clamp-2",children:t.description||"No description"}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:"truncate",children:["Created by: ",t.createdBy?t.createdBy.name||t.createdBy.email:"User"]}),t.createdAt&&e.jsxs("span",{className:"whitespace-nowrap",children:["Created: ",me(t.createdAt)]})]})]},t.id)})})})]})}export{ke as default};
